<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - Politique de Livraison</title>
    
    <!-- Tailwind CSS via CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        // Configuration Tailwind simple pour admin
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#3b82f6',
                        success: '#10b981',
                        warning: '#f59e0b',
                        danger: '#ef4444',
                    }
                }
            }
        }
    </script>
    
    <!-- Font Awesome pour icônes -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root {
            --primary-color: #3b82f6;
            --success-color: #10b981;
            --warning-color: #f59e0b;
            --danger-color: #ef4444;
            --text-color: #1f2937;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            color: var(--text-color);
            background-color: #f9fafb;
        }
        
        .admin-container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .section-card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }
        
        .section-card:hover {
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        .section-header {
            border-bottom: 1px solid #e5e7eb;
            padding: 1.5rem;
        }
        
        .section-content {
            padding: 1.5rem;
        }
        
        .status-indicator {
            display: inline-flex;
            align-items: center;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 500;
        }
        
        .status-saving {
            background-color: #fef3c7;
            color: #92400e;
        }
        
        .status-saved {
            background-color: #d1fae5;
            color: #065f46;
        }
        
        .status-error {
            background-color: #fee2e2;
            color: #991b1b;
        }
        
        .textarea-auto {
            min-height: 150px;
            resize: vertical;
        }
        
        .method-item {
            background-color: #f9fafb;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 0.75rem;
            transition: all 0.2s ease;
        }
        
        .method-item:hover {
            background-color: #f3f4f6;
            border-color: #d1d5db;
        }
        
        .method-item.dragging {
            opacity: 0.5;
            border-style: dashed;
        }
        
        .drag-handle {
            cursor: move;
            color: #9ca3af;
            transition: color 0.2s ease;
        }
        
        .drag-handle:hover {
            color: #6b7280;
        }
        
        .toast {
            position: fixed;
            bottom: 1.5rem;
            right: 1.5rem;
            background-color: var(--primary-color);
            color: white;
            padding: 1rem 1.5rem;
            border-radius: 8px;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            z-index: 1000;
            transform: translateY(100px);
            opacity: 0;
            transition: all 0.3s ease;
        }
        
        .toast.show {
            transform: translateY(0);
            opacity: 1;
        }
        
        .toast.success {
            background-color: var(--success-color);
        }
        
        .toast.error {
            background-color: var(--danger-color);
        }
        
        .skeleton {
            background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
            background-size: 200% 100%;
            animation: loading 1.5s infinite;
        }
        
        @keyframes loading {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }
        
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(255, 255, 255, 0.9);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
        }
        
        @media (max-width: 768px) {
            .admin-container {
                padding: 0 1rem;
            }
            
            .section-header, .section-content {
                padding: 1rem;
            }
            
            .toast {
                left: 1rem;
                right: 1rem;
                bottom: 1rem;
            }
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="loading-overlay">
        <div class="text-center">
            <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"></div>
            <p class="mt-4 text-gray-600 font-medium">Chargement des données...</p>
        </div>
    </div>

    <!-- Toast Notification -->
    <div id="toast" class="toast hidden">
        <div class="flex items-center">
            <i id="toastIcon" class="fas fa-check mr-2"></i>
            <span id="toastMessage">Mise à jour réussie</span>
        </div>
    </div>

    <!-- Main Container -->
    <div class="admin-container py-8 px-4">
        <!-- Header -->
        <header class="mb-8">
            <div class="flex flex-col md:flex-row md:items-center md:justify-between">
                <div>
                    <h1 class="text-3xl font-bold text-gray-900">Admin - Politique de Livraison</h1>
                    <p class="text-gray-600 mt-2">Gérez le contenu de la page "Politique de Livraison" du site e-commerce</p>
                </div>
                <div class="mt-4 md:mt-0 flex items-center space-x-4">
                    <div id="connectionStatus" class="status-indicator status-saving">
                        <i class="fas fa-circle text-xs mr-2"></i>
                        <span>Connexion...</span>
                    </div>
                    <button id="refreshBtn" class="flex items-center text-blue-600 hover:text-blue-800 transition-colors duration-200 bg-transparent border-none cursor-pointer">
                        <i class="fas fa-sync-alt mr-2"></i>
                        Actualiser
                    </button>
                </div>
            </div>
            
            <div class="mt-6 p-4 bg-blue-50 border border-blue-200 rounded-lg">
                <div class="flex">
                    <div class="flex-shrink-0">
                        <i class="fas fa-info-circle text-blue-400"></i>
                    </div>
                    <div class="ml-3">
                        <p class="text-sm text-blue-700">
                            <strong>Note importante :</strong> Toutes les modifications sont sauvegardées automatiquement. 
                            Les changements sont immédiatement visibles sur le site e-commerce.
                        </p>
                    </div>
                </div>
            </div>
        </header>

        <!-- Section A: Introduction Générale -->
        <section id="sectionIntro" class="section-card mb-8">
            <div class="section-header">
                <div class="flex items-center justify-between">
                    <div>
                        <h2 class="text-xl font-bold text-gray-900">
                            <i class="fas fa-paragraph text-blue-500 mr-2"></i>
                            Introduction Générale
                        </h2>
                        <p class="text-gray-600 text-sm mt-1">Texte d'introduction de la politique de livraison</p>
                    </div>
                    <div id="introStatus" class="status-indicator status-saving hidden">
                        <i class="fas fa-circle text-xs mr-2"></i>
                        <span>Sauvegarde...</span>
                    </div>
                </div>
            </div>
            <div class="section-content">
                <div class="mb-4">
                    <label for="introduction" class="block text-sm font-medium text-gray-700 mb-2">
                        Texte d'introduction
                    </label>
                    <textarea 
                        id="introduction" 
                        class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 textarea-auto transition-all duration-200"
                        placeholder="Rédigez ici l'introduction générale de votre politique de livraison..."
                        rows="6"
                    ></textarea>
                </div>
                <div class="text-sm text-gray-500">
                    <i class="fas fa-lightbulb mr-1"></i>
                    Ce texte s'affiche en haut de la page "Politique de Livraison"
                </div>
            </div>
        </section>

        <!-- Section B: Modes de Livraison -->
        <section id="sectionMethods" class="section-card mb-8">
            <div class="section-header">
                <div class="flex items-center justify-between">
                    <div>
                        <h2 class="text-xl font-bold text-gray-900">
                            <i class="fas fa-truck text-yellow-500 mr-2"></i>
                            Modes de Livraison Disponibles
                        </h2>
                        <p class="text-gray-600 text-sm mt-1">Liste des méthodes de livraison proposées</p>
                    </div>
                    <div id="methodsStatus" class="status-indicator status-saved hidden">
                        <i class="fas fa-circle text-xs mr-2"></i>
                        <span>Sauvegardé</span>
                    </div>
                </div>
            </div>
            <div class="section-content">
                <div class="mb-6">
                    <label class="block text-sm font-medium text-gray-700 mb-4">
                        Liste des modes de livraison (l'ordre d'affichage est important)
                    </label>
                    
                    <!-- Liste des méthodes -->
                    <div id="methodsList" class="mb-6">
                        <!-- Les méthodes seront chargées dynamiquement ici -->
                        <div class="text-center py-8">
                            <div class="skeleton h-12 rounded-lg mb-2"></div>
                            <div class="skeleton h-12 rounded-lg mb-2"></div>
                            <div class="skeleton h-12 rounded-lg"></div>
                        </div>
                    </div>
                    
                    <!-- Formulaire d'ajout/modification -->
                    <div class="bg-gray-50 p-4 rounded-lg border border-gray-200">
                        <div class="mb-4">
                            <label for="methodInput" class="block text-sm font-medium text-gray-700 mb-2">
                                <span id="formTitle">Ajouter un nouveau mode de livraison</span>
                            </label>
                            <textarea 
                                id="methodInput" 
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 textarea-auto"
                                placeholder="Exemple : Livraison standard à domicile sous 3 à 5 jours ouvrés"
                                rows="2"
                            ></textarea>
                        </div>
                        <div class="flex justify-between">
                            <div id="editControls" class="hidden">
                                <button id="cancelEdit" class="px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors duration-200 bg-white cursor-pointer">
                                    Annuler
                                </button>
                            </div>
                            <div class="flex space-x-3">
                                <button id="addMethodBtn" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors duration-200 flex items-center cursor-pointer">
                                    <i class="fas fa-plus mr-2"></i>
                                    Ajouter
                                </button>
                                <button id="saveMethodBtn" class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors duration-200 hidden flex items-center cursor-pointer">
                                    <i class="fas fa-save mr-2"></i>
                                    Mettre à jour
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="text-sm text-gray-500">
                    <i class="fas fa-lightbulb mr-1"></i>
                    Glissez-déposez les éléments pour modifier l'ordre d'affichage
                </div>
            </div>
        </section>

        <!-- Section C: Frais de Livraison -->
        <section id="sectionFees" class="section-card mb-8">
            <div class="section-header">
                <div class="flex items-center justify-between">
                    <div>
                        <h2 class="text-xl font-bold text-gray-900">                            Frais de Livraison
                        </h2>
                        <p class="text-gray-600 text-sm mt-1">Informations sur les frais de livraison</p>
                    </div>
                    <div id="feesStatus" class="status-indicator status-saved hidden">
                        <i class="fas fa-circle text-xs mr-2"></i>
                        <span>Sauvegardé</span>
                    </div>
                </div>
            </div>
            <div class="section-content">
                <div class="mb-4">
                    <label for="feesInfo" class="block text-sm font-medium text-gray-700 mb-2">
                        Informations sur les frais
                    </label>
                    <textarea 
                        id="feesInfo" 
                        class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 textarea-auto transition-all duration-200"
                        placeholder="Rédigez ici les informations sur les frais de livraison..."
                        rows="6"
                    ></textarea>
                </div>
                <div class="bg-yellow-50 border-l-4 border-yellow-400 p-4 mb-4">
                    <div class="flex">
                        <div class="flex-shrink-0">
                            <i class="fas fa-exclamation-triangle text-yellow-400"></i>
                        </div>
                        <div class="ml-3">
                            <p class="text-sm text-yellow-700">
                                <strong>Important :</strong> Ne pas indiquer de tarifs spécifiques. 
                                Décrivez uniquement la logique de calcul (ex: "Les frais dépendent du poids et de la destination").
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Section D: Délais de Livraison -->
        <section id="sectionDelays" class="section-card mb-8">
            <div class="section-header">
                <div class="flex items-center justify-between">
                    <div>
                        <h2 class="text-xl font-bold text-gray-900">
                            <i class="fas fa-clock text-purple-500 mr-2"></i>
                            Délais de Livraison
                        </h2>
                        <p class="text-gray-600 text-sm mt-1">Informations sur les délais de livraison</p>
                    </div>
                    <div id="delaysStatus" class="status-indicator status-saved hidden">
                        <i class="fas fa-circle text-xs mr-2"></i>
                        <span>Sauvegardé</span>
                    </div>
                </div>
            </div>
            <div class="section-content">
                <div class="mb-4">
                    <label for="delays" class="block text-sm font-medium text-gray-700 mb-2">
                        Informations sur les délais
                    </label>
                    <textarea 
                        id="delays" 
                        class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 textarea-auto transition-all duration-200"
                        placeholder="Rédigez ici les informations sur les délais de livraison..."
                        rows="6"
                    ></textarea>
                </div>
                <div class="text-sm text-gray-500">
                    <i class="fas fa-lightbulb mr-1"></i>
                    Mentionnez clairement que les délais sont estimatifs et non garantis
                </div>
            </div>
        </section>

        <!-- Section E: Code de Livraison -->
        <section id="sectionCode" class="section-card mb-8">
            <div class="section-header">
                <div class="flex items-center justify-between">
                    <div>
                        <h2 class="text-xl font-bold text-gray-900">
                            <i class="fas fa-barcode text-red-500 mr-2"></i>
                            Code de Livraison
                        </h2>
                        <p class="text-gray-600 text-sm mt-1">Explications sur le code de livraison</p>
                    </div>
                    <div id="codeStatus" class="status-indicator status-saved hidden">
                        <i class="fas fa-circle text-xs mr-2"></i>
                        <span>Sauvegardé</span>
                    </div>
                </div>
            </div>
            <div class="section-content">
                <div class="mb-4">
                    <label for="codeExplanation" class="block text-sm font-medium text-gray-700 mb-2">
                        Explications du code
                    </label>
                    <textarea 
                        id="codeExplanation" 
                        class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 textarea-auto transition-all duration-200"
                        placeholder="Rédigez ici les explications concernant le code de livraison..."
                        rows="6"
                    ></textarea>
                </div>
                <div class="bg-blue-50 border-l-4 border-blue-400 p-4">
                    <div class="flex">
                        <div class="flex-shrink-0">
                            <i class="fas fa-info-circle text-blue-400"></i>
                        </div>
                        <div class="ml-3">
                            <p class="text-sm text-blue-700">
                                Expliquez : génération automatique, nécessité pour le retrait en point de vente ou la livraison par rencontre, 
                                et utilisation comme preuve d'achat.
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Section F: Responsabilités -->
        <section id="sectionResponsibilities" class="section-card mb-8">
            <div class="section-header">
                <div class="flex items-center justify-between">
                    <div>
                        <h2 class="text-xl font-bold text-gray-900">
                            <i class="fas fa-balance-scale text-orange-500 mr-2"></i>
                            Responsabilités & Cas Particuliers
                        </h2>
                        <p class="text-gray-600 text-sm mt-1">Gestion des cas particuliers et responsabilités</p>
                    </div>
                    <div id="responsibilitiesStatus" class="status-indicator status-saved hidden">
                        <i class="fas fa-circle text-xs mr-2"></i>
                        <span>Sauvegardé</span>
                    </div>
                </div>
            </div>
            <div class="section-content">
                <div class="mb-4">
                    <label for="responsibilities" class="block text-sm font-medium text-gray-700 mb-2">
                        Informations sur les responsabilités
                    </label>
                    <textarea 
                        id="responsibilities" 
                        class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 textarea-auto transition-all duration-200"
                        placeholder="Rédigez ici les informations sur les responsabilités et cas particuliers..."
                        rows="6"
                    ></textarea>
                </div>
                <div class="text-sm text-gray-500">
                    <i class="fas fa-lightbulb mr-1"></i>
                    Mentionnez : colis lourds, produits fragiles, retards indépendants de l'entreprise
                </div>
            </div>
        </section>

        <!-- Footer -->
        <footer class="mt-12 pt-8 border-t border-gray-200">
            <div class="flex flex-col md:flex-row justify-between items-center">
                <div class="mb-4 md:mb-0">
                    <p class="text-gray-600">Admin Politique de Livraison - <span id="lastUpdate">Chargement...</span></p>
                </div>
                <div class="text-sm text-gray-500">
                    <i class="fas fa-database mr-1"></i>
                    Collection: <code class="bg-gray-100 px-2 py-1 rounded">legal_pages/delivery_policy</code>
                </div>
            </div>
        </footer>
    </div>

    <!-- Confirmation Modal -->
    <div id="confirmModal" class="fixed inset-0 bg-gray-500 bg-opacity-75 flex items-center justify-center p-4 z-50 hidden">
        <div class="bg-white rounded-lg max-w-md w-full">
            <div class="p-6">
                <h3 class="text-lg font-medium text-gray-900 mb-4" id="modalTitle">Confirmer la suppression</h3>
                <p class="text-gray-600 mb-6" id="modalMessage">Êtes-vous sûr de vouloir supprimer cet élément ?</p>
                <div class="flex justify-end space-x-3">
                    <button id="modalCancel" class="px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors duration-200 bg-white cursor-pointer">
                        Annuler
                    </button>
                    <button id="modalConfirm" class="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors duration-200 cursor-pointer">
                        Supprimer
                    </button>
                </div>
            </div>
        </div>
    </div>
    <!-- ------------------------------------------------------------------------------------------------------------
     ==========================================================================================================
     ==========================================
      --><!-- Bulle de navigation unique -->
<!-- Bulle de navigation unique -->
<div id="navBubbleUniq" class="fixed bottom-4 right-4 z-50 transition-all duration-300">
  <!-- Bouton principal de la bulle -->
  <button id="navBubbleBtnUniq" 
          class="w-14 h-14 md:w-16 md:h-16 bg-gradient-to-br from-indigo-600 to-purple-600 rounded-full shadow-xl hover:shadow-2xl transition-all duration-300 flex items-center justify-center group active:scale-95 focus:outline-none focus:ring-4 focus:ring-indigo-500/30">
    <i class="fas fa-rocket text-white text-xl md:text-2xl group-hover:rotate-90 transition-transform duration-300"></i>
    <span class="absolute -top-2 -right-2 w-6 h-6 bg-red-500 text-white text-xs rounded-full flex items-center justify-center animate-pulse">7</span>
  </button>

  <!-- Menu déroulant -->
  <div id="navBubbleMenuUniq" 
       class="absolute bottom-20 right-0 w-72 bg-white dark:bg-gray-800 rounded-2xl shadow-2xl opacity-0 scale-95 pointer-events-none transition-all duration-300 transform origin-bottom-right border border-gray-100 dark:border-gray-700">
    
    <!-- En-tête du menu -->
    <div class="p-4 border-b border-gray-100 dark:border-gray-700">
      <div class="flex items-center justify-between">
        <h3 class="font-bold text-gray-800 dark:text-white flex items-center gap-2">
          <i class="fas fa-space-shuttle text-indigo-500"></i>
          Navigation Dashboard
        </h3>
        <span class="text-xs px-2 py-1 bg-indigo-100 dark:bg-indigo-900/40 text-indigo-600 dark:text-indigo-300 rounded-full">7 liens</span>
      </div>
      <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">Accès rapide aux sections principales</p>
    </div>

    <!-- Liste des liens -->
    <div class="p-2 space-y-1 max-h-96 overflow-y-auto custom-scrollbar-uniq">
      <!-- Lien Dashboard Accueil -->
      <a href="dashacceuil.html" 
         class="navBubbleLinkUniq flex items-center gap-3 p-3 rounded-xl hover:bg-indigo-50 dark:hover:bg-gray-700 transition-colors duration-200 group focus:outline-none focus:bg-indigo-50 dark:focus:bg-gray-700">
        <div class="w-10 h-10 bg-indigo-100 dark:bg-indigo-900/30 rounded-lg flex items-center justify-center flex-shrink-0">
          <i class="fas fa-home text-indigo-600 dark:text-indigo-400"></i>
        </div>
        <div class="flex-1 min-w-0">
          <p class="font-semibold text-gray-800 dark:text-white truncate">Dashboard Accueil</p>
          <p class="text-xs text-gray-500 dark:text-gray-400 truncate">Tableau de bord principal</p>
        </div>
        <i class="fas fa-chevron-right text-gray-400 group-hover:text-indigo-500 transition-colors flex-shrink-0"></i>
      </a>

      <!-- Lien Confidentialité -->
      <a href="dashconfi.html" 
         class="navBubbleLinkUniq flex items-center gap-3 p-3 rounded-xl hover:bg-blue-50 dark:hover:bg-gray-700 transition-colors duration-200 group focus:outline-none focus:bg-blue-50 dark:focus:bg-gray-700">
        <div class="w-10 h-10 bg-blue-100 dark:bg-blue-900/30 rounded-lg flex items-center justify-center flex-shrink-0">
          <i class="fas fa-shield-alt text-blue-600 dark:text-blue-400"></i>
        </div>
        <div class="flex-1 min-w-0">
          <p class="font-semibold text-gray-800 dark:text-white truncate">Confidentialité</p>
          <p class="text-xs text-gray-500 dark:text-gray-400 truncate">Gestion des données privées</p>
        </div>
        <i class="fas fa-chevron-right text-gray-400 group-hover:text-blue-500 transition-colors flex-shrink-0"></i>
      </a>

      <!-- Lien Livraison -->
      <a href="livraisondash.html" 
         class="navBubbleLinkUniq flex items-center gap-3 p-3 rounded-xl hover:bg-green-50 dark:hover:bg-gray-700 transition-colors duration-200 group focus:outline-none focus:bg-green-50 dark:focus:bg-gray-700">
        <div class="w-10 h-10 bg-green-100 dark:bg-green-900/30 rounded-lg flex items-center justify-center flex-shrink-0">
          <i class="fas fa-shipping-fast text-green-600 dark:text-green-400"></i>
        </div>
        <div class="flex-1 min-w-0">
          <p class="font-semibold text-gray-800 dark:text-white truncate">Dashboard Livraison</p>
          <p class="text-xs text-gray-500 dark:text-gray-400 truncate">Suivi des commandes</p>
        </div>
        <i class="fas fa-chevron-right text-gray-400 group-hover:text-green-500 transition-colors flex-shrink-0"></i>
      </a>

      <!-- Lien Catalogue -->
      <a href="catalogue-admin.html" 
         class="navBubbleLinkUniq flex items-center gap-3 p-3 rounded-xl hover:bg-purple-50 dark:hover:bg-gray-700 transition-colors duration-200 group focus:outline-none focus:bg-purple-50 dark:focus:bg-gray-700">
        <div class="w-10 h-10 bg-purple-100 dark:bg-purple-900/30 rounded-lg flex items-center justify-center flex-shrink-0">
          <i class="fas fa-boxes text-purple-600 dark:text-purple-400"></i>
        </div>
        <div class="flex-1 min-w-0">
          <p class="font-semibold text-gray-800 dark:text-white truncate">Catalogue Admin</p>
          <p class="text-xs text-gray-500 dark:text-gray-400 truncate">Gestion des produits</p>
        </div>
        <i class="fas fa-chevron-right text-gray-400 group-hover:text-purple-500 transition-colors flex-shrink-0"></i>
      </a>

      <!-- Lien Commandes -->
      <a href="panier.html" 
         class="navBubbleLinkUniq flex items-center gap-3 p-3 rounded-xl hover:bg-amber-50 dark:hover:bg-gray-700 transition-colors duration-200 group focus:outline-none focus:bg-amber-50 dark:focus:bg-gray-700">
        <div class="w-10 h-10 bg-amber-100 dark:bg-amber-900/30 rounded-lg flex items-center justify-center flex-shrink-0">
          <i class="fas fa-shopping-cart text-amber-600 dark:text-amber-400"></i>
        </div>
        <div class="flex-1 min-w-0">
          <p class="font-semibold text-gray-800 dark:text-white truncate">Commandes & Panier</p>
          <p class="text-xs text-gray-500 dark:text-gray-400 truncate">Paiements et transactions</p>
        </div>
        <i class="fas fa-chevron-right text-gray-400 group-hover:text-amber-500 transition-colors flex-shrink-0"></i>
      </a>

      <!-- Lien About -->
      <a href="dashabout.html" 
         class="navBubbleLinkUniq flex items-center gap-3 p-3 rounded-xl hover:bg-cyan-50 dark:hover:bg-gray-700 transition-colors duration-200 group focus:outline-none focus:bg-cyan-50 dark:focus:bg-gray-700">
        <div class="w-10 h-10 bg-cyan-100 dark:bg-cyan-900/30 rounded-lg flex items-center justify-center flex-shrink-0">
          <i class="fas fa-info-circle text-cyan-600 dark:text-cyan-400"></i>
        </div>
        <div class="flex-1 min-w-0">
          <p class="font-semibold text-gray-800 dark:text-white truncate">À propos</p>
          <p class="text-xs text-gray-500 dark:text-gray-400 truncate">Informations sur l'application</p>
        </div>
        <i class="fas fa-chevron-right text-gray-400 group-hover:text-cyan-500 transition-colors flex-shrink-0"></i>
      </a>

      <!-- Lien Transfert -->
      <a href="marquee.html" 
         class="navBubbleLinkUniq flex items-center gap-3 p-3 rounded-xl hover:bg-pink-50 dark:hover:bg-gray-700 transition-colors duration-200 group focus:outline-none focus:bg-pink-50 dark:focus:bg-gray-700">
        <div class="w-10 h-10 bg-pink-100 dark:bg-pink-900/30 rounded-lg flex items-center justify-center flex-shrink-0">
          <i class="fas fa-exchange-alt text-pink-600 dark:text-pink-400"></i>
        </div>
        <div class="flex-1 min-w-0">
          <p class="font-semibold text-gray-800 dark:text-white truncate">Transfert</p>
          <p class="text-xs text-gray-500 dark:text-gray-400 truncate">Transferts et transactions</p>
        </div>
        <i class="fas fa-chevron-right text-gray-400 group-hover:text-pink-500 transition-colors flex-shrink-0"></i>
      </a>
    </div>

    <!-- Footer du menu -->
    <div class="p-3 border-t border-gray-100 dark:border-gray-700 bg-gray-50 dark:bg-gray-900/50 rounded-b-2xl">
      <div class="flex items-center justify-between">
        <div class="text-xs text-gray-500 dark:text-gray-400">
          <span class="font-medium">v1.2.0</span>
          <span class="mx-1">•</span>
          <span>Navigation avancée</span>
        </div>
        <button id="navBubbleCloseUniq" 
                class="w-8 h-8 flex items-center justify-center rounded-full hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors focus:outline-none focus:ring-2 focus:ring-indigo-500/50">
          <i class="fas fa-times text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300"></i>
        </button>
      </div>
    </div>
  </div>
</div>

<script>
// Variables globales uniques pour la bulle
let navBubbleDragStateUniq = {
  isDragging: false,
  startX: 0,
  startY: 0,
  startLeft: 0,
  startTop: 0
};

let navBubbleMenuStateUniq = {
  isOpen: false,
  isAnimating: false
};

let navBubbleTouchTimerUniq = null;

// Références aux éléments DOM
const navBubbleContainerUniq = document.getElementById('navBubbleUniq');
const navBubbleToggleUniq = document.getElementById('navBubbleBtnUniq');
const navBubbleDropdownUniq = document.getElementById('navBubbleMenuUniq');
const navBubbleCloseTriggerUniq = document.getElementById('navBubbleCloseUniq');
const navBubbleMenuLinksUniq = document.querySelectorAll('.navBubbleLinkUniq');

// Initialisation de la bulle
function setupNavBubbleUniq() {
  loadNavBubblePositionUniq();
  attachNavBubbleEventsUniq();
  setupNavBubbleAccessibilityUniq();
  animateNavBubbleIntroUniq();
}

// Charger la position sauvegardée
function loadNavBubblePositionUniq() {
  const savedPos = localStorage.getItem('navBubblePositionV2');
  if (savedPos) {
    try {
      const { x, y } = JSON.parse(savedPos);
      const safeX = Math.max(10, Math.min(x, window.innerWidth - 70));
      const safeY = Math.max(10, Math.min(y, window.innerHeight - 70));
      
      navBubbleContainerUniq.style.left = `${safeX}px`;
      navBubbleContainerUniq.style.top = `${safeY}px`;
      navBubbleContainerUniq.style.right = 'auto';
      navBubbleContainerUniq.style.bottom = 'auto';
    } catch (e) {
      console.warn('Position de bulle invalide, utilisation par défaut');
    }
  }
}

// Sauvegarder la position
function saveNavBubblePositionUniq() {
  const rect = navBubbleContainerUniq.getBoundingClientRect();
  localStorage.setItem('navBubblePositionV2', JSON.stringify({
    x: rect.left,
    y: rect.top
  }));
}

// Attacher les événements
function attachNavBubbleEventsUniq() {
  // Événements desktop
  navBubbleToggleUniq.addEventListener('mousedown', startNavBubbleDragDesktopUniq);
  navBubbleToggleUniq.addEventListener('click', handleNavBubbleToggleClickUniq);
  navBubbleCloseTriggerUniq.addEventListener('click', closeNavBubbleMenuUniq);
  
  // Événements mobile touch
  navBubbleToggleUniq.addEventListener('touchstart', startNavBubbleTouchUniq, { passive: false });
  navBubbleToggleUniq.addEventListener('touchmove', handleNavBubbleTouchMoveUniq, { passive: false });
  navBubbleToggleUniq.addEventListener('touchend', endNavBubbleTouchUniq);
  
  // Événements globaux
  document.addEventListener('mousemove', handleNavBubbleDragDesktopUniq);
  document.addEventListener('mouseup', stopNavBubbleDragDesktopUniq);
  document.addEventListener('click', handleDocumentClickNavBubbleUniq);
  document.addEventListener('keydown', handleNavBubbleKeyboardUniq);
  window.addEventListener('resize', handleNavBubbleResizeUniq);
  
  // Prévenir le drag des images dans les liens
  navBubbleMenuLinksUniq.forEach(link => {
    link.addEventListener('dragstart', (e) => e.preventDefault());
  });
}

// Gestion du clic sur le bouton toggle
function handleNavBubbleToggleClickUniq(e) {
  if (navBubbleDragStateUniq.isDragging) {
    navBubbleDragStateUniq.isDragging = false;
    saveNavBubblePositionUniq();
    return;
  }
  
  e.stopPropagation();
  toggleNavBubbleMenuUniq();
}

// Ouvrir/fermer le menu
function toggleNavBubbleMenuUniq() {
  if (navBubbleMenuStateUniq.isAnimating) return;
  
  navBubbleMenuStateUniq.isAnimating = true;
  
  if (navBubbleMenuStateUniq.isOpen) {
    closeNavBubbleMenuUniq();
  } else {
    openNavBubbleMenuUniq();
  }
  
  setTimeout(() => {
    navBubbleMenuStateUniq.isAnimating = false;
  }, 300);
}

// Ouvrir le menu
function openNavBubbleMenuUniq() {
  navBubbleMenuStateUniq.isOpen = true;
  navBubbleDropdownUniq.classList.remove('opacity-0', 'scale-95', 'pointer-events-none');
  navBubbleDropdownUniq.classList.add('opacity-100', 'scale-100', 'pointer-events-auto');
  navBubbleToggleUniq.classList.add('from-purple-600', 'to-pink-600', 'ring-4', 'ring-purple-500/30');
  
  // Feedback haptique sur mobile
  if ('vibrate' in navigator) {
    navigator.vibrate(30);
  }
}

// Fermer le menu
function closeNavBubbleMenuUniq() {
  navBubbleMenuStateUniq.isOpen = false;
  navBubbleDropdownUniq.classList.remove('opacity-100', 'scale-100', 'pointer-events-auto');
  navBubbleDropdownUniq.classList.add('opacity-0', 'scale-95', 'pointer-events-none');
  navBubbleToggleUniq.classList.remove('from-purple-600', 'to-pink-600', 'ring-4', 'ring-purple-500/30');
}

// Drag desktop
function startNavBubbleDragDesktopUniq(e) {
  if (e.button !== 0) return; // Seulement clic gauche
  
  navBubbleDragStateUniq.isDragging = true;
  const rect = navBubbleContainerUniq.getBoundingClientRect();
  
  navBubbleDragStateUniq.startX = e.clientX;
  navBubbleDragStateUniq.startY = e.clientY;
  navBubbleDragStateUniq.startLeft = rect.left;
  navBubbleDragStateUniq.startTop = rect.top;
  
  navBubbleContainerUniq.style.transition = 'none';
  navBubbleContainerUniq.style.cursor = 'grabbing';
  closeNavBubbleMenuUniq();
}

function handleNavBubbleDragDesktopUniq(e) {
  if (!navBubbleDragStateUniq.isDragging) return;
  
  const deltaX = e.clientX - navBubbleDragStateUniq.startX;
  const deltaY = e.clientY - navBubbleDragStateUniq.startY;
  
  let newLeft = navBubbleDragStateUniq.startLeft + deltaX;
  let newTop = navBubbleDragStateUniq.startTop + deltaY;
  
  // Garder dans les limites
  const maxX = window.innerWidth - navBubbleContainerUniq.offsetWidth - 10;
  const maxY = window.innerHeight - navBubbleContainerUniq.offsetHeight - 10;
  
  newLeft = Math.max(10, Math.min(newLeft, maxX));
  newTop = Math.max(10, Math.min(newTop, maxY));
  
  navBubbleContainerUniq.style.left = `${newLeft}px`;
  navBubbleContainerUniq.style.top = `${newTop}px`;
  navBubbleContainerUniq.style.right = 'auto';
  navBubbleContainerUniq.style.bottom = 'auto';
}

function stopNavBubbleDragDesktopUniq() {
  if (!navBubbleDragStateUniq.isDragging) return;
  
  navBubbleDragStateUniq.isDragging = false;
  navBubbleContainerUniq.style.transition = 'all 0.3s cubic-bezier(0.4, 0, 0.2, 1)';
  navBubbleContainerUniq.style.cursor = '';
  saveNavBubblePositionUniq();
}

// Touch mobile
function startNavBubbleTouchUniq(e) {
  if (e.touches.length !== 1) return;
  
  const touch = e.touches[0];
  
  navBubbleTouchTimerUniq = setTimeout(() => {
    // Long press pour drag
    navBubbleDragStateUniq.isDragging = true;
    const rect = navBubbleContainerUniq.getBoundingClientRect();
    
    navBubbleDragStateUniq.startX = touch.clientX;
    navBubbleDragStateUniq.startY = touch.clientY;
    navBubbleDragStateUniq.startLeft = rect.left;
    navBubbleDragStateUniq.startTop = rect.top;
    
    navBubbleContainerUniq.style.transition = 'none';
    closeNavBubbleMenuUniq();
    
    if ('vibrate' in navigator) {
      navigator.vibrate(50);
    }
  }, 500); // 500ms pour long press
}

function handleNavBubbleTouchMoveUniq(e) {
  if (!navBubbleDragStateUniq.isDragging || e.touches.length !== 1) return;
  
  e.preventDefault();
  const touch = e.touches[0];
  
  const deltaX = touch.clientX - navBubbleDragStateUniq.startX;
  const deltaY = touch.clientY - navBubbleDragStateUniq.startY;
  
  let newLeft = navBubbleDragStateUniq.startLeft + deltaX;
  let newTop = navBubbleDragStateUniq.startTop + deltaY;
  
  const maxX = window.innerWidth - navBubbleContainerUniq.offsetWidth - 10;
  const maxY = window.innerHeight - navBubbleContainerUniq.offsetHeight - 10;
  
  newLeft = Math.max(10, Math.min(newLeft, maxX));
  newTop = Math.max(10, Math.min(newTop, maxY));
  
  navBubbleContainerUniq.style.left = `${newLeft}px`;
  navBubbleContainerUniq.style.top = `${newTop}px`;
}

function endNavBubbleTouchUniq() {
  clearTimeout(navBubbleTouchTimerUniq);
  
  if (navBubbleDragStateUniq.isDragging) {
    navBubbleDragStateUniq.isDragging = false;
    navBubbleContainerUniq.style.transition = 'all 0.3s cubic-bezier(0.4, 0, 0.2, 1)';
    saveNavBubblePositionUniq();
  }
}

// Gestion des clics en dehors
function handleDocumentClickNavBubbleUniq(e) {
  if (!navBubbleMenuStateUniq.isOpen) return;
  
  const isClickInside = navBubbleContainerUniq.contains(e.target);
  
  if (!isClickInside) {
    closeNavBubbleMenuUniq();
  }
}

// Gestion du clavier
function handleNavBubbleKeyboardUniq(e) {
  if (e.key === 'Escape' && navBubbleMenuStateUniq.isOpen) {
    closeNavBubbleMenuUniq();
  }
  
  // Navigation au clavier dans le menu
  if (e.key === 'Tab' && navBubbleMenuStateUniq.isOpen) {
    e.preventDefault();
    const currentIndex = Array.from(navBubbleMenuLinksUniq).indexOf(document.activeElement);
    let nextIndex;
    
    if (e.shiftKey) {
      nextIndex = currentIndex > 0 ? currentIndex - 1 : navBubbleMenuLinksUniq.length - 1;
    } else {
      nextIndex = currentIndex < navBubbleMenuLinksUniq.length - 1 ? currentIndex + 1 : 0;
    }
    
    if (navBubbleMenuLinksUniq[nextIndex]) {
      navBubbleMenuLinksUniq[nextIndex].focus();
    }
  }
}

// Redimensionnement
function handleNavBubbleResizeUniq() {
  const rect = navBubbleContainerUniq.getBoundingClientRect();
  const maxX = window.innerWidth - navBubbleContainerUniq.offsetWidth - 10;
  const maxY = window.innerHeight - navBubbleContainerUniq.offsetHeight - 10;
  
  if (rect.left > maxX || rect.top > maxY) {
    // Réinitialiser si hors écran
    navBubbleContainerUniq.style.left = 'auto';
    navBubbleContainerUniq.style.top = 'auto';
    navBubbleContainerUniq.style.right = '1rem';
    navBubbleContainerUniq.style.bottom = '1rem';
    localStorage.removeItem('navBubblePositionV2');
  }
}

// Accessibilité
function setupNavBubbleAccessibilityUniq() {
  navBubbleToggleUniq.setAttribute('aria-label', 'Ouvrir le menu de navigation');
  navBubbleToggleUniq.setAttribute('aria-expanded', 'false');
  navBubbleToggleUniq.setAttribute('role', 'button');
  
  navBubbleDropdownUniq.setAttribute('aria-hidden', 'true');
  navBubbleDropdownUniq.setAttribute('role', 'menu');
  
  navBubbleMenuLinksUniq.forEach((link, index) => {
    link.setAttribute('role', 'menuitem');
    link.setAttribute('tabindex', '-1');
  });
  
  // Mettre à jour les attributs ARIA quand le menu s'ouvre/ferme
  const observerNavBubbleUniq = new MutationObserver((mutations) => {
    mutations.forEach((mutation) => {
      if (mutation.attributeName === 'class') {
        const isOpen = navBubbleDropdownUniq.classList.contains('opacity-100');
        navBubbleToggleUniq.setAttribute('aria-expanded', isOpen.toString());
        navBubbleDropdownUniq.setAttribute('aria-hidden', (!isOpen).toString());
        
        navBubbleMenuLinksUniq.forEach(link => {
          link.setAttribute('tabindex', isOpen ? '0' : '-1');
        });
      }
    });
  });
  
  observerNavBubbleUniq.observe(navBubbleDropdownUniq, {
    attributes: true,
    attributeFilter: ['class']
  });
}

// Animation d'introduction
function animateNavBubbleIntroUniq() {
  navBubbleContainerUniq.classList.add('animate-bounce');
  setTimeout(() => {
    navBubbleContainerUniq.classList.remove('animate-bounce');
  }, 1500);
}

// Initialisation
document.addEventListener('DOMContentLoaded', () => {
  setTimeout(() => {
    setupNavBubbleUniq();
  }, 100);
});
</script>

<style>
/* Styles additionnels pour la bulle de navigation */
.custom-scrollbar-uniq::-webkit-scrollbar {
  width: 6px;
}

.custom-scrollbar-uniq::-webkit-scrollbar-track {
  background: #f1f1f1;
  border-radius: 3px;
}

.custom-scrollbar-uniq::-webkit-scrollbar-thumb {
  background: #c1c1c1;
  border-radius: 3px;
}

.custom-scrollbar-uniq::-webkit-scrollbar-thumb:hover {
  background: #a1a1a1;
}

.dark .custom-scrollbar-uniq::-webkit-scrollbar-track {
  background: #374151;
}

.dark .custom-scrollbar-uniq::-webkit-scrollbar-thumb {
  background: #4b5563;
}

.dark .custom-scrollbar-uniq::-webkit-scrollbar-thumb:hover {
  background: #6b7280;
}

/* Animation de pulse améliorée */
@keyframes navBubblePulseUniq {
  0%, 100% {
    transform: scale(1);
    box-shadow: 0 10px 25px rgba(99, 102, 241, 0.3);
  }
  50% {
    transform: scale(1.05);
    box-shadow: 0 15px 35px rgba(99, 102, 241, 0.5);
  }
}

.animate-pulse {
  animation: navBubblePulseUniq 2s ease-in-out infinite;
}

/* Animation de rebond pour l'introduction */
@keyframes navBubbleBounceUniq {
  0%, 100% {
    transform: translateY(0);
  }
  50% {
    transform: translateY(-20px);
  }
}

.animate-bounce {
  animation: navBubbleBounceUniq 0.5s ease-in-out 3;
}

/* Support du dark mode avancé */
@media (prefers-color-scheme: dark) {
  #navBubbleBtnUniq {
    box-shadow: 0 10px 25px rgba(0, 0, 0, 0.4);
  }
  
  #navBubbleBtnUniq:hover {
    box-shadow: 0 15px 35px rgba(0, 0, 0, 0.6);
  }
}

/* Responsive amélioré */
@media (max-width: 640px) {
  #navBubbleMenuUniq {
    width: calc(100vw - 2rem);
    max-width: 320px;
    right: 50%;
    transform: translateX(50%) scale(0.95);
    transform-origin: bottom center;
  }
  
  #navBubbleMenuUniq.opacity-100 {
    transform: translateX(50%) scale(1);
  }
  
  #navBubbleUniq {
    bottom: 1rem;
    right: 1rem;
  }
}

/* Transition fluide pour le menu */
#navBubbleMenuUniq {
  transition: opacity 0.3s cubic-bezier(0.4, 0, 0.2, 1), 
              transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Focus styles pour accessibilité */
.navBubbleLinkUniq:focus-visible {
  outline: 2px solid #4f46e5;
  outline-offset: -2px;
}

#navBubbleBtnUniq:focus-visible {
  outline: 2px solid #4f46e5;
  outline-offset: 2px;
}
</style>
<!-- =================================================================================================================================================
 ====================================================================================================================================
 ============================================================================================
  -->


  <!-- =====================================================================
     ===================================================================== -->
<div id="overlay-container"></div>
<script>
  fetch('overlay.html')
    .then(res => res.text())
    .then(html => {
      document.getElementById('overlay-container').innerHTML = html;
      initSecurityOverlay();
    });
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js"></script>


<script src="overlay.js"></script>
<!-- ===================================================
 ==============
 ====================================================== -->
    <!-- JavaScript -->
    <script type="module">
        // ============================================
        // CONFIGURATION FIREBASE
        // ============================================
        
        // REMPLACEZ CES VALEURS PAR VOS PROPRES CRÉDENTIALS FIREBASE
 const firebaseConfig = {
  apiKey: "AIzaSyCOifibU2E6Vo-3Ohg-WmAHa43sa5HyFuw",
  authDomain: "smartcutservices.firebaseapp.com",
  projectId: "smartcutservices",
  storageBucket: "smartcutservices.firebasestorage.app",
  messagingSenderId: "589013273323",
  appId: "1:589013273323:web:415772e7b94f6bb37d8cae",
  measurementId: "G-R8GJXQP7BD"
};

        // ============================================
        // INITIALISATION
        // ============================================
        
        let db = null;
        let deliveryData = null;
        let isOnline = false;
        let isDirty = {};
        let currentEditIndex = -1;
        let dragSource = null;

        document.addEventListener('DOMContentLoaded', async function() {
            try {
                // Charger Firebase dynamiquement
                await loadFirebaseSDK();
                initApp();
            } catch (error) {
                console.error('Erreur d\'initialisation:', error);
                showToast('Erreur d\'initialisation', 'error');
            }
        });

        async function loadFirebaseSDK() {
            return new Promise((resolve, reject) => {
                // Vérifier si Firebase est déjà chargé
                if (typeof firebase !== 'undefined') {
                    resolve();
                    return;
                }

                // Charger Firebase SDK dynamiquement
                const firebaseScript = document.createElement('script');
                firebaseScript.src = 'https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js';
                firebaseScript.onload = () => {
                    const firestoreScript = document.createElement('script');
                    firestoreScript.src = 'https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js';
                    firestoreScript.onload = resolve;
                    firestoreScript.onerror = reject;
                    document.head.appendChild(firestoreScript);
                };
                firebaseScript.onerror = reject;
                document.head.appendChild(firebaseScript);
            });
        }

        function initApp() {
            try {
                // Initialiser Firebase
                if (firebase.apps.length === 0) {
                    firebase.initializeApp(firebaseConfig);
                }
                
                db = firebase.firestore();
                
                // Tester la connexion
                db.collection('test').limit(1).get().catch(() => {
                    // Ignorer l'erreur de test
                });
                
                isOnline = true;
                updateConnectionStatus('connected');
                
                // Initialiser les événements
                initEventListeners();
                
                // Charger les données
                loadDeliveryPolicy();
                
                console.log('Application admin initialisée avec succès');
                
            } catch (error) {
                console.error('Erreur d\'initialisation Firebase:', error);
                updateConnectionStatus('error');
                showToast('Configuration Firebase incorrecte', 'error');
                showLoading(false);
            }
        }

        // ============================================
        // ÉVÉNEMENTS
        // ============================================
        
        function initEventListeners() {
            // Section A: Introduction
            const introTextarea = document.getElementById('introduction');
            if (introTextarea) {
                introTextarea.addEventListener('input', debounce(() => {
                    updateIntroduction();
                }, 1000));
            }

            // Section B: Modes de Livraison
            document.getElementById('addMethodBtn').addEventListener('click', addDeliveryMethod);
            document.getElementById('saveMethodBtn').addEventListener('click', saveEditedMethod);
            document.getElementById('cancelEdit').addEventListener('click', cancelEdit);
            
            const methodInput = document.getElementById('methodInput');
            if (methodInput) {
                methodInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter' && !e.shiftKey) {
                        e.preventDefault();
                        if (currentEditIndex === -1) {
                            addDeliveryMethod();
                        } else {
                            saveEditedMethod();
                        }
                    }
                });
            }

            // Section C: Frais
            const feesTextarea = document.getElementById('feesInfo');
            if (feesTextarea) {
                feesTextarea.addEventListener('input', debounce(() => {
                    updateFeesInfo();
                }, 1000));
            }

            // Section D: Délais
            const delaysTextarea = document.getElementById('delays');
            if (delaysTextarea) {
                delaysTextarea.addEventListener('input', debounce(() => {
                    updateDelays();
                }, 1000));
            }

            // Section E: Code
            const codeTextarea = document.getElementById('codeExplanation');
            if (codeTextarea) {
                codeTextarea.addEventListener('input', debounce(() => {
                    updateCodeExplanation();
                }, 1000));
            }

            // Section F: Responsabilités
            const responsibilitiesTextarea = document.getElementById('responsibilities');
            if (responsibilitiesTextarea) {
                responsibilitiesTextarea.addEventListener('input', debounce(() => {
                    updateResponsibilities();
                }, 1000));
            }

            // Bouton Actualiser
            document.getElementById('refreshBtn').addEventListener('click', () => {
                loadDeliveryPolicy();
                showToast('Actualisation en cours...');
            });

            // Modal de confirmation
            document.getElementById('modalCancel').addEventListener('click', hideModal);
            document.getElementById('modalConfirm').addEventListener('click', executeModalAction);
        }

        // ============================================
        // FONCTIONS PRINCIPALES
        // ============================================

        async function loadDeliveryPolicy() {
            showLoading(true);
            updateConnectionStatus('loading');
            
            try {
                if (!db) {
                    throw new Error('Base de données non initialisée');
                }
                
                const docRef = db.collection('legal_pages').doc('delivery_policy');
                const doc = await docRef.get();
                
                if (doc.exists) {
                    deliveryData = doc.data();
                    
                    // Remplir les champs
                    document.getElementById('introduction').value = deliveryData.introduction || '';
                    document.getElementById('feesInfo').value = deliveryData.feesInfo || '';
                    document.getElementById('delays').value = deliveryData.delays || '';
                    document.getElementById('codeExplanation').value = deliveryData.codeExplanation || '';
                    document.getElementById('responsibilities').value = deliveryData.responsibilities || '';
                    
                    // Mettre à jour la liste des méthodes
                    updateMethodsList(deliveryData.deliveryMethods || []);
                    
                    // Mettre à jour le timestamp
                    updateLastUpdated();
                    
                    // Réinitialiser les états "sale"
                    isDirty = {};
                    updateAllStatusIndicators('saved');
                    
                    showToast('Données chargées avec succès', 'success');
                    updateConnectionStatus('connected');
                } else {
                    // Document non trouvé, création d'une structure vide
                    deliveryData = {
                        introduction: '',
                        deliveryMethods: [],
                        feesInfo: '',
                        delays: '',
                        codeExplanation: '',
                        responsibilities: ''
                    };
                    
                    await docRef.set(deliveryData);
                    showToast('Nouveau document créé', 'success');
                    loadDeliveryPolicy(); // Recharger pour afficher
                }
            } catch (error) {
                console.error('Erreur lors du chargement:', error);
                showToast('Erreur lors du chargement des données: ' + error.message, 'error');
                updateConnectionStatus('error');
                
                // Afficher un état de secours
                if (error.code === 'permission-denied') {
                    showToast('Permission refusée. Vérifiez les règles Firestore.', 'error');
                }
            } finally {
                showLoading(false);
            }
        }

        async function updateIntroduction() {
            const content = document.getElementById('introduction').value;
            await updateField('introduction', content, 'introStatus');
        }

        async function updateFeesInfo() {
            const content = document.getElementById('feesInfo').value;
            await updateField('feesInfo', content, 'feesStatus');
        }

        async function updateDelays() {
            const content = document.getElementById('delays').value;
            await updateField('delays', content, 'delaysStatus');
        }

        async function updateCodeExplanation() {
            const content = document.getElementById('codeExplanation').value;
            await updateField('codeExplanation', content, 'codeStatus');
        }

        async function updateResponsibilities() {
            const content = document.getElementById('responsibilities').value;
            await updateField('responsibilities', content, 'responsibilitiesStatus');
        }

        async function updateField(field, value, statusId) {
            if (!deliveryData || deliveryData[field] === value) return;
            
            isDirty[field] = true;
            updateStatusIndicator(statusId, 'saving');
            
            try {
                await db.collection('legal_pages').doc('delivery_policy').update({
                    [field]: value
                });
                
                deliveryData[field] = value;
                isDirty[field] = false;
                updateStatusIndicator(statusId, 'saved');
                updateLastUpdated();
                
                // Toast pour les changements importants
                const fieldNames = {
                    'introduction': 'Introduction',
                    'feesInfo': 'Frais de livraison',
                    'delays': 'Délais de livraison',
                    'codeExplanation': 'Code de livraison',
                    'responsibilities': 'Responsabilités'
                };
                
                showToast(`${fieldNames[field]} mis à jour`, 'success');
            } catch (error) {
                console.error(`Erreur lors de la mise à jour de ${field}:`, error);
                updateStatusIndicator(statusId, 'error');
                showToast(`Erreur lors de la mise à jour: ${error.message}`, 'error');
            }
        }

        // ============================================
        // GESTION DES MODES DE LIVRAISON (SECTION B)
        // ============================================

        function updateMethodsList(methods) {
            const container = document.getElementById('methodsList');
            if (!container) return;
            
            if (!methods || methods.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-8 text-gray-500">
                        <i class="fas fa-truck text-4xl mb-4 opacity-20"></i>
                        <p>Aucun mode de livraison défini</p>
                        <p class="text-sm mt-2">Ajoutez votre premier mode de livraison ci-dessous</p>
                    </div>
                `;
                return;
            }

            let html = '';
            methods.forEach((method, index) => {
                html += `
                    <div class="method-item flex items-center justify-between" data-index="${index}">
                        <div class="flex items-center flex-1">
                            <div class="drag-handle mr-3 p-2 cursor-move" draggable="true">
                                <i class="fas fa-grip-vertical text-gray-400"></i>
                            </div>
                            <div class="flex-1">
                                <p class="text-gray-800">${escapeHtml(method)}</p>
                                <p class="text-xs text-gray-500 mt-1">Position ${index + 1}</p>
                            </div>
                        </div>
                        <div class="flex space-x-2 ml-4">
                            <button class="edit-method-btn p-2 text-blue-600 hover:text-blue-800 bg-transparent border-none cursor-pointer" data-index="${index}">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="delete-method-btn p-2 text-red-600 hover:text-red-800 bg-transparent border-none cursor-pointer" data-index="${index}">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                `;
            });

            container.innerHTML = html;
            
            // Ajouter les événements aux boutons
            document.querySelectorAll('.edit-method-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const index = parseInt(e.currentTarget.getAttribute('data-index'));
                    editDeliveryMethod(index);
                });
            });

            document.querySelectorAll('.delete-method-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const index = parseInt(e.currentTarget.getAttribute('data-index'));
                    confirmDeleteMethod(index);
                });
            });
            
            // Initialiser le drag & drop
            initDragAndDrop();
        }

        async function addDeliveryMethod() {
            const input = document.getElementById('methodInput');
            const method = input.value.trim();
            
            if (!method) {
                showToast('Veuillez saisir un mode de livraison', 'error');
                input.focus();
                return;
            }
            
            const methods = [...(deliveryData.deliveryMethods || [])];
            methods.push(method);
            
            await updateDeliveryMethods(methods);
            input.value = '';
            input.focus();
        }

        function editDeliveryMethod(index) {
            const methods = deliveryData.deliveryMethods || [];
            if (index < 0 || index >= methods.length) return;
            
            currentEditIndex = index;
            document.getElementById('methodInput').value = methods[index];
            
            // Changer l'interface
            document.getElementById('formTitle').textContent = 'Modifier le mode de livraison';
            document.getElementById('addMethodBtn').classList.add('hidden');
            document.getElementById('saveMethodBtn').classList.remove('hidden');
            document.getElementById('editControls').classList.remove('hidden');
            
            document.getElementById('methodInput').focus();
        }

        function cancelEdit() {
            currentEditIndex = -1;
            document.getElementById('methodInput').value = '';
            
            // Réinitialiser l'interface
            document.getElementById('formTitle').textContent = 'Ajouter un nouveau mode de livraison';
            document.getElementById('addMethodBtn').classList.remove('hidden');
            document.getElementById('saveMethodBtn').classList.add('hidden');
            document.getElementById('editControls').classList.add('hidden');
        }

        async function saveEditedMethod() {
            const input = document.getElementById('methodInput');
            const method = input.value.trim();
            
            if (!method) {
                showToast('Veuillez saisir un mode de livraison', 'error');
                return;
            }
            
            const methods = [...(deliveryData.deliveryMethods || [])];
            if (currentEditIndex >= 0 && currentEditIndex < methods.length) {
                methods[currentEditIndex] = method;
            }
            
            await updateDeliveryMethods(methods);
            cancelEdit();
        }

        function confirmDeleteMethod(index) {
            const methods = deliveryData.deliveryMethods || [];
            if (index < 0 || index >= methods.length) return;
            
            const method = methods[index];
            showModal(
                'Supprimer le mode de livraison',
                `Êtes-vous sûr de vouloir supprimer : "${truncateText(method, 50)}" ?`,
                () => deleteDeliveryMethod(index)
            );
        }

        async function deleteDeliveryMethod(index) {
            const methods = [...(deliveryData.deliveryMethods || [])];
            if (index < 0 || index >= methods.length) return;
            
            methods.splice(index, 1);
            await updateDeliveryMethods(methods);
        }

        async function updateDeliveryMethods(methods) {
            updateStatusIndicator('methodsStatus', 'saving');
            
            try {
                await db.collection('legal_pages').doc('delivery_policy').update({
                    deliveryMethods: methods
                });
                
                deliveryData.deliveryMethods = methods;
                updateMethodsList(methods);
                updateStatusIndicator('methodsStatus', 'saved');
                updateLastUpdated();
                
                showToast('Liste des modes de livraison mise à jour', 'success');
            } catch (error) {
                console.error('Erreur lors de la mise à jour des méthodes:', error);
                updateStatusIndicator('methodsStatus', 'error');
                showToast('Erreur lors de la mise à jour: ' + error.message, 'error');
            }
        }

        // ============================================
        // DRAG & DROP SIMPLIFIÉ
        // ============================================

        function initDragAndDrop() {
            const dragHandles = document.querySelectorAll('.drag-handle');
            
            dragHandles.forEach(handle => {
                handle.addEventListener('dragstart', handleDragStart);
                handle.addEventListener('dragover', handleDragOver);
                handle.addEventListener('drop', handleDrop);
                handle.addEventListener('dragend', handleDragEnd);
            });
        }

        function handleDragStart(e) {
            dragSource = this.closest('.method-item');
            dragSource.classList.add('dragging');
            e.dataTransfer.setData('text/plain', dragSource.getAttribute('data-index'));
        }

        function handleDragOver(e) {
            e.preventDefault();
        }

        function handleDrop(e) {
            e.preventDefault();
            const target = this.closest('.method-item');
            
            if (dragSource && target && dragSource !== target) {
                const sourceIndex = parseInt(dragSource.getAttribute('data-index'));
                const targetIndex = parseInt(target.getAttribute('data-index'));
                
                // Réorganiser le tableau
                const methods = [...deliveryData.deliveryMethods];
                const [movedItem] = methods.splice(sourceIndex, 1);
                methods.splice(targetIndex, 0, movedItem);
                
                // Mettre à jour Firebase
                updateDeliveryMethods(methods);
            }
        }

        function handleDragEnd() {
            if (dragSource) {
                dragSource.classList.remove('dragging');
                dragSource = null;
            }
        }

        // ============================================
        // UTILITAIRES
        // ============================================

        function updateConnectionStatus(status) {
            const element = document.getElementById('connectionStatus');
            if (!element) return;
            
            element.className = 'status-indicator ';
            
            switch(status) {
                case 'connected':
                    element.classList.add('status-saved');
                    element.innerHTML = '<i class="fas fa-circle text-xs mr-2"></i><span>Connecté</span>';
                    break;
                case 'loading':
                    element.classList.add('status-saving');
                    element.innerHTML = '<i class="fas fa-circle text-xs mr-2"></i><span>Connexion...</span>';
                    break;
                case 'error':
                    element.classList.add('status-error');
                    element.innerHTML = '<i class="fas fa-circle text-xs mr-2"></i><span>Hors ligne</span>';
                    break;
            }
        }

        function updateAllStatusIndicators(status) {
            const sections = ['intro', 'methods', 'fees', 'delays', 'code', 'responsibilities'];
            sections.forEach(section => {
                updateStatusIndicator(`${section}Status`, status);
            });
        }

        function updateStatusIndicator(id, status) {
            const element = document.getElementById(id);
            if (!element) return;
            
            element.className = 'status-indicator';
            
            switch(status) {
                case 'saving':
                    element.classList.add('status-saving');
                    element.innerHTML = '<i class="fas fa-circle text-xs mr-2"></i><span>Sauvegarde...</span>';
                    element.classList.remove('hidden');
                    break;
                case 'saved':
                    element.classList.add('status-saved');
                    element.innerHTML = '<i class="fas fa-circle text-xs mr-2"></i><span>Sauvegardé</span>';
                    element.classList.remove('hidden');
                    break;
                case 'error':
                    element.classList.add('status-error');
                    element.innerHTML = '<i class="fas fa-circle text-xs mr-2"></i><span>Erreur</span>';
                    element.classList.remove('hidden');
                    break;
                case 'hidden':
                    element.classList.add('hidden');
                    break;
            }
        }

        function updateLastUpdated() {
            const now = new Date();
            const element = document.getElementById('lastUpdate');
            if (element) {
                element.textContent = `Dernière mise à jour : ${now.toLocaleTimeString('fr-FR')}`;
            }
        }

        function showLoading(show) {
            const overlay = document.getElementById('loadingOverlay');
            if (overlay) {
                if (show) {
                    overlay.classList.remove('hidden');
                } else {
                    overlay.classList.add('hidden');
                }
            }
        }

        function showToast(message, type = 'info') {
            const toast = document.getElementById('toast');
            const icon = document.getElementById('toastIcon');
            const messageElement = document.getElementById('toastMessage');
            
            if (!toast) return;
            
            // Configurer le toast
            toast.className = 'toast';
            if (type === 'error') {
                toast.classList.add('error');
            } else if (type === 'success') {
                toast.classList.add('success');
            }
            
            // Changer l'icône
            icon.className = type === 'error' ? 'fas fa-exclamation-circle mr-2' : 
                           type === 'success' ? 'fas fa-check-circle mr-2' : 
                           'fas fa-info-circle mr-2';
            
            messageElement.textContent = message;
            
            // Afficher
            toast.classList.remove('hidden');
            setTimeout(() => toast.classList.add('show'), 10);
            
            // Cacher après 3 secondes
            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => toast.classList.add('hidden'), 300);
            }, 3000);
        }

        function showModal(title, message, confirmCallback) {
            document.getElementById('modalTitle').textContent = title;
            document.getElementById('modalMessage').textContent = message;
            
            const modal = document.getElementById('confirmModal');
            modal.classList.remove('hidden');
            
            // Stocker le callback
            modal._confirmCallback = confirmCallback;
        }

        function hideModal() {
            const modal = document.getElementById('confirmModal');
            modal.classList.add('hidden');
            modal._confirmCallback = null;
        }

        function executeModalAction() {
            const modal = document.getElementById('confirmModal');
            if (modal._confirmCallback) {
                modal._confirmCallback();
            }
            hideModal();
        }

        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function truncateText(text, maxLength) {
            if (text.length <= maxLength) return text;
            return text.substring(0, maxLength) + '...';
        }

        // ============================================
        // DÉPANNAGE & DEBUG
        // ============================================
        
        // Fonction pour tester manuellement la connexion
        window.testFirebaseConnection = async function() {
            try {
                showToast('Test de connexion en cours...');
                const testRef = db.collection('legal_pages').doc('delivery_policy');
                const doc = await testRef.get();
                
                if (doc.exists) {
                    showToast('Connexion Firestore OK', 'success');
                    return true;
                } else {
                    showToast('Document non trouvé', 'warning');
                    return false;
                }
            } catch (error) {
                showToast('Erreur de connexion: ' + error.message, 'error');
                return false;
            }
        };

        // Afficher les données actuelles dans la console
        window.showData = function() {
            console.log('Données actuelles:', deliveryData);
            showToast('Données affichées dans la console', 'info');
        };

        // Réinitialiser les données
        window.resetData = async function() {
            if (confirm('Voulez-vous vraiment réinitialiser toutes les données ?')) {
                try {
                    await db.collection('legal_pages').doc('delivery_policy').delete();
                    showToast('Données supprimées, rechargement...', 'success');
                    setTimeout(() => {
                        location.reload();
                    }, 2000);
                } catch (error) {
                    showToast('Erreur: ' + error.message, 'error');
                }
            }
        };

        console.log('Admin Politique de Livraison prêt');
        
        // Exporter l'API pour débogage
        window.deliveryAdmin = {
            loadDeliveryPolicy,
            updateIntroduction,
            updateDeliveryMethods,
            updateFeesInfo,
            updateDelays,
            updateCodeExplanation,
            updateResponsibilities,
            getData: () => deliveryData,
            testConnection: window.testFirebaseConnection
        };
    </script>
</body>
</html>