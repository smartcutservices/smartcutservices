<!DOCTYPE html>
<html lang="fr" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Admin | Gestion des Produits -Smart cut services</title>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    
    <style>
        :root {
            --primary-admin: #4f46e5;
            --primary-admin-dark: #4338ca;
            --secondary-admin: #10b981;
            --danger-admin: #ef4444;
            --warning-admin: #f59e0b;
            --success-admin: #10b981;
            --bg-admin: #f8fafc;
        }
        
        * {
            font-family: 'Inter', system-ui, -apple-system, sans-serif;
            box-sizing: border-box;
        }
        
        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: #a1a1a1;
        }
        
        /* Animation for toasts */
        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        @keyframes slideOut {
            from {
                transform: translateX(0);
                opacity: 1;
            }
            to {
                transform: translateX(100%);
                opacity: 0;
            }
        }
        
        /* Animation for modal */
        @keyframes modalFadeIn {
            from {
                opacity: 0;
                transform: scale(0.95);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }
        
        /* Skeleton loading */
        .skeleton {
            background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
            background-size: 200% 100%;
            animation: loading 1.5s infinite;
        }
        
        @keyframes loading {
            0% {
                background-position: 200% 0;
            }
            100% {
                background-position: -200% 0;
            }
        }
        
        /* Status badges */
        .status-badge {
            display: inline-flex;
            align-items: center;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.025em;
        }
        
        .status-available {
            background-color: #d1fae5;
            color: #065f46;
        }
        
        .status-unavailable {
            background-color: #fee2e2;
            color: #991b1b;
        }
        
        .status-low-stock {
            background-color: #fef3c7;
            color: #92400e;
        }
        
        /* Form transitions */
        .form-section {
            transition: all 0.3s ease;
        }
        
        .form-section.collapsed {
            max-height: 0;
            opacity: 0;
            overflow: hidden;
            margin: 0;
            padding: 0;
        }
        
        /* Table row hover */
        .product-row {
            transition: all 0.2s ease;
        }
        
        .product-row:hover {
            background-color: #f8fafc;
            transform: translateY(-1px);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- Admin Container -->
    <div id="admin-container" class="min-h-screen flex flex-col">
        
        <!-- Admin Header -->
        <header class="bg-gradient-to-r from-indigo-600 to-purple-700 text-white shadow-lg">
            <div class="container mx-auto px-4 py-4">
                <div class="flex flex-col md:flex-row md:items-center justify-between">
                    <!-- Logo and Title -->
                    <div class="flex items-center space-x-3 mb-4 md:mb-0">
                        <div class="w-10 h-10 bg-white rounded-lg flex items-center justify-center">
                            <i class="fas fa-cogs text-indigo-600 text-xl"></i>
                        </div>
                        <div>
                            <h1 class="text-xl font-bold">Dashboard Admin</h1>
                            <p class="text-indigo-200 text-sm">Gestion des produits •Smart cut services</p>
                        </div>
                    </div>
                    
                    <!-- Admin Info -->
                    <div class="flex items-center space-x-4">
                        <div class="text-right hidden md:block">
                            <p class="text-sm text-indigo-200">Connecté en tant que</p>
                            <p class="font-medium">Administrateur</p>
                        </div>
                        <button 
                            onclick="window.location.href = '../index.html'"
                            class="px-4 py-2 bg-white/20 hover:bg-white/30 rounded-lg transition-colors duration-200 flex items-center"
                        >
                            <i class="fas fa-store mr-2"></i>
                            Voir la boutique
                        </button>
                    </div>
                </div>
            </div>
        </header>
        
        <!-- Main Content -->
        <main class="flex-grow container mx-auto px-4 py-8">
            <!-- Page Title and Stats -->
            <div class="mb-8">
                <div class="flex flex-col md:flex-row md:items-center justify-between mb-6">
                    <div>
                        <h2 class="text-2xl font-bold text-gray-800">Gestion des Produits</h2>
                        <p class="text-gray-600">Créez, modifiez et gérez les produits du catalogue</p>
                    </div>
                    <button 
                        id="create-product-btn"
                        class="mt-4 md:mt-0 px-6 py-3 bg-indigo-600 hover:bg-indigo-700 text-white font-medium rounded-lg transition-colors duration-300 flex items-center"
                    >
                        <i class="fas fa-plus-circle mr-2"></i>
                        Nouveau produit
                    </button>
                </div>
                
                <!-- Stats Cards -->
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                    <div class="bg-white rounded-xl shadow p-4">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-gray-500">Total produits</p>
                                <p id="total-products" class="text-2xl font-bold text-gray-800">0</p>
                            </div>
                            <div class="w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center">
                                <i class="fas fa-boxes text-blue-600 text-xl"></i>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-white rounded-xl shadow p-4">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-gray-500">Disponibles</p>
                                <p id="available-products" class="text-2xl font-bold text-green-600">0</p>
                            </div>
                            <div class="w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center">
                                <i class="fas fa-check-circle text-green-600 text-xl"></i>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-white rounded-xl shadow p-4">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-gray-500">Stock bas</p>
                                <p id="low-stock-products" class="text-2xl font-bold text-yellow-600">0</p>
                            </div>
                            <div class="w-12 h-12 bg-yellow-100 rounded-lg flex items-center justify-center">
                                <i class="fas fa-exclamation-triangle text-yellow-600 text-xl"></i>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-white rounded-xl shadow p-4">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-gray-500">Nouveautés</p>
                                <p id="new-products" class="text-2xl font-bold text-purple-600">0</p>
                            </div>
                            <div class="w-12 h-12 bg-purple-100 rounded-lg flex items-center justify-center">
                                <i class="fas fa-star text-purple-600 text-xl"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Search and Filters -->
            <div class="bg-white rounded-xl shadow-md p-6 mb-6">
                <div class="flex flex-col md:flex-row md:items-center justify-between space-y-4 md:space-y-0">
                    <!-- Search -->
                    <div class="flex-grow md:mr-6">
                        <div class="relative">
                            <input 
                                type="text" 
                                id="search-input"
                                placeholder="Rechercher un produit par nom ou catégorie..."
                                class="w-full px-4 py-3 pl-12 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-all duration-300"
                            >
                            <i class="fas fa-search absolute left-4 top-3.5 text-gray-400"></i>
                        </div>
                    </div>
                    
                    <!-- Filters -->
                    <div class="flex flex-wrap gap-2">
                        <button 
                            onclick="filterProducts('all')"
                            class="filter-btn px-4 py-2 bg-indigo-600 text-white rounded-lg transition-colors duration-300"
                            data-filter="all"
                        >
                            Tous
                        </button>
                        <button 
                            onclick="filterProducts('available')"
                            class="filter-btn px-4 py-2 bg-gray-100 hover:bg-gray-200 rounded-lg transition-colors duration-300"
                            data-filter="available"
                        >
                            Disponibles
                        </button>
                        <button 
                            onclick="filterProducts('unavailable')"
                            class="filter-btn px-4 py-2 bg-gray-100 hover:bg-gray-200 rounded-lg transition-colors duration-300"
                            data-filter="unavailable"
                        >
                            Indisponibles
                        </button>
                        <button 
                            onclick="filterProducts('new')"
                            class="filter-btn px-4 py-2 bg-gray-100 hover:bg-gray-200 rounded-lg transition-colors duration-300"
                            data-filter="new"
                        >
                            Nouveautés
                        </button>
                        <button 
                            onclick="filterProducts('popular')"
                            class="filter-btn px-4 py-2 bg-gray-100 hover:bg-gray-200 rounded-lg transition-colors duration-300"
                            data-filter="popular"
                        >
                            Populaires
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Products Table -->
            <div class="bg-white rounded-xl shadow-md overflow-hidden mb-8">
                <!-- Table Header -->
                <div class="px-6 py-4 border-b border-gray-200">
                    <div class="flex items-center justify-between">
                        <h3 class="font-semibold text-gray-800">Liste des produits</h3>
                        <div class="text-sm text-gray-500">
                            <span id="product-count">0</span> produit(s)
                        </div>
                    </div>
                </div>
                
                <!-- Loading State -->
                <div id="loading-state" class="p-8" style="display: none;">
                    <div class="flex flex-col items-center justify-center">
                        <div class="w-16 h-16 border-4 border-indigo-600 border-t-transparent rounded-full animate-spin mb-4"></div>
                        <p class="text-gray-600">Chargement des produits...</p>
                    </div>
                </div>
                
                <!-- Empty State -->
                <div id="empty-state" class="hidden p-12 text-center">
                    <i class="fas fa-box-open text-6xl text-gray-300 mb-4"></i>
                    <h3 class="text-xl font-semibold text-gray-700 mb-2">Aucun produit trouvé</h3>
                    <p class="text-gray-500 mb-6">Commencez par créer votre premier produit.</p>
                    <button 
                        id="create-first-product"
                        class="px-6 py-3 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors duration-300 flex items-center mx-auto"
                    >
                        <i class="fas fa-plus-circle mr-2"></i>
                        Créer un produit
                    </button>
                </div>
                
                <!-- Error State -->
                <div id="error-state" class="hidden p-12 text-center">
                    <i class="fas fa-exclamation-triangle text-6xl text-red-300 mb-4"></i>
                    <h3 class="text-xl font-semibold text-gray-700 mb-2">Erreur de chargement</h3>
                    <p class="text-gray-500 mb-4" id="error-message">Impossible de charger les produits</p>
                    <button 
                        onclick="loadProducts()"
                        class="px-6 py-3 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors duration-300"
                    >
                        <i class="fas fa-redo mr-2"></i> Réessayer
                    </button>
                </div>
                
                <!-- Products Table -->
                <div id="products-table" class="hidden overflow-x-auto">
                    <table class="w-full">
                        <thead>
                            <tr class="bg-gray-50 text-gray-700 text-sm uppercase tracking-wider">
                                <th class="px-6 py-4 text-left">Produit</th>
                                <th class="px-6 py-4 text-left">Catégorie</th>
                                <th class="px-6 py-4 text-left">Prix</th>
                                <th class="px-6 py-4 text-left">Stock</th>
                                <th class="px-6 py-4 text-left">Statut</th>
                                <th class="px-6 py-4 text-left">Options</th>
                                <th class="px-6 py-4 text-left">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="products-tbody" class="divide-y divide-gray-200">
                            <!-- Products will be loaded here -->
                        </tbody>
                    </table>
                </div>
                
                <!-- Products Grid (Mobile) -->
                <div id="products-grid" class="hidden grid grid-cols-1 gap-6 p-6">
                    <!-- Products cards will be loaded here for mobile -->
                </div>
            </div>
        </main>
        
        <!-- Footer -->
        <footer class="bg-white border-t border-gray-200 py-6">
            <div class="container mx-auto px-4">
                <div class="flex flex-col md:flex-row justify-between items-center">
                    <div class="mb-4 md:mb-0">
                        <div class="flex items-center space-x-2">
                            <div class="w-8 h-8 bg-indigo-600 rounded-lg flex items-center justify-center">
                                <i class="fas fa-cogs text-white"></i>
                            </div>
                            <span class="font-bold text-gray-800">Dashboard Admin</span>
                        </div>
                        <p class="text-gray-600 text-sm mt-1">Gestion des produits •Smart cut services</p>
                    </div>
                    
                    <div class="text-center md:text-right">
                        <p class="text-gray-500 text-sm">&copy; <span id="current-year">2026</span>Smart cut services. Administration réservée.</p>
                        <p class="text-gray-500 text-sm">Dernière synchronisation: <span id="last-sync">--:--</span></p>
                    </div>
                </div>
            </div>
        </footer>
    </div>
    
    <!-- Product Modal (Create/Edit) -->
    <div id="product-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 overflow-y-auto">
        <div class="min-h-screen flex items-center justify-center p-4">
            <div class="bg-white rounded-2xl shadow-2xl w-full max-w-4xl max-h-[90vh] overflow-hidden">
                <!-- Modal Header -->
                <div class="px-8 py-6 border-b border-gray-200">
                    <div class="flex items-center justify-between">
                        <h3 id="modal-title" class="text-2xl font-bold text-gray-800">Nouveau produit</h3>
                        <button 
                            onclick="closeModal()"
                            class="text-gray-400 hover:text-gray-600 transition-colors duration-200"
                        >
                            <i class="fas fa-times text-2xl"></i>
                        </button>
                    </div>
                </div>
                
                <!-- Modal Content -->
                <div class="overflow-y-auto max-h-[60vh]">
                    <form id="product-form" class="p-8">
                        <!-- Basic Information -->
                        <div class="form-section mb-8">
                            <h4 class="text-lg font-semibold text-gray-800 mb-4 flex items-center">
                                <i class="fas fa-info-circle mr-2 text-indigo-600"></i>
                                Informations de base
                            </h4>
                            <div class="grid md:grid-cols-2 gap-6">
                                <!-- Name -->
                                <div>
                                    <label for="product-name" class="block text-sm font-medium text-gray-700 mb-2">
                                        Nom du produit *
                                    </label>
                                    <input 
                                        type="text" 
                                        id="product-name"
                                        required
                                        class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-all duration-300"
                                        placeholder="Ex: T-shirt Premium"
                                    >
                                </div>
                                
                                <!-- Category -->
                                <div>
                                    <label for="product-category" class="block text-sm font-medium text-gray-700 mb-2">
                                        Catégorie *
                                    </label>
                                    <input 
                                        type="text" 
                                        id="product-category"
                                        required
                                        class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-all duration-300"
                                        placeholder="Ex: Vêtements"
                                    >
                                </div>
                                
                                <!-- Description -->
                                <div class="md:col-span-2">
                                    <label for="product-description" class="block text-sm font-medium text-gray-700 mb-2">
                                        Description *
                                    </label>
                                    <textarea 
                                        id="product-description"
                                        required
                                        rows="3"
                                        class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-all duration-300"
                                        placeholder="Décrivez le produit..."
                                    ></textarea>
                                </div>
                                
                                <!-- Image URL -->
                                <div class="md:col-span-2">
                                    <label for="product-image" class="block text-sm font-medium text-gray-700 mb-2">
                                        URL de l'image *
                                    </label>
                                    <input 
                                        type="text" 
                                        id="product-image"
                                        required
                                        class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-all duration-300"
                                        placeholder="https://example.com/image.jpg"
                                    >
                                    <p class="text-sm text-gray-500 mt-2">
                                        Assurez-vous que l'URL est accessible publiquement
                                    </p>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Pricing -->
                        <div class="form-section mb-8">
                            <h4 class="text-lg font-semibold text-gray-800 mb-4 flex items-center">
                                <i class="fas fa-tag mr-2 text-indigo-600"></i>
                                Tarification
                            </h4>
                            <div class="grid md:grid-cols-2 gap-6">
                                <!-- Price -->
                                <div>
                                    <label for="product-price" class="block text-sm font-medium text-gray-700 mb-2">
                                        Prix actuel (HTG) *
                                    </label>
                                    <input 
                                        type="number" 
                                        id="product-price"
                                        required
                                        min="0"
                                        step="0.01"
                                        class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-all duration-300"
                                    >
                                </div>
                                
                                <!-- Old Price -->
                                <div>
                                    <div class="flex items-center mb-2">
                                        <input 
                                            type="checkbox" 
                                            id="show-old-price"
                                            class="mr-2"
                                            onchange="toggleOldPrice()"
                                        >
                                        <label for="show-old-price" class="text-sm font-medium text-gray-700">
                                            Afficher l'ancien prix
                                        </label>
                                    </div>
                                    <input 
                                        type="number" 
                                        id="product-old-price"
                                        min="0"
                                        step="0.01"
                                        class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-all duration-300 disabled:bg-gray-100 disabled:cursor-not-allowed"
                                        disabled
                                        placeholder="Prix barré"
                                    >
                                </div>
                            </div>
                        </div>
                        
                        <!-- Stock Management -->
                        <div class="form-section mb-8">
                            <h4 class="text-lg font-semibold text-gray-800 mb-4 flex items-center">
                                <i class="fas fa-boxes mr-2 text-indigo-600"></i>
                                Gestion du stock
                            </h4>
                            <div class="grid md:grid-cols-2 gap-6">
                                <!-- Stock Quantity -->
                                <div>
                                    <label for="product-stock" class="block text-sm font-medium text-gray-700 mb-2">
                                        Quantité en stock *
                                    </label>
                                    <input 
                                        type="number" 
                                        id="product-stock"
                                        required
                                        min="0"
                                        class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-all duration-300"
                                    >
                                </div>
                                
                                <!-- Availability -->
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">
                                        Disponibilité
                                    </label>
                                    <div class="flex items-center space-x-4">
                                        <label class="flex items-center">
                                            <input 
                                                type="radio" 
                                                name="availability"
                                                value="true"
                                                checked
                                                class="mr-2"
                                            >
                                            <span class="text-gray-700">Disponible</span>
                                        </label>
                                        <label class="flex items-center">
                                            <input 
                                                type="radio" 
                                                name="availability"
                                                value="false"
                                                class="mr-2"
                                            >
                                            <span class="text-gray-700">Indisponible</span>
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Product Flags -->
                        <div class="form-section mb-8">
                            <h4 class="text-lg font-semibold text-gray-800 mb-4 flex items-center">
                                <i class="fas fa-flag mr-2 text-indigo-600"></i>
                                Drapeaux produit
                            </h4>
                            <div class="grid md:grid-cols-3 gap-4">
                                <label class="flex items-center">
                                    <input 
                                        type="checkbox" 
                                        id="product-new"
                                        class="mr-2"
                                    >
                                    <span class="text-gray-700">Nouveau produit</span>
                                </label>
                                
                                <label class="flex items-center">
                                    <input 
                                        type="checkbox" 
                                        id="product-popular"
                                        class="mr-2"
                                    >
                                    <span class="text-gray-700">Produit populaire</span>
                                </label>
                                
                                <label class="flex items-center">
                                    <input 
                                        type="checkbox" 
                                        id="product-hero"
                                        class="mr-2"
                                    >
                                    <span class="text-gray-700">Afficher dans hero</span>
                                </label>
                            </div>
                        </div>
                        
                        <!-- Logistics -->
                        <div class="form-section mb-8">
                            <h4 class="text-lg font-semibold text-gray-800 mb-4 flex items-center">
                                <i class="fas fa-shipping-fast mr-2 text-indigo-600"></i>
                                Logistique
                            </h4>
                            <div class="grid md:grid-cols-3 gap-6">
                                <!-- Weight -->
                                <div>
                                    <label for="product-weight" class="block text-sm font-medium text-gray-700 mb-2">
                                        Poids (kg) *
                                    </label>
                                    <input 
                                        type="number" 
                                        id="product-weight"
                                        required
                                        min="0"
                                        step="0.1"
                                        class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-all duration-300"
                                    >
                                </div>
                                
                                <!-- Fragile -->
                                <div class="md:col-span-2">
                                    <label class="block text-sm font-medium text-gray-700 mb-2">
                                        Caractéristiques
                                    </label>
                                    <div class="flex items-center space-x-4">
                                        <label class="flex items-center">
                                            <input 
                                                type="checkbox" 
                                                id="product-fragile"
                                                class="mr-2"
                                            >
                                            <span class="text-gray-700">Produit fragile</span>
                                        </label>
                                        
                                        <label class="flex items-center">
                                            <input 
                                                type="checkbox" 
                                                id="product-extra-delivery"
                                                class="mr-2"
                                            >
                                            <span class="text-gray-700">Frais de livraison supplémentaires</span>
                                        </label>
                                    </div>
                                </div>
                                
                                <!-- Extra Delivery Cost -->
                                <div id="extra-delivery-cost-container" class="md:col-span-3 hidden">
                                    <label for="product-extra-delivery-cost" class="block text-sm font-medium text-gray-700 mb-2">
                                        Frais supplémentaires (HTG)
                                    </label>
                                    <input 
                                        type="number" 
                                        id="product-extra-delivery-cost"
                                        min="0"
                                        step="0.01"
                                        class="w-full md:w-1/3 px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-all duration-300"
                                    >
                                </div>
                            </div>
                        </div>
                        
                        <!-- Delivery Options -->
                        <div class="form-section mb-8">
                            <h4 class="text-lg font-semibold text-gray-800 mb-4 flex items-center">
                                <i class="fas fa-truck mr-2 text-indigo-600"></i>
                                Options de livraison
                            </h4>
                            <div class="grid md:grid-cols-3 gap-4">
                                <label class="flex items-center">
                                    <input 
                                        type="checkbox" 
                                        id="delivery-domicile"
                                        class="mr-2"
                                        checked
                                    >
                                    <span class="text-gray-700">Livraison à domicile</span>
                                </label>
                                
                                <label class="flex items-center">
                                    <input 
                                        type="checkbox" 
                                        id="delivery-rencontre"
                                        class="mr-2"
                                        checked
                                    >
                                    <span class="text-gray-700">Point de rencontre</span>
                                </label>
                                
                                <label class="flex items-center">
                                    <input 
                                        type="checkbox" 
                                        id="delivery-point-vente"
                                        class="mr-2"
                                        checked
                                    >
                                    <span class="text-gray-700">Retrait en magasin</span>
                                </label>
                            </div>
                        </div>
                        
                        <!-- Dynamic Options -->
                        <div class="form-section mb-8">
                            <h4 class="text-lg font-semibold text-gray-800 mb-4 flex items-center">
                                <i class="fas fa-sliders-h mr-2 text-indigo-600"></i>
                                Options dynamiques
                            </h4>
                            <div class="space-y-6">
                                <!-- Size Options -->
                                <div>
                                    <div class="flex items-center mb-2">
                                        <input 
                                            type="checkbox" 
                                            id="has-size"
                                            class="mr-2"
                                            onchange="toggleOptionSection('size')"
                                        >
                                        <label for="has-size" class="text-sm font-medium text-gray-700">
                                            Tailles disponibles
                                        </label>
                                    </div>
                                    <div id="size-options-container" class="hidden ml-6 space-y-2">
                                        <label class="block text-sm text-gray-600 mb-2">
                                            Saisissez les tailles, séparées par des virgules
                                        </label>
                                        <input 
                                            type="text" 
                                            id="size-options"
                                            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-all duration-300"
                                            placeholder="Ex: S, M, L, XL"
                                        >
                                    </div>
                                </div>
                                
                                <!-- Color Options -->
                                <div>
                                    <div class="flex items-center mb-2">
                                        <input 
                                            type="checkbox" 
                                            id="has-color"
                                            class="mr-2"
                                            onchange="toggleOptionSection('color')"
                                        >
                                        <label for="has-color" class="text-sm font-medium text-gray-700">
                                            Couleurs disponibles
                                        </label>
                                    </div>
                                    <div id="color-options-container" class="hidden ml-6 space-y-2">
                                        <label class="block text-sm text-gray-600 mb-2">
                                            Saisissez les couleurs, séparées par des virgules
                                        </label>
                                        <input 
                                            type="text" 
                                            id="color-options"
                                            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-all duration-300"
                                            placeholder="Ex: Rouge, Bleu, Vert, Noir"
                                        >
                                    </div>
                                </div>
                                
                                <!-- Personalization -->
                                <div>
                                    <div class="flex items-center mb-2">
                                        <input 
                                            type="checkbox" 
                                            id="has-personalization"
                                            class="mr-2"
                                            onchange="toggleOptionSection('personalization')"
                                        >
                                        <label for="has-personalization" class="text-sm font-medium text-gray-700">
                                            Personnalisation texte
                                        </label>
                                    </div>
                                    <div id="personalization-options-container" class="hidden ml-6 space-y-4">
                                        <div>
                                            <label for="personalization-label" class="block text-sm text-gray-600 mb-1">
                                                Libellé
                                            </label>
                                            <input 
                                                type="text" 
                                                id="personalization-label"
                                                class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-all duration-300"
                                                placeholder="Ex: Texte à graver"
                                            >
                                        </div>
                                        <div>
                                            <label for="personalization-max-chars" class="block text-sm text-gray-600 mb-1">
                                                Nombre maximum de caractères
                                            </label>
                                            <input 
                                                type="number" 
                                                id="personalization-max-chars"
                                                min="1"
                                                max="500"
                                                class="w-full md:w-1/3 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-all duration-300"
                                            >
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Material Options -->
                                <div>
                                    <div class="flex items-center mb-2">
                                        <input 
                                            type="checkbox" 
                                            id="has-material"
                                            class="mr-2"
                                            onchange="toggleOptionSection('material')"
                                        >
                                        <label for="has-material" class="text-sm font-medium text-gray-700">
                                            Matériaux disponibles
                                        </label>
                                    </div>
                                    <div id="material-options-container" class="hidden ml-6 space-y-2">
                                        <label class="block text-sm text-gray-600 mb-2">
                                            Saisissez les matériaux, séparés par des virgules
                                        </label>
                                        <input 
                                            type="text" 
                                            id="material-options"
                                            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-all duration-300"
                                            placeholder="Ex: Coton, Polyester, Laine"
                                        >
                                    </div>
                                </div>
                                
                                <!-- Oz Options -->
                                <div>
                                    <div class="flex items-center mb-2">
                                        <input 
                                            type="checkbox" 
                                            id="has-oz"
                                            class="mr-2"
                                            onchange="toggleOptionSection('oz')"
                                        >
                                        <label for="has-oz" class="text-sm font-medium text-gray-700">
                                            Options poids (oz)
                                        </label>
                                    </div>
                                    <div id="oz-options-container" class="hidden ml-6 space-y-2">
                                        <label class="block text-sm text-gray-600 mb-2">
                                            Saisissez les poids en oz, séparés par des virgules
                                        </label>
                                        <input 
                                            type="text" 
                                            id="oz-options"
                                            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-all duration-300"
                                            placeholder="Ex: 8, 12, 16"
                                        >
                                    </div>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
                
                <!-- Modal Footer -->
                <div class="px-8 py-6 border-t border-gray-200 bg-gray-50">
                    <div class="flex justify-end space-x-4">
                        <button 
                            onclick="closeModal()"
                            class="px-6 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors duration-300"
                        >
                            Annuler
                        </button>
                        <button 
                            type="submit"
                            form="product-form"
                            id="save-product-btn"
                            class="px-6 py-3 bg-indigo-600 hover:bg-indigo-700 text-white font-medium rounded-lg transition-colors duration-300 flex items-center"
                        >
                            <i class="fas fa-save mr-2"></i>
                            Enregistrer le produit
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Toast Container -->
    <div id="toast-container" class="fixed bottom-4 right-4 z-50 flex flex-col space-y-2 max-w-md"></div>
    
    <!-- Confirmation Modal -->
    <div id="confirm-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-md">
            <div class="p-6">
                <div class="flex items-center mb-4">
                    <div class="w-12 h-12 bg-red-100 rounded-full flex items-center justify-center mr-4">
                        <i class="fas fa-exclamation-triangle text-red-600 text-xl"></i>
                    </div>
                    <h3 id="confirm-title" class="text-xl font-bold text-gray-800">Confirmation</h3>
                </div>
                <p id="confirm-message" class="text-gray-600 mb-6">
                    Êtes-vous sûr de vouloir supprimer ce produit ?
                </p>
                <div class="flex justify-end space-x-4">
                    <button 
                        onclick="closeConfirmModal()"
                        class="px-6 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors duration-300"
                    >
                        Annuler
                    </button>
                    <button 
                        id="confirm-action-btn"
                        class="px-6 py-3 bg-red-600 hover:bg-red-700 text-white font-medium rounded-lg transition-colors duration-300"
                    >
                        Confirmer
                    </button>
                </div>
            </div>
        </div>
    </div>
        <!-- ------------------------------------------------------------------------------------------------------------
     ==========================================================================================================
     ==========================================
      --><!-- Bulle de navigation unique -->
<!-- Bulle de navigation unique -->
<div id="navBubbleUniq" class="fixed bottom-4 right-4 z-50 transition-all duration-300">
  <!-- Bouton principal de la bulle -->
  <button id="navBubbleBtnUniq" 
          class="w-14 h-14 md:w-16 md:h-16 bg-gradient-to-br from-indigo-600 to-purple-600 rounded-full shadow-xl hover:shadow-2xl transition-all duration-300 flex items-center justify-center group active:scale-95 focus:outline-none focus:ring-4 focus:ring-indigo-500/30">
    <i class="fas fa-rocket text-white text-xl md:text-2xl group-hover:rotate-90 transition-transform duration-300"></i>
    <span class="absolute -top-2 -right-2 w-6 h-6 bg-red-500 text-white text-xs rounded-full flex items-center justify-center animate-pulse">7</span>
  </button>

  <!-- Menu déroulant -->
  <div id="navBubbleMenuUniq" 
       class="absolute bottom-20 right-0 w-72 bg-white dark:bg-gray-800 rounded-2xl shadow-2xl opacity-0 scale-95 pointer-events-none transition-all duration-300 transform origin-bottom-right border border-gray-100 dark:border-gray-700">
    
    <!-- En-tête du menu -->
    <div class="p-4 border-b border-gray-100 dark:border-gray-700">
      <div class="flex items-center justify-between">
        <h3 class="font-bold text-gray-800 dark:text-white flex items-center gap-2">
          <i class="fas fa-space-shuttle text-indigo-500"></i>
          Navigation Dashboard
        </h3>
        <span class="text-xs px-2 py-1 bg-indigo-100 dark:bg-indigo-900/40 text-indigo-600 dark:text-indigo-300 rounded-full">7 liens</span>
      </div>
      <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">Accès rapide aux sections principales</p>
    </div>

    <!-- Liste des liens -->
    <div class="p-2 space-y-1 max-h-96 overflow-y-auto custom-scrollbar-uniq">
      <!-- Lien Dashboard Accueil -->
      <a href="dashacceuil.html" 
         class="navBubbleLinkUniq flex items-center gap-3 p-3 rounded-xl hover:bg-indigo-50 dark:hover:bg-gray-700 transition-colors duration-200 group focus:outline-none focus:bg-indigo-50 dark:focus:bg-gray-700">
        <div class="w-10 h-10 bg-indigo-100 dark:bg-indigo-900/30 rounded-lg flex items-center justify-center flex-shrink-0">
          <i class="fas fa-home text-indigo-600 dark:text-indigo-400"></i>
        </div>
        <div class="flex-1 min-w-0">
          <p class="font-semibold text-gray-800 dark:text-white truncate">Dashboard Accueil</p>
          <p class="text-xs text-gray-500 dark:text-gray-400 truncate">Tableau de bord principal</p>
        </div>
        <i class="fas fa-chevron-right text-gray-400 group-hover:text-indigo-500 transition-colors flex-shrink-0"></i>
      </a>

      <!-- Lien Confidentialité -->
      <a href="dashconfi.html" 
         class="navBubbleLinkUniq flex items-center gap-3 p-3 rounded-xl hover:bg-blue-50 dark:hover:bg-gray-700 transition-colors duration-200 group focus:outline-none focus:bg-blue-50 dark:focus:bg-gray-700">
        <div class="w-10 h-10 bg-blue-100 dark:bg-blue-900/30 rounded-lg flex items-center justify-center flex-shrink-0">
          <i class="fas fa-shield-alt text-blue-600 dark:text-blue-400"></i>
        </div>
        <div class="flex-1 min-w-0">
          <p class="font-semibold text-gray-800 dark:text-white truncate">Confidentialité</p>
          <p class="text-xs text-gray-500 dark:text-gray-400 truncate">Gestion des données privées</p>
        </div>
        <i class="fas fa-chevron-right text-gray-400 group-hover:text-blue-500 transition-colors flex-shrink-0"></i>
      </a>

      <!-- Lien Livraison -->
      <a href="livraisondash.html" 
         class="navBubbleLinkUniq flex items-center gap-3 p-3 rounded-xl hover:bg-green-50 dark:hover:bg-gray-700 transition-colors duration-200 group focus:outline-none focus:bg-green-50 dark:focus:bg-gray-700">
        <div class="w-10 h-10 bg-green-100 dark:bg-green-900/30 rounded-lg flex items-center justify-center flex-shrink-0">
          <i class="fas fa-shipping-fast text-green-600 dark:text-green-400"></i>
        </div>
        <div class="flex-1 min-w-0">
          <p class="font-semibold text-gray-800 dark:text-white truncate">Dashboard Livraison</p>
          <p class="text-xs text-gray-500 dark:text-gray-400 truncate">Suivi des commandes</p>
        </div>
        <i class="fas fa-chevron-right text-gray-400 group-hover:text-green-500 transition-colors flex-shrink-0"></i>
      </a>

      <!-- Lien Catalogue -->
      <a href="catalogue-admin.html" 
         class="navBubbleLinkUniq flex items-center gap-3 p-3 rounded-xl hover:bg-purple-50 dark:hover:bg-gray-700 transition-colors duration-200 group focus:outline-none focus:bg-purple-50 dark:focus:bg-gray-700">
        <div class="w-10 h-10 bg-purple-100 dark:bg-purple-900/30 rounded-lg flex items-center justify-center flex-shrink-0">
          <i class="fas fa-boxes text-purple-600 dark:text-purple-400"></i>
        </div>
        <div class="flex-1 min-w-0">
          <p class="font-semibold text-gray-800 dark:text-white truncate">Catalogue Admin</p>
          <p class="text-xs text-gray-500 dark:text-gray-400 truncate">Gestion des produits</p>
        </div>
        <i class="fas fa-chevron-right text-gray-400 group-hover:text-purple-500 transition-colors flex-shrink-0"></i>
      </a>

      <!-- Lien Commandes -->
      <a href="panier.html" 
         class="navBubbleLinkUniq flex items-center gap-3 p-3 rounded-xl hover:bg-amber-50 dark:hover:bg-gray-700 transition-colors duration-200 group focus:outline-none focus:bg-amber-50 dark:focus:bg-gray-700">
        <div class="w-10 h-10 bg-amber-100 dark:bg-amber-900/30 rounded-lg flex items-center justify-center flex-shrink-0">
          <i class="fas fa-shopping-cart text-amber-600 dark:text-amber-400"></i>
        </div>
        <div class="flex-1 min-w-0">
          <p class="font-semibold text-gray-800 dark:text-white truncate">Commandes & Panier</p>
          <p class="text-xs text-gray-500 dark:text-gray-400 truncate">Paiements et transactions</p>
        </div>
        <i class="fas fa-chevron-right text-gray-400 group-hover:text-amber-500 transition-colors flex-shrink-0"></i>
      </a>

      <!-- Lien About -->
      <a href="dashabout.html" 
         class="navBubbleLinkUniq flex items-center gap-3 p-3 rounded-xl hover:bg-cyan-50 dark:hover:bg-gray-700 transition-colors duration-200 group focus:outline-none focus:bg-cyan-50 dark:focus:bg-gray-700">
        <div class="w-10 h-10 bg-cyan-100 dark:bg-cyan-900/30 rounded-lg flex items-center justify-center flex-shrink-0">
          <i class="fas fa-info-circle text-cyan-600 dark:text-cyan-400"></i>
        </div>
        <div class="flex-1 min-w-0">
          <p class="font-semibold text-gray-800 dark:text-white truncate">À propos</p>
          <p class="text-xs text-gray-500 dark:text-gray-400 truncate">Informations sur l'application</p>
        </div>
        <i class="fas fa-chevron-right text-gray-400 group-hover:text-cyan-500 transition-colors flex-shrink-0"></i>
      </a>

      <!-- Lien Transfert -->
      <a href="marquee.html" 
         class="navBubbleLinkUniq flex items-center gap-3 p-3 rounded-xl hover:bg-pink-50 dark:hover:bg-gray-700 transition-colors duration-200 group focus:outline-none focus:bg-pink-50 dark:focus:bg-gray-700">
        <div class="w-10 h-10 bg-pink-100 dark:bg-pink-900/30 rounded-lg flex items-center justify-center flex-shrink-0">
          <i class="fas fa-exchange-alt text-pink-600 dark:text-pink-400"></i>
        </div>
        <div class="flex-1 min-w-0">
          <p class="font-semibold text-gray-800 dark:text-white truncate">Transfert</p>
          <p class="text-xs text-gray-500 dark:text-gray-400 truncate">Transferts et transactions</p>
        </div>
        <i class="fas fa-chevron-right text-gray-400 group-hover:text-pink-500 transition-colors flex-shrink-0"></i>
      </a>
    </div>

    <!-- Footer du menu -->
    <div class="p-3 border-t border-gray-100 dark:border-gray-700 bg-gray-50 dark:bg-gray-900/50 rounded-b-2xl">
      <div class="flex items-center justify-between">
        <div class="text-xs text-gray-500 dark:text-gray-400">
          <span class="font-medium">v1.2.0</span>
          <span class="mx-1">•</span>
          <span>Navigation avancée</span>
        </div>
        <button id="navBubbleCloseUniq" 
                class="w-8 h-8 flex items-center justify-center rounded-full hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors focus:outline-none focus:ring-2 focus:ring-indigo-500/50">
          <i class="fas fa-times text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300"></i>
        </button>
      </div>
    </div>
  </div>
</div>

<script>
// Variables globales uniques pour la bulle
let navBubbleDragStateUniq = {
  isDragging: false,
  startX: 0,
  startY: 0,
  startLeft: 0,
  startTop: 0
};

let navBubbleMenuStateUniq = {
  isOpen: false,
  isAnimating: false
};

let navBubbleTouchTimerUniq = null;

// Références aux éléments DOM
const navBubbleContainerUniq = document.getElementById('navBubbleUniq');
const navBubbleToggleUniq = document.getElementById('navBubbleBtnUniq');
const navBubbleDropdownUniq = document.getElementById('navBubbleMenuUniq');
const navBubbleCloseTriggerUniq = document.getElementById('navBubbleCloseUniq');
const navBubbleMenuLinksUniq = document.querySelectorAll('.navBubbleLinkUniq');

// Initialisation de la bulle
function setupNavBubbleUniq() {
  loadNavBubblePositionUniq();
  attachNavBubbleEventsUniq();
  setupNavBubbleAccessibilityUniq();
  animateNavBubbleIntroUniq();
}

// Charger la position sauvegardée
function loadNavBubblePositionUniq() {
  const savedPos = localStorage.getItem('navBubblePositionV2');
  if (savedPos) {
    try {
      const { x, y } = JSON.parse(savedPos);
      const safeX = Math.max(10, Math.min(x, window.innerWidth - 70));
      const safeY = Math.max(10, Math.min(y, window.innerHeight - 70));
      
      navBubbleContainerUniq.style.left = `${safeX}px`;
      navBubbleContainerUniq.style.top = `${safeY}px`;
      navBubbleContainerUniq.style.right = 'auto';
      navBubbleContainerUniq.style.bottom = 'auto';
    } catch (e) {
      console.warn('Position de bulle invalide, utilisation par défaut');
    }
  }
}

// Sauvegarder la position
function saveNavBubblePositionUniq() {
  const rect = navBubbleContainerUniq.getBoundingClientRect();
  localStorage.setItem('navBubblePositionV2', JSON.stringify({
    x: rect.left,
    y: rect.top
  }));
}

// Attacher les événements
function attachNavBubbleEventsUniq() {
  // Événements desktop
  navBubbleToggleUniq.addEventListener('mousedown', startNavBubbleDragDesktopUniq);
  navBubbleToggleUniq.addEventListener('click', handleNavBubbleToggleClickUniq);
  navBubbleCloseTriggerUniq.addEventListener('click', closeNavBubbleMenuUniq);
  
  // Événements mobile touch
  navBubbleToggleUniq.addEventListener('touchstart', startNavBubbleTouchUniq, { passive: false });
  navBubbleToggleUniq.addEventListener('touchmove', handleNavBubbleTouchMoveUniq, { passive: false });
  navBubbleToggleUniq.addEventListener('touchend', endNavBubbleTouchUniq);
  
  // Événements globaux
  document.addEventListener('mousemove', handleNavBubbleDragDesktopUniq);
  document.addEventListener('mouseup', stopNavBubbleDragDesktopUniq);
  document.addEventListener('click', handleDocumentClickNavBubbleUniq);
  document.addEventListener('keydown', handleNavBubbleKeyboardUniq);
  window.addEventListener('resize', handleNavBubbleResizeUniq);
  
  // Prévenir le drag des images dans les liens
  navBubbleMenuLinksUniq.forEach(link => {
    link.addEventListener('dragstart', (e) => e.preventDefault());
  });
}

// Gestion du clic sur le bouton toggle
function handleNavBubbleToggleClickUniq(e) {
  if (navBubbleDragStateUniq.isDragging) {
    navBubbleDragStateUniq.isDragging = false;
    saveNavBubblePositionUniq();
    return;
  }
  
  e.stopPropagation();
  toggleNavBubbleMenuUniq();
}

// Ouvrir/fermer le menu
function toggleNavBubbleMenuUniq() {
  if (navBubbleMenuStateUniq.isAnimating) return;
  
  navBubbleMenuStateUniq.isAnimating = true;
  
  if (navBubbleMenuStateUniq.isOpen) {
    closeNavBubbleMenuUniq();
  } else {
    openNavBubbleMenuUniq();
  }
  
  setTimeout(() => {
    navBubbleMenuStateUniq.isAnimating = false;
  }, 300);
}

// Ouvrir le menu
function openNavBubbleMenuUniq() {
  navBubbleMenuStateUniq.isOpen = true;
  navBubbleDropdownUniq.classList.remove('opacity-0', 'scale-95', 'pointer-events-none');
  navBubbleDropdownUniq.classList.add('opacity-100', 'scale-100', 'pointer-events-auto');
  navBubbleToggleUniq.classList.add('from-purple-600', 'to-pink-600', 'ring-4', 'ring-purple-500/30');
  
  // Feedback haptique sur mobile
  if ('vibrate' in navigator) {
    navigator.vibrate(30);
  }
}

// Fermer le menu
function closeNavBubbleMenuUniq() {
  navBubbleMenuStateUniq.isOpen = false;
  navBubbleDropdownUniq.classList.remove('opacity-100', 'scale-100', 'pointer-events-auto');
  navBubbleDropdownUniq.classList.add('opacity-0', 'scale-95', 'pointer-events-none');
  navBubbleToggleUniq.classList.remove('from-purple-600', 'to-pink-600', 'ring-4', 'ring-purple-500/30');
}

// Drag desktop
function startNavBubbleDragDesktopUniq(e) {
  if (e.button !== 0) return; // Seulement clic gauche
  
  navBubbleDragStateUniq.isDragging = true;
  const rect = navBubbleContainerUniq.getBoundingClientRect();
  
  navBubbleDragStateUniq.startX = e.clientX;
  navBubbleDragStateUniq.startY = e.clientY;
  navBubbleDragStateUniq.startLeft = rect.left;
  navBubbleDragStateUniq.startTop = rect.top;
  
  navBubbleContainerUniq.style.transition = 'none';
  navBubbleContainerUniq.style.cursor = 'grabbing';
  closeNavBubbleMenuUniq();
}

function handleNavBubbleDragDesktopUniq(e) {
  if (!navBubbleDragStateUniq.isDragging) return;
  
  const deltaX = e.clientX - navBubbleDragStateUniq.startX;
  const deltaY = e.clientY - navBubbleDragStateUniq.startY;
  
  let newLeft = navBubbleDragStateUniq.startLeft + deltaX;
  let newTop = navBubbleDragStateUniq.startTop + deltaY;
  
  // Garder dans les limites
  const maxX = window.innerWidth - navBubbleContainerUniq.offsetWidth - 10;
  const maxY = window.innerHeight - navBubbleContainerUniq.offsetHeight - 10;
  
  newLeft = Math.max(10, Math.min(newLeft, maxX));
  newTop = Math.max(10, Math.min(newTop, maxY));
  
  navBubbleContainerUniq.style.left = `${newLeft}px`;
  navBubbleContainerUniq.style.top = `${newTop}px`;
  navBubbleContainerUniq.style.right = 'auto';
  navBubbleContainerUniq.style.bottom = 'auto';
}

function stopNavBubbleDragDesktopUniq() {
  if (!navBubbleDragStateUniq.isDragging) return;
  
  navBubbleDragStateUniq.isDragging = false;
  navBubbleContainerUniq.style.transition = 'all 0.3s cubic-bezier(0.4, 0, 0.2, 1)';
  navBubbleContainerUniq.style.cursor = '';
  saveNavBubblePositionUniq();
}

// Touch mobile
function startNavBubbleTouchUniq(e) {
  if (e.touches.length !== 1) return;
  
  const touch = e.touches[0];
  
  navBubbleTouchTimerUniq = setTimeout(() => {
    // Long press pour drag
    navBubbleDragStateUniq.isDragging = true;
    const rect = navBubbleContainerUniq.getBoundingClientRect();
    
    navBubbleDragStateUniq.startX = touch.clientX;
    navBubbleDragStateUniq.startY = touch.clientY;
    navBubbleDragStateUniq.startLeft = rect.left;
    navBubbleDragStateUniq.startTop = rect.top;
    
    navBubbleContainerUniq.style.transition = 'none';
    closeNavBubbleMenuUniq();
    
    if ('vibrate' in navigator) {
      navigator.vibrate(50);
    }
  }, 500); // 500ms pour long press
}

function handleNavBubbleTouchMoveUniq(e) {
  if (!navBubbleDragStateUniq.isDragging || e.touches.length !== 1) return;
  
  e.preventDefault();
  const touch = e.touches[0];
  
  const deltaX = touch.clientX - navBubbleDragStateUniq.startX;
  const deltaY = touch.clientY - navBubbleDragStateUniq.startY;
  
  let newLeft = navBubbleDragStateUniq.startLeft + deltaX;
  let newTop = navBubbleDragStateUniq.startTop + deltaY;
  
  const maxX = window.innerWidth - navBubbleContainerUniq.offsetWidth - 10;
  const maxY = window.innerHeight - navBubbleContainerUniq.offsetHeight - 10;
  
  newLeft = Math.max(10, Math.min(newLeft, maxX));
  newTop = Math.max(10, Math.min(newTop, maxY));
  
  navBubbleContainerUniq.style.left = `${newLeft}px`;
  navBubbleContainerUniq.style.top = `${newTop}px`;
}

function endNavBubbleTouchUniq() {
  clearTimeout(navBubbleTouchTimerUniq);
  
  if (navBubbleDragStateUniq.isDragging) {
    navBubbleDragStateUniq.isDragging = false;
    navBubbleContainerUniq.style.transition = 'all 0.3s cubic-bezier(0.4, 0, 0.2, 1)';
    saveNavBubblePositionUniq();
  }
}

// Gestion des clics en dehors
function handleDocumentClickNavBubbleUniq(e) {
  if (!navBubbleMenuStateUniq.isOpen) return;
  
  const isClickInside = navBubbleContainerUniq.contains(e.target);
  
  if (!isClickInside) {
    closeNavBubbleMenuUniq();
  }
}

// Gestion du clavier
function handleNavBubbleKeyboardUniq(e) {
  if (e.key === 'Escape' && navBubbleMenuStateUniq.isOpen) {
    closeNavBubbleMenuUniq();
  }
  
  // Navigation au clavier dans le menu
  if (e.key === 'Tab' && navBubbleMenuStateUniq.isOpen) {
    e.preventDefault();
    const currentIndex = Array.from(navBubbleMenuLinksUniq).indexOf(document.activeElement);
    let nextIndex;
    
    if (e.shiftKey) {
      nextIndex = currentIndex > 0 ? currentIndex - 1 : navBubbleMenuLinksUniq.length - 1;
    } else {
      nextIndex = currentIndex < navBubbleMenuLinksUniq.length - 1 ? currentIndex + 1 : 0;
    }
    
    if (navBubbleMenuLinksUniq[nextIndex]) {
      navBubbleMenuLinksUniq[nextIndex].focus();
    }
  }
}

// Redimensionnement
function handleNavBubbleResizeUniq() {
  const rect = navBubbleContainerUniq.getBoundingClientRect();
  const maxX = window.innerWidth - navBubbleContainerUniq.offsetWidth - 10;
  const maxY = window.innerHeight - navBubbleContainerUniq.offsetHeight - 10;
  
  if (rect.left > maxX || rect.top > maxY) {
    // Réinitialiser si hors écran
    navBubbleContainerUniq.style.left = 'auto';
    navBubbleContainerUniq.style.top = 'auto';
    navBubbleContainerUniq.style.right = '1rem';
    navBubbleContainerUniq.style.bottom = '1rem';
    localStorage.removeItem('navBubblePositionV2');
  }
}

// Accessibilité
function setupNavBubbleAccessibilityUniq() {
  navBubbleToggleUniq.setAttribute('aria-label', 'Ouvrir le menu de navigation');
  navBubbleToggleUniq.setAttribute('aria-expanded', 'false');
  navBubbleToggleUniq.setAttribute('role', 'button');
  
  navBubbleDropdownUniq.setAttribute('aria-hidden', 'true');
  navBubbleDropdownUniq.setAttribute('role', 'menu');
  
  navBubbleMenuLinksUniq.forEach((link, index) => {
    link.setAttribute('role', 'menuitem');
    link.setAttribute('tabindex', '-1');
  });
  
  // Mettre à jour les attributs ARIA quand le menu s'ouvre/ferme
  const observerNavBubbleUniq = new MutationObserver((mutations) => {
    mutations.forEach((mutation) => {
      if (mutation.attributeName === 'class') {
        const isOpen = navBubbleDropdownUniq.classList.contains('opacity-100');
        navBubbleToggleUniq.setAttribute('aria-expanded', isOpen.toString());
        navBubbleDropdownUniq.setAttribute('aria-hidden', (!isOpen).toString());
        
        navBubbleMenuLinksUniq.forEach(link => {
          link.setAttribute('tabindex', isOpen ? '0' : '-1');
        });
      }
    });
  });
  
  observerNavBubbleUniq.observe(navBubbleDropdownUniq, {
    attributes: true,
    attributeFilter: ['class']
  });
}

// Animation d'introduction
function animateNavBubbleIntroUniq() {
  navBubbleContainerUniq.classList.add('animate-bounce');
  setTimeout(() => {
    navBubbleContainerUniq.classList.remove('animate-bounce');
  }, 1500);
}

// Initialisation
document.addEventListener('DOMContentLoaded', () => {
  setTimeout(() => {
    setupNavBubbleUniq();
  }, 100);
});
</script>

<style>
/* Styles additionnels pour la bulle de navigation */
.custom-scrollbar-uniq::-webkit-scrollbar {
  width: 6px;
}

.custom-scrollbar-uniq::-webkit-scrollbar-track {
  background: #f1f1f1;
  border-radius: 3px;
}

.custom-scrollbar-uniq::-webkit-scrollbar-thumb {
  background: #c1c1c1;
  border-radius: 3px;
}

.custom-scrollbar-uniq::-webkit-scrollbar-thumb:hover {
  background: #a1a1a1;
}

.dark .custom-scrollbar-uniq::-webkit-scrollbar-track {
  background: #374151;
}

.dark .custom-scrollbar-uniq::-webkit-scrollbar-thumb {
  background: #4b5563;
}

.dark .custom-scrollbar-uniq::-webkit-scrollbar-thumb:hover {
  background: #6b7280;
}

/* Animation de pulse améliorée */
@keyframes navBubblePulseUniq {
  0%, 100% {
    transform: scale(1);
    box-shadow: 0 10px 25px rgba(99, 102, 241, 0.3);
  }
  50% {
    transform: scale(1.05);
    box-shadow: 0 15px 35px rgba(99, 102, 241, 0.5);
  }
}

.animate-pulse {
  animation: navBubblePulseUniq 2s ease-in-out infinite;
}

/* Animation de rebond pour l'introduction */
@keyframes navBubbleBounceUniq {
  0%, 100% {
    transform: translateY(0);
  }
  50% {
    transform: translateY(-20px);
  }
}

.animate-bounce {
  animation: navBubbleBounceUniq 0.5s ease-in-out 3;
}

/* Support du dark mode avancé */
@media (prefers-color-scheme: dark) {
  #navBubbleBtnUniq {
    box-shadow: 0 10px 25px rgba(0, 0, 0, 0.4);
  }
  
  #navBubbleBtnUniq:hover {
    box-shadow: 0 15px 35px rgba(0, 0, 0, 0.6);
  }
}

/* Responsive amélioré */
@media (max-width: 640px) {
  #navBubbleMenuUniq {
    width: calc(100vw - 2rem);
    max-width: 320px;
    right: 50%;
    transform: translateX(50%) scale(0.95);
    transform-origin: bottom center;
  }
  
  #navBubbleMenuUniq.opacity-100 {
    transform: translateX(50%) scale(1);
  }
  
  #navBubbleUniq {
    bottom: 1rem;
    right: 1rem;
  }
}

/* Transition fluide pour le menu */
#navBubbleMenuUniq {
  transition: opacity 0.3s cubic-bezier(0.4, 0, 0.2, 1), 
              transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Focus styles pour accessibilité */
.navBubbleLinkUniq:focus-visible {
  outline: 2px solid #4f46e5;
  outline-offset: -2px;
}

#navBubbleBtnUniq:focus-visible {
  outline: 2px solid #4f46e5;
  outline-offset: 2px;
}
</style>

<!-- =================================================================================================================================================
 ====================================================================================================================================
 ============================================================================================
  -->



    <!-- JavaScript Application -->
   <script>
    // ============================================
    // CONFIGURATION ET INITIALISATION
    // ============================================
    
    // Configuration Firebase
   const firebaseConfig = {
  apiKey: "AIzaSyCOifibU2E6Vo-3Ohg-WmAHa43sa5HyFuw",
  authDomain: "smartcutservices.firebaseapp.com",
  projectId: "smartcutservices",
  storageBucket: "smartcutservices.firebasestorage.app",
  messagingSenderId: "589013273323",
  appId: "1:589013273323:web:415772e7b94f6bb37d8cae",
  measurementId: "G-R8GJXQP7BD"
};

    
    // État global de l'application admin
    const adminState = {
        products: [],
        filteredProducts: [],
        currentFilter: 'all',
        currentProductId: null,
        isLoading: true,
        unsubscribeProducts: null,
        categories: new Set()
    };
    
    // ============================================
    // MODULE 1: INITIALISATION FIREBASE
    // ============================================
    const FirebaseAdminModule = (() => {
        let firebaseApp = null;
        let firestoreDb = null;
        
        /**
         * Initialiser Firebase
         */
        const initializeFirebase = () => {
            try {
                if (!firebase.apps.length) {
                    firebaseApp = firebase.initializeApp(firebaseConfig);
                } else {
                    firebaseApp = firebase.app();
                }
                
                firestoreDb = firebase.firestore();
                console.log('✅ Firebase Admin initialisé');
                return true;
            } catch (error) {
                console.error('❌ Erreur d\'initialisation Firebase:', error);
                showToast('Erreur de connexion à la base de données', 'error');
                return false;
            }
        };
        
        /**
         * Obtenir l'instance Firestore
         */
        const getFirestore = () => {
            if (!firestoreDb) {
                initializeFirebase();
            }
            return firestoreDb;
        };
        
        /**
         * Formater un prix
         */
        const formatPrice = (price) => {
            return new Intl.NumberFormat('fr-HT', {
                style: 'currency',
                currency: 'HTG'
            }).format(price);
        };
        
        return {
            initializeFirebase,
            getFirestore,
            formatPrice
        };
    })();
    
    // ============================================
    // MODULE 2: GESTION DES PRODUITS
    // ============================================
    const ProductManager = (() => {
        /**
         * Charger les produits en temps réel
         */
        const loadProductsRealtime = () => {
            const db = FirebaseAdminModule.getFirestore();
            
            // Se désabonner de l'écoute précédente si elle existe
            if (adminState.unsubscribeProducts) {
                adminState.unsubscribeProducts();
            }
            
            // Écouter les changements en temps réel
            adminState.unsubscribeProducts = db.collection('products')
                .orderBy('createdAt', 'desc')
                .onSnapshot(
                    // Succès
                    (snapshot) => {
                        const products = [];
                        const categories = new Set();
                        let total = 0;
                        let available = 0;
                        let lowStock = 0;
                        let newProducts = 0;
                        
                        snapshot.forEach(doc => {
                            const product = {
                                id: doc.id,
                                ...doc.data()
                            };
                            products.push(product);
                            
                            // Statistiques
                            total++;
                            if (product.isAvailable) available++;
                            if (product.stockQuantity < 10) lowStock++;
                            if (product.isNew) newProducts++;
                            
                            // Catégories uniques
                            if (product.category) {
                                categories.add(product.category);
                            }
                        });
                        
                        // Mettre à jour l'état
                        adminState.products = products;
                        adminState.categories = categories;
                        
                        // Mettre à jour les statistiques
                        updateStats(total, available, lowStock, newProducts);
                        
                        // Appliquer le filtre actuel
                        applyCurrentFilter();
                        
                        // Cacher l'état de chargement
                        hideLoadingState();
                        
                        // Mettre à jour l'heure de synchronisation
                        updateLastSyncTime();
                    },
                    // Erreur
                    (error) => {
                        console.error('❌ Erreur de chargement des produits:', error);
                        showErrorState('Impossible de charger les produits: ' + error.message);
                    }
                );
        };
        
        /**
         * Créer un nouveau produit
         */
        const createProduct = async (productData) => {
            try {
                const db = FirebaseAdminModule.getFirestore();
                
                // Préparer les données du produit
                const product = {
                    ...productData,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                    updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                };
                
                // Ajouter le produit à Firestore
                await db.collection('products').add(product);
                
                showToast('✅ Produit créé avec succès', 'success');
                return true;
                
            } catch (error) {
                console.error('❌ Erreur de création du produit:', error);
                showToast('Erreur lors de la création du produit', 'error');
                return false;
            }
        };
        
        /**
         * Mettre à jour un produit existant
         */
        const updateProduct = async (productId, productData) => {
            try {
                const db = FirebaseAdminModule.getFirestore();
                
                // Préparer les données de mise à jour
                const updateData = {
                    ...productData,
                    updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                };
                
                // Mettre à jour le produit dans Firestore
                await db.collection('products').doc(productId).update(updateData);
                
                showToast('✅ Produit mis à jour avec succès', 'success');
                return true;
                
            } catch (error) {
                console.error('❌ Erreur de mise à jour du produit:', error);
                showToast('Erreur lors de la mise à jour du produit', 'error');
                return false;
            }
        };
        
        /**
         * Supprimer un produit
         */
        const deleteProduct = async (productId) => {
            try {
                const db = FirebaseAdminModule.getFirestore();
                
                // Supprimer le produit de Firestore
                await db.collection('products').doc(productId).delete();
                
                showToast('✅ Produit supprimé avec succès', 'success');
                return true;
                
            } catch (error) {
                console.error('❌ Erreur de suppression du produit:', error);
                showToast('Erreur lors de la suppression du produit', 'error');
                return false;
            }
        };
        
        /**
         * Basculer la disponibilité d'un produit
         */
        const toggleProductAvailability = async (productId, isAvailable) => {
            try {
                const db = FirebaseAdminModule.getFirestore();
                
                await db.collection('products').doc(productId).update({
                    isAvailable: isAvailable,
                    updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                });
                
                const status = isAvailable ? 'activé' : 'désactivé';
                showToast(`✅ Produit ${status} avec succès`, 'success');
                return true;
                
            } catch (error) {
                console.error('❌ Erreur de changement de statut:', error);
                showToast('Erreur lors du changement de statut', 'error');
                return false;
            }
        };
        
        return {
            loadProductsRealtime,
            createProduct,
            updateProduct,
            deleteProduct,
            toggleProductAvailability
        };
    })();
    
    // ============================================
    // MODULE 3: INTERFACE UTILISATEUR
    // ============================================
    const UIManager = (() => {
        /**
         * Afficher une notification toast
         */
        const showToast = (message, type = 'info') => {
            const toastContainer = document.getElementById('toast-container');
            if (!toastContainer) return;
            
            const toastId = 'toast-' + Date.now();
            const typeConfig = {
                success: { bg: 'bg-green-500', icon: 'fa-check-circle' },
                error: { bg: 'bg-red-500', icon: 'fa-exclamation-circle' },
                warning: { bg: 'bg-yellow-500', icon: 'fa-exclamation-triangle' },
                info: { bg: 'bg-blue-500', icon: 'fa-info-circle' }
            }[type] || { bg: 'bg-blue-500', icon: 'fa-info-circle' };
            
            const toast = document.createElement('div');
            toast.id = toastId;
            toast.className = `${typeConfig.bg} text-white px-4 py-3 rounded-lg shadow-lg flex items-center`;
            toast.style.animation = 'slideIn 0.3s forwards';
            toast.innerHTML = `
                <i class="fas ${typeConfig.icon} mr-3"></i>
                <span class="flex-grow">${message}</span>
                <button onclick="document.getElementById('${toastId}').remove()" class="ml-4 opacity-75 hover:opacity-100">
                    <i class="fas fa-times"></i>
                </button>
            `;
            
            toastContainer.appendChild(toast);
            
            // Auto-suppression après 5 secondes
            setTimeout(() => {
                const toastEl = document.getElementById(toastId);
                if (toastEl) {
                    toastEl.style.animation = 'slideOut 0.3s forwards';
                    setTimeout(() => toastEl.remove(), 300);
                }
            }, 5000);
        };
        
        /**
         * Afficher l'état de chargement
         */
        const showLoadingState = () => {
            document.getElementById('loading-state').style.display = 'flex';
            document.getElementById('empty-state').classList.add('hidden');
            document.getElementById('error-state').classList.add('hidden');
            document.getElementById('products-table').classList.add('hidden');
            document.getElementById('products-grid').classList.add('hidden');
        };
        
        /**
         * Cacher l'état de chargement
         */
        const hideLoadingState = () => {
            document.getElementById('loading-state').style.display = 'none';
        };
        
        /**
         * Afficher l'état vide
         */
        const showEmptyState = () => {
            document.getElementById('empty-state').classList.remove('hidden');
            document.getElementById('error-state').classList.add('hidden');
            document.getElementById('products-table').classList.add('hidden');
            document.getElementById('products-grid').classList.add('hidden');
        };
        
        /**
         * Afficher l'état d'erreur
         */
        const showErrorState = (message) => {
            document.getElementById('error-message').textContent = message;
            document.getElementById('error-state').classList.remove('hidden');
            document.getElementById('empty-state').classList.add('hidden');
            document.getElementById('products-table').classList.add('hidden');
            document.getElementById('products-grid').classList.add('hidden');
            document.getElementById('loading-state').style.display = 'none';
        };
        
        /**
         * Mettre à jour les statistiques
         */
        const updateStats = (total, available, lowStock, newProducts) => {
            document.getElementById('total-products').textContent = total;
            document.getElementById('available-products').textContent = available;
            document.getElementById('low-stock-products').textContent = lowStock;
            document.getElementById('new-products').textContent = newProducts;
        };
        
        /**
         * Mettre à jour le temps de dernière synchronisation
         */
        const updateLastSyncTime = () => {
            const now = new Date();
            const timeString = now.toLocaleTimeString('fr-FR', { 
                hour: '2-digit', 
                minute: '2-digit' 
            });
            document.getElementById('last-sync').textContent = timeString;
        };
        
        /**
         * Rendre une ligne de produit pour le tableau
         */
        const renderProductRow = (product) => {
            const statusClass = product.isAvailable ? 
                (product.stockQuantity > 0 ? 'status-available' : 'status-unavailable') : 
                'status-unavailable';
            
            const statusText = product.isAvailable ? 
                (product.stockQuantity > 0 ? 'Disponible' : 'Stock épuisé') : 
                'Indisponible';
            
            const optionsCount = countProductOptions(product);
            
            // Utiliser une image de secours en base64 (SVG)
            const placeholderImage = 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgZmlsbD0iI2YzZjRmNiIvPjxwYXRoIGQ9Ik0zMCw0MCBMNzAsNDAgTDgwLDYwIEwyMCw2MCBaIiBmaWxsPSIjZDFkNTVkYiIgc3Ryb2tlPSIjOWNhM2FmIiBzdHJva2Utd2lkdGg9IjIiLz48Y2lyY2xlIGN4PSI1MCIgY3k9IjM1IiByPSI4IiBmaWxsPSIjNmI3MjgwIi8+PHRleHQgeD0iNTAiIHk9Ijg1IiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBmb250LWZhbWlseT0iQXJpYWwiIGZvbnQtc2l6ZT0iMTAiIGZpbGw9IiM2YjcyODAiPkltYWdlPC90ZXh0Pjwvc3ZnPg==';
            const imageUrl = product.imageName && product.imageName.startsWith('http') 
                ? product.imageName 
                : placeholderImage;
            
            return `
                <tr class="product-row hover:bg-gray-50 transition-colors duration-200">
                    <!-- Product Info -->
                    <td class="px-6 py-4">
                        <div class="flex items-center">
                            <div class="w-12 h-12 rounded-lg overflow-hidden bg-gray-100 flex-shrink-0 mr-4">
                                <img 
                                    src="${imageUrl}" 
                                    alt="${product.name}"
                                    class="w-full h-full object-cover"
                                    onerror="this.src='${placeholderImage}'"
                                >
                            </div>
                            <div>
                                <div class="font-medium text-gray-900">${product.name}</div>
                                <div class="text-sm text-gray-500 truncate max-w-xs">
                                    ${(product.description || 'Pas de description').substring(0, 60)}...
                                </div>
                                <div class="flex flex-wrap gap-1 mt-1">
                                    ${product.isNew ? '<span class="px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded-full">Nouveau</span>' : ''}
                                    ${product.isPopular ? '<span class="px-2 py-1 bg-purple-100 text-purple-800 text-xs rounded-full">Populaire</span>' : ''}
                                    ${product.showInHero ? '<span class="px-2 py-1 bg-green-100 text-green-800 text-xs rounded-full">Hero</span>' : ''}
                                </div>
                            </div>
                        </div>
                    </td>
                    
                    <!-- Category -->
                    <td class="px-6 py-4">
                        <span class="px-3 py-1 bg-gray-100 text-gray-800 rounded-full text-sm">
                            ${product.category || 'Non catégorisé'}
                        </span>
                    </td>
                    
                    <!-- Price -->
                    <td class="px-6 py-4">
                        <div class="font-medium text-gray-900">
                            ${FirebaseAdminModule.formatPrice(product.price || 0)}
                        </div>
                        ${product.showOldPrice && product.oldPrice ? `
                            <div class="text-sm text-gray-500 line-through">
                                ${FirebaseAdminModule.formatPrice(product.oldPrice)}
                            </div>
                        ` : ''}
                    </td>
                    
                    <!-- Stock -->
                    <td class="px-6 py-4">
                        <div class="flex items-center">
                            <span class="font-medium ${(product.stockQuantity || 0) < 10 ? 'text-yellow-600' : 'text-gray-900'}">
                                ${product.stockQuantity || 0}
                            </span>
                            ${(product.stockQuantity || 0) < 10 ? `
                                <i class="fas fa-exclamation-triangle text-yellow-500 ml-2"></i>
                            ` : ''}
                        </div>
                    </td>
                    
                    <!-- Status -->
                    <td class="px-6 py-4">
                        <span class="status-badge ${statusClass}">
                            ${statusText}
                        </span>
                    </td>
                    
                    <!-- Options -->
                    <td class="px-6 py-4">
                        <div class="text-sm text-gray-600">
                            ${optionsCount} option(s)
                        </div>
                    </td>
                    
                    <!-- Actions -->
                    <td class="px-6 py-4">
                        <div class="flex space-x-2">
                            <button 
                                onclick="editProduct('${product.id}')"
                                class="p-2 text-indigo-600 hover:bg-indigo-50 rounded-lg transition-colors duration-200"
                                title="Modifier"
                            >
                                <i class="fas fa-edit"></i>
                            </button>
                            <button 
                                onclick="toggleAvailability('${product.id}', ${!product.isAvailable})"
                                class="p-2 ${product.isAvailable ? 'text-yellow-600 hover:bg-yellow-50' : 'text-green-600 hover:bg-green-50'} rounded-lg transition-colors duration-200"
                                title="${product.isAvailable ? 'Désactiver' : 'Activer'}"
                            >
                                <i class="fas ${product.isAvailable ? 'fa-eye-slash' : 'fa-eye'}"></i>
                            </button>
                            <button 
                                onclick="confirmDeleteProduct('${product.id}', '${product.name.replace(/'/g, "\\'")}')"
                                class="p-2 text-red-600 hover:bg-red-50 rounded-lg transition-colors duration-200"
                                title="Supprimer"
                            >
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </td>
                </tr>
            `;
        };
        
        /**
         * Rendre une carte produit pour mobile
         */
        const renderProductCard = (product) => {
            const statusClass = product.isAvailable ? 
                (product.stockQuantity > 0 ? 'status-available' : 'status-unavailable') : 
                'status-unavailable';
            
            const statusText = product.isAvailable ? 
                (product.stockQuantity > 0 ? 'Disponible' : 'Stock épuisé') : 
                'Indisponible';
            
            // Utiliser une image de secours en base64 (SVG)
            const placeholderImage = 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgZmlsbD0iI2YzZjRmNiIvPjxwYXRoIGQ9Ik0zMCw0MCBMNzAsNDAgTDgwLDYwIEwyMCw2MCBaIiBmaWxsPSIjZDFkNTVkYiIgc3Ryb2tlPSIjOWNhM2FmIiBzdHJva2Utd2lkdGg9IjIiLz48Y2lyY2xlIGN4PSI1MCIgY3k9IjM1IiByPSI4IiBmaWxsPSIjNmI3MjgwIi8+PHRleHQgeD0iNTAiIHk9Ijg1IiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBmb250LWZhbWlseT0iQXJpYWwiIGZvbnQtc2l6ZT0iMTAiIGZpbGw9IiM2YjcyODAiPkltYWdlPC90ZXh0Pjwvc3ZnPg==';
            const imageUrl = product.imageName && product.imageName.startsWith('http') 
                ? product.imageName 
                : placeholderImage;
            
            return `
                <div class="bg-white rounded-lg shadow border border-gray-200 overflow-hidden">
                    <!-- Product Image -->
                    <div class="h-48 bg-gray-100 overflow-hidden">
                        <img 
                            src="${imageUrl}" 
                            alt="${product.name}"
                            class="w-full h-full object-cover"
                            onerror="this.src='${placeholderImage}'"
                        >
                    </div>
                    
                    <!-- Product Info -->
                    <div class="p-4">
                        <div class="flex justify-between items-start mb-2">
                            <h4 class="font-bold text-gray-900 truncate">${product.name}</h4>
                            <div class="flex space-x-1">
                                ${product.isNew ? '<span class="px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded-full">N</span>' : ''}
                                ${product.isPopular ? '<span class="px-2 py-1 bg-purple-100 text-purple-800 text-xs rounded-full">P</span>' : ''}
                            </div>
                        </div>
                        
                        <p class="text-sm text-gray-600 mb-3 line-clamp-2">
                            ${product.description || 'Pas de description'}
                        </p>
                        
                        <div class="flex justify-between items-center mb-3">
                            <div>
                                <div class="font-bold text-gray-900">
                                    ${FirebaseAdminModule.formatPrice(product.price || 0)}
                                </div>
                                <div class="text-sm text-gray-500">
                                    ${product.category || 'Non catégorisé'}
                                </div>
                            </div>
                            <div class="text-right">
                                <div class="font-medium ${(product.stockQuantity || 0) < 10 ? 'text-yellow-600' : 'text-gray-900'}">
                                    Stock: ${product.stockQuantity || 0}
                                </div>
                                <span class="status-badge ${statusClass} text-xs">
                                    ${statusText}
                                </span>
                            </div>
                        </div>
                        
                        <!-- Action Buttons -->
                        <div class="flex justify-between pt-3 border-t border-gray-100">
                            <button 
                                onclick="editProduct('${product.id}')"
                                class="px-3 py-2 text-indigo-600 hover:bg-indigo-50 rounded-lg text-sm font-medium transition-colors duration-200"
                            >
                                <i class="fas fa-edit mr-1"></i> Modifier
                            </button>
                            <button 
                                onclick="toggleAvailability('${product.id}', ${!product.isAvailable})"
                                class="px-3 py-2 ${product.isAvailable ? 'text-yellow-600 hover:bg-yellow-50' : 'text-green-600 hover:bg-green-50'} rounded-lg text-sm font-medium transition-colors duration-200"
                            >
                                <i class="fas ${product.isAvailable ? 'fa-eye-slash' : 'fa-eye'} mr-1"></i>
                                ${product.isAvailable ? 'Désactiver' : 'Activer'}
                            </button>
                            <button 
                                onclick="confirmDeleteProduct('${product.id}', '${product.name.replace(/'/g, "\\'")}')"
                                class="px-3 py-2 text-red-600 hover:bg-red-50 rounded-lg text-sm font-medium transition-colors duration-200"
                            >
                                <i class="fas fa-trash mr-1"></i> Supprimer
                            </button>
                        </div>
                    </div>
                </div>
            `;
        };
        
        /**
         * Afficher les produits dans l'interface
         */
        const displayProducts = (products) => {
            const tbody = document.getElementById('products-tbody');
            const grid = document.getElementById('products-grid');
            const productCount = document.getElementById('product-count');
            
            if (!products || products.length === 0) {
                showEmptyState();
                return;
            }
            
            // Mettre à jour le compteur
            productCount.textContent = products.length;
            
            // Vérifier la taille de l'écran
            const isMobile = window.innerWidth < 768;
            
            if (isMobile) {
                // Afficher en grille pour mobile
                let gridHTML = '';
                products.forEach(product => {
                    gridHTML += renderProductCard(product);
                });
                grid.innerHTML = gridHTML;
                
                // Afficher la grille et masquer le tableau
                grid.classList.remove('hidden');
                document.getElementById('products-table').classList.add('hidden');
            } else {
                // Afficher en tableau pour desktop
                let tableHTML = '';
                products.forEach(product => {
                    tableHTML += renderProductRow(product);
                });
                tbody.innerHTML = tableHTML;
                
                // Afficher le tableau et masquer la grille
                document.getElementById('products-table').classList.remove('hidden');
                grid.classList.add('hidden');
            }
            
            // Masquer les états vides/erreur
            document.getElementById('empty-state').classList.add('hidden');
            document.getElementById('error-state').classList.add('hidden');
        };
        
        /**
         * Compter les options d'un produit
         */
        const countProductOptions = (product) => {
            let count = 0;
            
            if (product.hasSize && product.sizes && product.sizes.length > 0) count++;
            if (product.hasColor && product.colors && product.colors.length > 0) count++;
            if (product.hasPersonalizationText) count++;
            if (product.hasMaterial && product.materials && product.materials.length > 0) count++;
            if (product.hasOz && product.ozOptions && product.ozOptions.length > 0) count++;
            
            return count;
        };
        
        /**
         * Ouvrir le modal de création/modification
         */
        const openProductModal = (mode = 'create', productData = null) => {
            const modal = document.getElementById('product-modal');
            const title = document.getElementById('modal-title');
            const form = document.getElementById('product-form');
            
            // Réinitialiser le formulaire
            form.reset();
            
            if (mode === 'create') {
                title.textContent = 'Nouveau produit';
                adminState.currentProductId = null;
                
                // Définir les valeurs par défaut
                document.querySelector('input[name="availability"][value="true"]').checked = true;
                document.getElementById('delivery-domicile').checked = true;
                document.getElementById('delivery-rencontre').checked = true;
                document.getElementById('delivery-point-vente').checked = true;
                
                // Désactiver les sections d'options
                document.querySelectorAll('[id$="-options-container"]').forEach(container => {
                    container.classList.add('hidden');
                });
                document.querySelectorAll('[id^="has-"]').forEach(checkbox => {
                    checkbox.checked = false;
                });
                
            } else if (mode === 'edit' && productData) {
                title.textContent = 'Modifier le produit';
                adminState.currentProductId = productData.id;
                
                // Remplir le formulaire avec les données du produit
                fillProductForm(productData);
            }
            
            // Afficher le modal
            modal.classList.remove('hidden');
            document.body.style.overflow = 'hidden';
        };
        
        /**
         * Remplir le formulaire avec les données d'un produit
         */
        const fillProductForm = (product) => {
            // Informations de base
            document.getElementById('product-name').value = product.name || '';
            document.getElementById('product-category').value = product.category || '';
            document.getElementById('product-description').value = product.description || '';
            document.getElementById('product-image').value = product.imageName || '';
            
            // Tarification
            document.getElementById('product-price').value = product.price || 0;
            if (product.showOldPrice && product.oldPrice) {
                document.getElementById('show-old-price').checked = true;
                toggleOldPrice();
                document.getElementById('product-old-price').value = product.oldPrice;
            }
            
            // Stock
            document.getElementById('product-stock').value = product.stockQuantity || 0;
            const availability = product.isAvailable !== false ? 'true' : 'false';
            document.querySelector(`input[name="availability"][value="${availability}"]`).checked = true;
            
            // Drapeaux produit
            document.getElementById('product-new').checked = !!product.isNew;
            document.getElementById('product-popular').checked = !!product.isPopular;
            document.getElementById('product-hero').checked = !!product.showInHero;
            
            // Logistique
            document.getElementById('product-weight').value = product.weight || 0;
            document.getElementById('product-fragile').checked = !!product.fragile;
            document.getElementById('product-extra-delivery').checked = !!product.extraDeliveryCost;
            if (product.extraDeliveryCost) {
                document.getElementById('extra-delivery-cost-container').classList.remove('hidden');
                document.getElementById('product-extra-delivery-cost').value = product.extraDeliveryCost;
            }
            
            // Options de livraison
            document.getElementById('delivery-domicile').checked = !!(product.deliveryLogic && product.deliveryLogic.domicile !== false);
            document.getElementById('delivery-rencontre').checked = !!(product.deliveryLogic && product.deliveryLogic.rencontre !== false);
            document.getElementById('delivery-point-vente').checked = !!(product.deliveryLogic && product.deliveryLogic.pointVente !== false);
            
            // Options dynamiques
            if (product.hasSize && product.sizes) {
                document.getElementById('has-size').checked = true;
                toggleOptionSection('size');
                document.getElementById('size-options').value = Array.isArray(product.sizes) ? 
                    product.sizes.join(', ') : product.sizes;
            }
            
            if (product.hasColor && product.colors) {
                document.getElementById('has-color').checked = true;
                toggleOptionSection('color');
                document.getElementById('color-options').value = Array.isArray(product.colors) ? 
                    product.colors.join(', ') : product.colors;
            }
            
            if (product.hasPersonalizationText) {
                document.getElementById('has-personalization').checked = true;
                toggleOptionSection('personalization');
                document.getElementById('personalization-label').value = product.personalizationLabel || '';
                document.getElementById('personalization-max-chars').value = product.maxCharacters || 50;
            }
            
            if (product.hasMaterial && product.materials) {
                document.getElementById('has-material').checked = true;
                toggleOptionSection('material');
                document.getElementById('material-options').value = Array.isArray(product.materials) ? 
                    product.materials.join(', ') : product.materials;
            }
            
            if (product.hasOz && product.ozOptions) {
                document.getElementById('has-oz').checked = true;
                toggleOptionSection('oz');
                document.getElementById('oz-options').value = Array.isArray(product.ozOptions) ? 
                    product.ozOptions.join(', ') : product.ozOptions;
            }
        };
        
        /**
         * Fermer le modal
         */
        const closeModal = () => {
            document.getElementById('product-modal').classList.add('hidden');
            document.body.style.overflow = 'auto';
        };
        
        /**
         * Ouvrir le modal de confirmation
         */
        const openConfirmModal = (title, message, action, actionData) => {
            document.getElementById('confirm-title').textContent = title;
            document.getElementById('confirm-message').textContent = message;
            
            const actionBtn = document.getElementById('confirm-action-btn');
            actionBtn.onclick = () => {
                action(actionData);
                closeConfirmModal();
            };
            
            document.getElementById('confirm-modal').classList.remove('hidden');
        };
        
        /**
         * Fermer le modal de confirmation
         */
        const closeConfirmModal = () => {
            document.getElementById('confirm-modal').classList.add('hidden');
        };
        
        return {
            showToast,
            showLoadingState,
            hideLoadingState,
            showEmptyState,
            showErrorState,
            updateStats,
            updateLastSyncTime,
            displayProducts,
            openProductModal,
            closeModal,
            openConfirmModal,
            closeConfirmModal
        };
    })();
    
    // ============================================
    // MODULE 4: FILTRES ET RECHERCHE
    // ============================================
    const FilterManager = (() => {
        /**
         * Appliquer le filtre actuel
         */
        const applyCurrentFilter = () => {
            let filtered = [...adminState.products];
            
            // Appliquer le filtre sélectionné
            switch (adminState.currentFilter) {
                case 'available':
                    filtered = filtered.filter(p => p.isAvailable && (p.stockQuantity || 0) > 0);
                    break;
                case 'unavailable':
                    filtered = filtered.filter(p => !p.isAvailable || (p.stockQuantity || 0) <= 0);
                    break;
                case 'new':
                    filtered = filtered.filter(p => p.isNew);
                    break;
                case 'popular':
                    filtered = filtered.filter(p => p.isPopular);
                    break;
                case 'all':
                default:
                    // Pas de filtre
                    break;
            }
            
            // Appliquer la recherche
            const searchTerm = document.getElementById('search-input')?.value?.toLowerCase() || '';
            if (searchTerm) {
                filtered = filtered.filter(p => 
                    p.name.toLowerCase().includes(searchTerm) ||
                    (p.category?.toLowerCase() || '').includes(searchTerm) ||
                    (p.description?.toLowerCase() || '').includes(searchTerm)
                );
            }
            
            // Mettre à jour l'état filtré
            adminState.filteredProducts = filtered;
            
            // Afficher les produits filtrés
            UIManager.displayProducts(filtered);
            
            // Mettre à jour les boutons de filtre actifs
            updateFilterButtons();
        };
        
        /**
         * Mettre à jour les boutons de filtre actifs
         */
        const updateFilterButtons = () => {
            document.querySelectorAll('.filter-btn').forEach(btn => {
                const filter = btn.getAttribute('data-filter');
                if (filter === adminState.currentFilter) {
                    btn.classList.add('bg-indigo-600', 'text-white');
                    btn.classList.remove('bg-gray-100', 'hover:bg-gray-200');
                } else {
                    btn.classList.remove('bg-indigo-600', 'text-white');
                    btn.classList.add('bg-gray-100', 'hover:bg-gray-200');
                }
            });
        };
        
        /**
         * Filtrer les produits
         */
        const filterProducts = (filterType) => {
            adminState.currentFilter = filterType;
            applyCurrentFilter();
        };
        
        return {
            applyCurrentFilter,
            filterProducts,
            updateFilterButtons
        };
    })();
    
    // ============================================
    // MODULE 5: GESTION DU FORMULAIRE
    // ============================================
    const FormManager = (() => {
        /**
         * Valider et soumettre le formulaire
         */
        const handleFormSubmit = async (event) => {
            event.preventDefault();
            
            // Récupérer les données du formulaire
            const formData = getFormData();
            
            // Valider les données
            if (!validateFormData(formData)) {
                return;
            }
            
            // Désactiver le bouton de sauvegarde
            const saveBtn = document.getElementById('save-product-btn');
            const originalText = saveBtn.innerHTML;
            saveBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i> Enregistrement...';
            saveBtn.disabled = true;
            
            try {
                if (adminState.currentProductId) {
                    // Mise à jour d'un produit existant
                    await ProductManager.updateProduct(adminState.currentProductId, formData);
                } else {
                    // Création d'un nouveau produit
                    await ProductManager.createProduct(formData);
                }
                
                // Fermer le modal
                UIManager.closeModal();
                
            } finally {
                // Réactiver le bouton
                saveBtn.innerHTML = originalText;
                saveBtn.disabled = false;
            }
        };
        
        /**
         * Récupérer les données du formulaire
         */
        const getFormData = () => {
            const formData = {
                // Informations de base
                name: document.getElementById('product-name').value.trim(),
                category: document.getElementById('product-category').value.trim(),
                description: document.getElementById('product-description').value.trim(),
                imageName: document.getElementById('product-image').value.trim(),
                
                // Tarification
                price: parseFloat(document.getElementById('product-price').value) || 0,
                showOldPrice: document.getElementById('show-old-price').checked,
                oldPrice: document.getElementById('show-old-price').checked ? 
                    parseFloat(document.getElementById('product-old-price').value) || 0 : null,
                
                // Stock
                stockQuantity: parseInt(document.getElementById('product-stock').value) || 0,
                isAvailable: document.querySelector('input[name="availability"]:checked').value === 'true',
                
                // Drapeaux produit
                isNew: document.getElementById('product-new').checked,
                isPopular: document.getElementById('product-popular').checked,
                showInHero: document.getElementById('product-hero').checked,
                
                // Logistique
                weight: parseFloat(document.getElementById('product-weight').value) || 0,
                fragile: document.getElementById('product-fragile').checked,
                extraDeliveryCost: document.getElementById('product-extra-delivery').checked ? 
                    parseFloat(document.getElementById('product-extra-delivery-cost').value || 0) : 0,
                
                // Options de livraison
                deliveryLogic: {
                    domicile: document.getElementById('delivery-domicile').checked,
                    rencontre: document.getElementById('delivery-rencontre').checked,
                    pointVente: document.getElementById('delivery-point-vente').checked
                },
                
                // Options dynamiques
                hasSize: document.getElementById('has-size').checked,
                hasColor: document.getElementById('has-color').checked,
                hasPersonalizationText: document.getElementById('has-personalization').checked,
                hasMaterial: document.getElementById('has-material').checked,
                hasOz: document.getElementById('has-oz').checked
            };
            
            // Traiter les options de taille
            if (formData.hasSize) {
                const sizes = document.getElementById('size-options').value
                    .split(',')
                    .map(s => s.trim())
                    .filter(s => s.length > 0);
                formData.sizes = sizes;
            }
            
            // Traiter les options de couleur
            if (formData.hasColor) {
                const colors = document.getElementById('color-options').value
                    .split(',')
                    .map(c => c.trim())
                    .filter(c => c.length > 0);
                formData.colors = colors;
            }
            
            // Traiter la personnalisation
            if (formData.hasPersonalizationText) {
                formData.personalizationLabel = document.getElementById('personalization-label').value.trim();
                formData.maxCharacters = parseInt(document.getElementById('personalization-max-chars').value) || 50;
            }
            
            // Traiter les options de matériau
            if (formData.hasMaterial) {
                const materials = document.getElementById('material-options').value
                    .split(',')
                    .map(m => m.trim())
                    .filter(m => m.length > 0);
                formData.materials = materials;
            }
            
            // Traiter les options de poids
            if (formData.hasOz) {
                const ozOptions = document.getElementById('oz-options').value
                    .split(',')
                    .map(o => o.trim())
                    .filter(o => o.length > 0);
                formData.ozOptions = ozOptions;
            }
            
            return formData;
        };
        
        /**
         * Valider les données du formulaire
         */
        const validateFormData = (data) => {
            // Validation du nom
            if (!data.name || data.name.length < 2) {
                UIManager.showToast('Le nom du produit doit contenir au moins 2 caractères', 'error');
                return false;
            }
            
            // Validation de la catégorie
            if (!data.category) {
                UIManager.showToast('La catégorie est obligatoire', 'error');
                return false;
            }
            
            // Validation de la description
            if (!data.description || data.description.length < 10) {
                UIManager.showToast('La description doit contenir au moins 10 caractères', 'error');
                return false;
            }
            
            // Validation de l'image
            if (!data.imageName) {
                UIManager.showToast('L\'URL de l\'image est obligatoire', 'error');
                return false;
            }
            
            // Validation du prix
            if (isNaN(data.price) || data.price <= 0) {
                UIManager.showToast('Le prix doit être un nombre positif', 'error');
                return false;
            }
            
            // Validation de l'ancien prix
            if (data.showOldPrice && (isNaN(data.oldPrice) || data.oldPrice <= 0)) {
                UIManager.showToast('L\'ancien prix doit être un nombre positif', 'error');
                return false;
            }
            
            // Validation du stock
            if (isNaN(data.stockQuantity) || data.stockQuantity < 0) {
                UIManager.showToast('La quantité en stock doit être un nombre positif ou nul', 'error');
                return false;
            }
            
            // Validation du poids
            if (isNaN(data.weight) || data.weight <= 0) {
                UIManager.showToast('Le poids doit être un nombre positif', 'error');
                return false;
            }
            
            return true;
        };
        
        /**
         * Basculer l'affichage de l'ancien prix
         */
        const toggleOldPrice = () => {
            const showOldPrice = document.getElementById('show-old-price').checked;
            const oldPriceInput = document.getElementById('product-old-price');
            
            oldPriceInput.disabled = !showOldPrice;
            oldPriceInput.required = showOldPrice;
            if (!showOldPrice) {
                oldPriceInput.value = '';
            }
        };
        
        /**
         * Basculer l'affichage des frais de livraison supplémentaires
         */
        const toggleExtraDeliveryCost = () => {
            const showExtraDelivery = document.getElementById('product-extra-delivery').checked;
            const container = document.getElementById('extra-delivery-cost-container');
            
            if (showExtraDelivery) {
                container.classList.remove('hidden');
            } else {
                container.classList.add('hidden');
                document.getElementById('product-extra-delivery-cost').value = '';
            }
        };
        
        /**
         * Basculer l'affichage d'une section d'options
         */
        const toggleOptionSection = (optionType) => {
            const checkbox = document.getElementById(`has-${optionType}`);
            const container = document.getElementById(`${optionType}-options-container`);
            
            if (checkbox.checked) {
                container.classList.remove('hidden');
            } else {
                container.classList.add('hidden');
                document.getElementById(`${optionType}-options`).value = '';
            }
        };
        
        return {
            handleFormSubmit,
            toggleOldPrice,
            toggleExtraDeliveryCost,
            toggleOptionSection
        };
    })();
    
    // ============================================
    // FONCTIONS GLOBALES (exposées à window)
    // ============================================
    
    /**
     * Initialiser l'application admin
     */
    window.initializeAdminApp = () => {
        // Initialiser Firebase
        if (!FirebaseAdminModule.initializeFirebase()) {
            UIManager.showErrorState('Impossible de se connecter à Firebase');
            return;
        }
        
        // Afficher l'état de chargement
        UIManager.showLoadingState();
        
        // Charger les produits en temps réel
        ProductManager.loadProductsRealtime();
        
        // Mettre à jour l'année courante
        document.getElementById('current-year').textContent = new Date().getFullYear();
        
        // Configurer les événements
        setupEventListeners();
        
        console.log('✅ Dashboard Admin initialisé');
    };
    
    /**
     * Configurer les écouteurs d'événements
     */
    const setupEventListeners = () => {
        // Bouton de création de produit
        document.getElementById('create-product-btn')?.addEventListener('click', () => {
            UIManager.openProductModal('create');
        });
        
        // Bouton de création de premier produit
        document.getElementById('create-first-product')?.addEventListener('click', () => {
            UIManager.openProductModal('create');
        });
        
        // Formulaire de produit
        document.getElementById('product-form')?.addEventListener('submit', FormManager.handleFormSubmit);
        
        // Recherche en temps réel
        document.getElementById('search-input')?.addEventListener('input', (e) => {
            FilterManager.applyCurrentFilter();
        });
        
        // Frais de livraison supplémentaires
        document.getElementById('product-extra-delivery')?.addEventListener('change', FormManager.toggleExtraDeliveryCost);
        
        // Redimensionnement de la fenêtre
        window.addEventListener('resize', () => {
            FilterManager.applyCurrentFilter();
        });
    };
    
    /**
     * Filtrer les produits
     */
    window.filterProducts = (filterType) => {
        FilterManager.filterProducts(filterType);
    };
    
    /**
     * Éditer un produit
     */
    window.editProduct = (productId) => {
        const product = adminState.products.find(p => p.id === productId);
        if (product) {
            UIManager.openProductModal('edit', product);
        }
    };
    
    /**
     * Basculer la disponibilité d'un produit
     */
    window.toggleAvailability = async (productId, newStatus) => {
        await ProductManager.toggleProductAvailability(productId, newStatus);
    };
    
    /**
     * Confirmer la suppression d'un produit
     */
    window.confirmDeleteProduct = (productId, productName) => {
        UIManager.openConfirmModal(
            'Confirmer la suppression',
            `Êtes-vous sûr de vouloir supprimer "${productName}" ? Cette action est irréversible.`,
            async () => {
                await ProductManager.deleteProduct(productId);
            }
        );
    };
    
    /**
     * Fermer le modal
     */
    window.closeModal = () => {
        UIManager.closeModal();
    };
    
    /**
     * Fermer le modal de confirmation
     */
    window.closeConfirmModal = () => {
        UIManager.closeConfirmModal();
    };
    
    /**
     * Basculer l'affichage de l'ancien prix
     */
    window.toggleOldPrice = () => {
        FormManager.toggleOldPrice();
    };
    
    /**
     * Basculer l'affichage d'une section d'options
     */
    window.toggleOptionSection = (optionType) => {
        FormManager.toggleOptionSection(optionType);
    };
    
    /**
     * Afficher un toast (fonction globale)
     */
    window.showToast = UIManager.showToast;
    
    /**
     * Mettre à jour les statistiques (fonction globale)
     */
    window.updateStats = UIManager.updateStats;
    
    /**
     * Mettre à jour la dernière synchronisation (fonction globale)
     */
    window.updateLastSyncTime = UIManager.updateLastSyncTime;
    
    /**
     * Afficher l'état d'erreur (fonction globale)
     */
    window.showErrorState = UIManager.showErrorState;
    
    /**
     * Cacher l'état de chargement (fonction globale)
     */
    window.hideLoadingState = UIManager.hideLoadingState;
    
    /**
     * Afficher les produits (fonction globale)
     */
    window.displayProducts = UIManager.displayProducts;
    
    /**
     * Appliquer le filtre actuel (fonction globale)
     */
    window.applyCurrentFilter = FilterManager.applyCurrentFilter;
    
    /**
     * Gestionnaire d'erreur pour les images
     */
    window.handleImageError = (img) => {
        img.src = 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgZmlsbD0iI2YzZjRmNiIvPjxwYXRoIGQ9Ik0zMCw0MCBMNzAsNDAgTDgwLDYwIEwyMCw2MCBaIiBmaWxsPSIjZDFkNTVkYiIgc3Ryb2tlPSIjOWNhM2FmIiBzdHJva2Utd2lkdGg9IjIiLz48Y2lyY2xlIGN4PSI1MCIgY3k9IjM1IiByPSI4IiBmaWxsPSIjNmI3MjgwIi8+PHRleHQgeD0iNTAiIHk9Ijg1IiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBmb250LWZhbWlseT0iQXJpYWwiIGZvbnQtc2l6ZT0iMTAiIGZpbGw9IiM2YjcyODAiPkltYWdlPC90ZXh0Pjwvc3ZnPg==';
        img.onerror = null; // Éviter les boucles infinies
    };
    
    // ============================================
    // INITIALISATION AU CHARGEMENT DE LA PAGE
    // ============================================
    
    document.addEventListener('DOMContentLoaded', () => {
        window.initializeAdminApp();
    });
    
</script>
</body>
</html>

