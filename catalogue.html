<!DOCTYPE html>
<html lang="fr" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart cut services | E-commerce SPA-Like</title>
     <link rel="icon" type="image/png" href="favicon-96x96.png" sizes="96x96" />
<link rel="icon" type="image/svg+xml" href="favicon.svg" />
<link rel="shortcut icon" href="favicon.ico" />
<link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png" />
<link rel="manifest" href="site.webmanifest" />
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Anime.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js"></script>
    
    <!-- jsPDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
    
    <!-- QR Code Generator -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    
    <style>
        :root {
            --primary-color: #3b82f6;
            --primary-dark: #2563eb;
            --secondary-color: #10b981;
            --accent-color: #f59e0b;
            --background-color: #f9fafb;
            --text-color: #1f2937;
        }
        
        * {
            font-family: 'Inter', sans-serif;
            box-sizing: border-box;
        }
        
        .font-heading {
            font-family: 'Poppins', sans-serif;
        }
        
        /* Modal styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            backdrop-filter: blur(5px);
        }
        
        .modal-content {
            background-color: white;
            border-radius: 1rem;
            max-width: 500px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            animation: modalSlideIn 0.3s ease-out;
        }
        
        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-30px) scale(0.95);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }
        
        .option-button {
            transition: all 0.2s ease;
        }
        
        .option-button.selected {
            background-color: #3b82f6;
            color: white;
            border-color: #3b82f6;
        }
        
        .skeleton {
            background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
            background-size: 200% 100%;
            animation: loading 1.5s infinite;
        }
        
        @keyframes loading {
            0% {
                background-position: 200% 0;
            }
            100% {
                background-position: -200% 0;
            }
        }
        
        .page-enter {
            opacity: 0;
            transform: translateY(20px);
        }
        
        .page-enter-active {
            opacity: 1;
            transform: translateY(0);
            transition: opacity 300ms, transform 300ms;
        }
        
        ::-webkit-scrollbar {
            width: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        
        ::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 4px;
        }
        
        .product-card {
            transition: all 0.3s ease;
        }
        
        .product-card:hover {
            transform: translateY(-5px);
        }
        
        .add-to-cart-btn {
            position: relative;
            overflow: hidden;
        }
        
        .add-to-cart-btn::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 5px;
            height: 5px;
            background: rgba(255, 255, 255, 0.5);
            opacity: 0;
            border-radius: 100%;
            transform: scale(1, 1) translate(-50%);
            transform-origin: 50% 50%;
        }
        
        .add-to-cart-btn:focus:not(:active)::after {
            animation: ripple 1s ease-out;
        }
        
        @keyframes ripple {
            0% {
                transform: scale(0, 0);
                opacity: 0.5;
            }
            100% {
                transform: scale(20, 20);
                opacity: 0;
            }
        }
        
        .cart-badge {
            transition: all 0.3s ease;
        }
        
        .cart-badge.update {
            animation: badgePulse 0.5s ease-in-out;
        }
        
        @keyframes badgePulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }
        
        .toast-enter {
            animation: slideInRight 0.3s ease-out;
        }
        
        .toast-exit {
            animation: slideOutRight 0.3s ease-out forwards;
        }
        
        @keyframes slideInRight {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        @keyframes slideOutRight {
            to {
                transform: translateX(100%);
                opacity: 0;
            }
        }
        
        .loading-spinner {
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .payment-option {
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .payment-option:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        
        .payment-option.selected {
            border-color: #3b82f6;
            background-color: #eff6ff;
        }
        
        .step-indicator {
            transition: all 0.3s ease;
        }
        
        .step-indicator.active {
            background-color: #3b82f6;
            color: white;
        }
        
        .step-indicator.completed {
            background-color: #10b981;
            color: white;
        }
        
        .delivery-point {
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .delivery-point:hover {
            background-color: #f3f4f6;
        }
        
        .delivery-point.selected {
            background-color: #dbeafe;
            border-color: #3b82f6;
        }
        
        .qr-container {
            display: flex;
            justify-content: center;
            padding: 20px;
            background: white;
            border-radius: 8px;
        }
        /* Modal overlay */
.image-modal {
    position: fixed;
    inset: 0;
    background: rgba(0, 0, 0, 0.9);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 9999;
    padding: 1rem;
    animation: fadeIn 0.25s ease-out;
}

/* Hidden state */
.image-modal.hidden {
    display: none;
}

/* Image responsive */
.image-modal img {
    max-width: 100%;
    max-height: 100%;
    object-fit: contain; /* respecte toutes les dimensions */
    border-radius: 12px;
    animation: zoomIn 0.25s ease-out;
}

/* Close button */
.image-modal .close-btn {
    position: absolute;
    top: 16px;
    right: 16px;
    font-size: 32px;
    color: white;
    background: none;
    border: none;
    cursor: pointer;
    line-height: 1;
}

/* Animations */
@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

@keyframes zoomIn {
    from { transform: scale(0.95); }
    to { transform: scale(1); }
}

    </style>
</head>
<body class="bg-gray-50 text-gray-900">
    <!-- Application Container -->
    <div id="app" class="min-h-screen flex flex-col">
        
        <!-- Header/Navbar -->
        <header id="header" class="sticky top-0 z-50 bg-white shadow-md transition-all duration-300">
            <nav class="container mx-auto px-4 py-4">
                <div class="flex justify-between items-center">
                    <!-- Logo -->
                    <div class="flex items-center space-x-2">
                <a href="index.html" > <img src="logo.jpeg" width="50px" height="50px"   alt="" ></a>
                    </div>
                    
                    <!-- Desktop Navigation -->
                    <div class="hidden md:flex items-center space-x-8">
                                            <a href="index.html" class=" text-gray-700 hover:text-primary transition-colors duration-300">Accueil</a>
                        <a href="#catalogue" class="nav-link font-medium text-gray-700 hover:text-blue-600 transition-colors duration-200" data-page="catalogue">Catalogue</a>
                        <a href="#panier" class="nav-link font-medium text-gray-700 hover:text-blue-600 transition-colors duration-200" data-page="panier">Panier</a>
                        <a href="about.html" class="nav-link font-medium text-gray-700 hover:text-blue-600 transition-colors duration-200" data-page="about">À propos</a>
                        
                        <!-- Cart Icon with Badge -->
                        <div class="relative">
                            <a href="#panier" class="cart-icon flex items-center justify-center w-10 h-10 bg-gray-100 rounded-full hover:bg-blue-50 transition-colors duration-200" data-page="panier">
                                <i class="fas fa-shopping-cart text-gray-700"></i>
                                <span id="cart-badge" class="cart-badge absolute -top-2 -right-2 bg-red-500 text-white text-xs font-bold rounded-full w-5 h-5 flex items-center justify-center hidden">0</span>
                            </a>
                        </div>
                    </div>
                    
                    <!-- Mobile Menu Button -->
                    <div class="md:hidden flex items-center space-x-4">
                        <!-- Cart Icon Mobile -->
                        <div class="relative">
                            <a href="#panier" class="cart-icon flex items-center justify-center w-10 h-10 bg-gray-100 rounded-full hover:bg-blue-50 transition-colors duration-200" data-page="panier">
                                <i class="fas fa-shopping-cart text-gray-700"></i>
                                <span id="cart-badge-mobile" class="cart-badge absolute -top-2 -right-2 bg-red-500 text-white text-xs font-bold rounded-full w-5 h-5 flex items-center justify-center hidden">0</span>
                            </a>
                        </div>
                        
                        <button id="mobile-menu-button" class="flex items-center justify-center w-10 h-10 bg-gray-100 rounded-full hover:bg-blue-50 transition-colors duration-200">
                            <i class="fas fa-bars text-gray-700"></i>
                        </button>
                    </div>
                </div>
                
                <!-- Mobile Navigation Menu -->
                <div id="mobile-menu" class="hidden md:hidden mt-4 pb-2 border-t border-gray-100">
                    <div class="flex flex-col space-y-3 pt-4">
                    <a href="index.html" class=" text-gray-700 hover:text-primary transition-colors duration-300">Accueil</a>
                        <a href="#catalogue" class="nav-link py-2 px-4 rounded-lg text-gray-700 hover:bg-blue-50 transition-colors duration-200" data-page="catalogue">Catalogue</a>
                        <a href="#panier" class="nav-link py-2 px-4 rounded-lg text-gray-700 hover:bg-blue-50 transition-colors duration-200" data-page="panier">Panier</a>
                        <a href="about.html" class="nav-link py-2 px-4 rounded-lg text-gray-700 hover:bg-blue-50 transition-colors duration-200" data-page="about">À propos</a>
                    </div>
                </div>
            </nav>
        </header>
        
        <!-- Main Content Area -->
        <main id="main-content" class="flex-grow container mx-auto px-4 py-8">
            <!-- Page content will be dynamically loaded here -->
            <div id="page-content">
                <!-- Initial loading state -->
                <div class="flex flex-col items-center justify-center min-h-[60vh]">
                    <div class="w-16 h-16 border-4 border-blue-600 border-t-transparent rounded-full loading-spinner mb-4"></div>
                    <p class="text-gray-600">Chargement de l'application...</p>
                </div>
            </div>
        </main>
      <div class="bg-slate-900 text-gray-300 font-sans">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-10 md:py-16">
    <!-- Conteneur principal desktop -->
    <div class="hidden md:grid md:grid-cols-2 lg:grid-cols-4 gap-10">
      
      <!-- Section Identité -->
      <div class="space-y-4">
        <h3 class="text-lg font-semibold text-gray-100">Notre entreprise</h3>
        <p class="text-sm leading-relaxed text-gray-400">
          Votre boutique en ligne de confiance. Nous nous engageons à vous offrir la meilleure expérience d'achat.
        </p>
      </div>

      <!-- Section Navigation -->
      <div class="space-y-4">
        <h3 class="text-lg font-semibold text-gray-100">Navigation rapide</h3>
        <ul class="space-y-2 text-sm">
          <li><a href="index.html" class="text-blue-400 hover:text-blue-300 transition-colors duration-200">Accueil</a></li>
          <li><a href="catalogue.html" class="text-blue-400 hover:text-blue-300 transition-colors duration-200">Catalogue</a></li>
          <li><a href="catalogue.html#panier" class="text-blue-400 hover:text-blue-300 transition-colors duration-200">Panier</a></li>
          <li><a href="about.html" class="text-blue-400 hover:text-blue-300 transition-colors duration-200">À propos</a></li>
        </ul>
      </div>

      <!-- Section Réseaux sociaux et contact -->
      <div class="space-y-4">
        <h3 class="text-lg font-semibold text-gray-100">Réseaux sociaux & Contact</h3>
        <ul class="space-y-3 text-sm">
          <li class="flex items-center space-x-2">
            <svg class="w-4 h-4 text-blue-400" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true">
              <path fill-rule="evenodd" d="M22 12c0-5.523-4.477-10-10-10S2 6.477 2 12c0 4.991 3.657 9.128 8.438 9.878v-6.987h-2.54V12h2.54V9.797c0-2.506 1.492-3.89 3.777-3.89 1.094 0 2.238.195 2.238.195v2.46h-1.26c-1.243 0-1.63.771-1.63 1.562V12h2.773l-.443 2.89h-2.33v6.988C18.343 21.128 22 16.991 22 12z" clip-rule="evenodd" />
            </svg>
            <a href="https://www.facebook.com/profile.php?id=61573890875251" target="_blank" class="text-blue-400 hover:text-blue-300 transition-colors duration-200">Facebook</a>
          </li>
          <li class="flex items-center space-x-2">
            <svg class="w-4 h-4 text-pink-400" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true">
              <path fill-rule="evenodd" d="M12.315 2c2.43 0 2.784.013 3.808.06 1.064.049 1.791.218 2.427.465a4.902 4.902 0 011.772 1.153 4.902 4.902 0 011.153 1.772c.247.636.416 1.363.465 2.427.048 1.067.06 1.407.06 4.123v.08c0 2.643-.012 2.987-.06 4.043-.049 1.064-.218 1.791-.465 2.427a4.902 4.902 0 01-1.153 1.772 4.902 4.902 0 01-1.772 1.153c-.636.247-1.363.416-2.427.465-1.067.048-1.407.06-4.123.06h-.08c-2.643 0-2.987-.012-4.043-.06-1.064-.049-1.791-.218-2.427-.465a4.902 4.902 0 01-1.772-1.153 4.902 4.902 0 01-1.153-1.772c-.247-.636-.416-1.363-.465-2.427-.047-1.024-.06-1.379-.06-3.808v-.63c0-2.43.013-2.784.06-3.808.049-1.064.218-1.791.465-2.427a4.902 4.902 0 011.153-1.772A4.902 4.902 0 015.45 2.525c.636-.247 1.363-.416 2.427-.465C8.901 2.013 9.256 2 11.685 2h.63zm-.081 1.802h-.468c-2.456 0-2.784.011-3.807.058-.975.045-1.504.207-1.857.344-.467.182-.8.398-1.15.748-.35.35-.566.683-.748 1.15-.137.353-.3.882-.344 1.857-.047 1.023-.058 1.351-.058 3.807v.468c0 2.456.011 2.784.058 3.807.045.975.207 1.504.344 1.857.182.466.399.8.748 1.15.35.35.683.566 1.15.748.353.137.882.3 1.857.344 1.054.048 1.37.058 4.041.058h.08c2.597 0 2.917-.01 3.96-.058.976-.045 1.505-.207 1.858-.344.466-.182.8-.398 1.15-.748.35-.35.566-.683.748-1.15.137-.353.3-.882.344-1.857.048-1.055.058-1.37.058-4.041v-.08c0-2.597-.01-2.917-.058-3.96-.045-.976-.207-1.505-.344-1.858a3.097 3.097 0 00-.748-1.15 3.098 3.098 0 00-1.15-.748c-.353-.137-.882-.3-1.857-.344-1.023-.047-1.351-.058-3.807-.058zM12 6.865a5.135 5.135 0 110 10.27 5.135 5.135 0 010-10.27zm0 1.802a3.333 3.333 0 100 6.666 3.333 3.333 0 000-6.666zm5.338-3.205a1.2 1.2 0 110 2.4 1.2 1.2 0 010-2.4z" clip-rule="evenodd" />
            </svg>
            <a href="https://www.instagram.com/smart_cut_services?igsh=ajI4YzhhcnozY2pn&utm_source=qr" target="_blank" class="text-blue-400 hover:text-blue-300 transition-colors duration-200">Instagram</a>
          </li>
          <li class="flex items-center space-x-2">
            <svg class="w-4 h-4 text-black" fill="currentColor" viewBox="0 0 24 24">
              <path d="M12.525.02c1.31-.02 2.61-.01 3.91-.02.08 1.53.63 3.09 1.75 4.17 1.12 1.11 2.7 1.62 4.24 1.79v4.03c-1.44-.05-2.89-.35-4.2-.97-.57-.26-1.1-.59-1.62-.93-.01 2.92.01 5.84-.02 8.75-.08 1.4-.54 2.79-1.35 3.94-1.31 1.92-3.58 3.17-5.91 3.21-1.43.08-2.86-.31-4.08-1.03-2.02-1.19-3.44-3.37-3.65-5.71-.02-.5-.03-1-.01-1.49.18-1.9 1.12-3.72 2.58-4.96 1.66-1.44 3.98-2.13 6.15-1.72.02 1.48-.04 2.96-.04 4.44-.99-.32-2.15-.23-3.02.37-.63.41-1.11 1.04-1.36 1.75-.21.51-.15 1.07-.14 1.61.24 1.64 1.82 3.02 3.5 2.87 1.12-.01 2.19-.66 2.77-1.61.19-.33.4-.67.41-1.06.1-1.79.06-3.57.07-5.36.01-4.03-.01-8.05.02-12.07z"/>
            </svg>
            <a href="https://www.tiktok.com/@smart.cut.service?is_from_webapp=1&sender_device=pc" target="_blank" class="text-blue-400 hover:text-blue-300 transition-colors duration-200">TikTok</a>
          </li>
          <li class="flex items-center space-x-2">
            <svg class="w-4 h-4 text-green-400" fill="currentColor" viewBox="0 0 24 24">
              <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.76.982.998-3.675-.236-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.9 6.994c-.004 5.45-4.438 9.88-9.888 9.88m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.333.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.333 11.893-11.893 0-3.18-1.24-6.162-3.495-8.411"/>
            </svg>
            <a href="https://wa.me/50934913988" target="_blank" class="text-blue-400 hover:text-blue-300 transition-colors duration-200">WhatsApp: +509 34 91 39 88</a>
          </li>
          <li class="flex items-center space-x-2">
            <svg class="w-4 h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/>
            </svg>
            <a href="mailto:smartcutservices87@outlook.com" class="text-blue-400 hover:text-blue-300 transition-colors duration-200">smartcutservices87@outlook.com</a>
          </li>
          <li class="flex items-center space-x-2">
            <svg class="w-4 h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"/>
            </svg>
            <span>Tel: +509 34 91 39 88</span>
          </li>
        </ul>
      </div>

      <!-- Section Politiques -->
      <div class="space-y-4">
        <h3 class="text-lg font-semibold text-gray-100">Informations légales</h3>
        <ul class="space-y-2 text-sm">
          <li><a href="confi.html" class="text-blue-400 hover:text-blue-300 transition-colors duration-200">Politique de confidentialité</a></li>
          <li><a href="livreson.html" class="text-blue-400 hover:text-blue-300 transition-colors duration-200">Politique de livraison</a></li>
        </ul>
      </div>
    </div>

    <!-- Version mobile -->
    <div class="md:hidden space-y-6">
      <div class="space-y-4">
        <h3 class="text-base font-semibold text-gray-100">Notre entreprise</h3>
        <p class="text-sm leading-relaxed text-gray-400">
          Votre boutique en ligne de confiance. Nous nous engageons à vous offrir la meilleure expérience d'achat.
        </p>
      </div>

      <div class="space-y-4">
        <h3 class="text-base font-semibold text-gray-100">Navigation rapide</h3>
        <ul class="space-y-2 text-sm">
          <li><a href="index.html" class="text-blue-400 hover:text-blue-300 transition-colors duration-200">Accueil</a></li>
          <li><a href="catalogue.html" class="text-blue-400 hover:text-blue-300 transition-colors duration-200">Catalogue</a></li>
          <li><a href="catalogue.html#panier" class="text-blue-400 hover:text-blue-300 transition-colors duration-200">Panier</a></li>
          <li><a href="about.html" class="text-blue-400 hover:text-blue-300 transition-colors duration-200">À propos</a></li>
        </ul>
      </div>

      <!-- Section Réseaux sociaux et contact (mobile) -->
      <div class="space-y-4">
        <h3 class="text-base font-semibold text-gray-100">Réseaux sociaux & Contact</h3>
        <ul class="space-y-3 text-sm">
          <li class="flex items-center space-x-2">
            <svg class="w-4 h-4 text-blue-400" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true">
              <path fill-rule="evenodd" d="M22 12c0-5.523-4.477-10-10-10S2 6.477 2 12c0 4.991 3.657 9.128 8.438 9.878v-6.987h-2.54V12h2.54V9.797c0-2.506 1.492-3.89 3.777-3.89 1.094 0 2.238.195 2.238.195v2.46h-1.26c-1.243 0-1.63.771-1.63 1.562V12h2.773l-.443 2.89h-2.33v6.988C18.343 21.128 22 16.991 22 12z" clip-rule="evenodd" />
            </svg>
            <a href="https://www.facebook.com/profile.php?id=61573890875251" target="_blank" class="text-blue-400 hover:text-blue-300 transition-colors duration-200">Facebook</a>
          </li>
          <li class="flex items-center space-x-2">
            <svg class="w-4 h-4 text-pink-400" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true">
              <path fill-rule="evenodd" d="M12.315 2c2.43 0 2.784.013 3.808.06 1.064.049 1.791.218 2.427.465a4.902 4.902 0 011.772 1.153 4.902 4.902 0 011.153 1.772c.247.636.416 1.363.465 2.427.048 1.067.06 1.407.06 4.123v.08c0 2.643-.012 2.987-.06 4.043-.049 1.064-.218 1.791-.465 2.427a4.902 4.902 0 01-1.153 1.772 4.902 4.902 0 01-1.772 1.153c-.636.247-1.363.416-2.427.465-1.067.048-1.407.06-4.123.06h-.08c-2.643 0-2.987-.012-4.043-.06-1.064-.049-1.791-.218-2.427-.465a4.902 4.902 0 01-1.772-1.153 4.902 4.902 0 01-1.153-1.772c-.247-.636-.416-1.363-.465-2.427-.047-1.024-.06-1.379-.06-3.808v-.63c0-2.43.013-2.784.06-3.808.049-1.064.218-1.791.465-2.427a4.902 4.902 0 011.153-1.772A4.902 4.902 0 015.45 2.525c.636-.247 1.363-.416 2.427-.465C8.901 2.013 9.256 2 11.685 2h.63zm-.081 1.802h-.468c-2.456 0-2.784.011-3.807.058-.975.045-1.504.207-1.857.344-.467.182-.8.398-1.15.748-.35.35-.566.683-.748 1.15-.137.353-.3.882-.344 1.857-.047 1.023-.058 1.351-.058 3.807v.468c0 2.456.011 2.784.058 3.807.045.975.207 1.504.344 1.857.182.466.399.8.748 1.15.35.35.683.566 1.15.748.353.137.882.3 1.857.344 1.054.048 1.37.058 4.041.058h.08c2.597 0 2.917-.01 3.96-.058.976-.045 1.505-.207 1.858-.344.466-.182.8-.398 1.15-.748.35-.35.566-.683.748-1.15.137-.353.3-.882.344-1.857.048-1.055.058-1.37.058-4.041v-.08c0-2.597-.01-2.917-.058-3.96-.045-.976-.207-1.505-.344-1.858a3.097 3.097 0 00-.748-1.15 3.098 3.098 0 00-1.15-.748c-.353-.137-.882-.3-1.857-.344-1.023-.047-1.351-.058-3.807-.058zM12 6.865a5.135 5.135 0 110 10.27 5.135 5.135 0 010-10.27zm0 1.802a3.333 3.333 0 100 6.666 3.333 3.333 0 000-6.666zm5.338-3.205a1.2 1.2 0 110 2.4 1.2 1.2 0 010-2.4z" clip-rule="evenodd" />
            </svg>
            <a href="https://www.instagram.com/smart_cut_services?igsh=ajI4YzhhcnozY2pn&utm_source=qr" target="_blank" class="text-blue-400 hover:text-blue-300 transition-colors duration-200">Instagram</a>
          </li>
          <li class="flex items-center space-x-2">
            <svg class="w-4 h-4 text-black" fill="currentColor" viewBox="0 0 24 24">
              <path d="M12.525.02c1.31-.02 2.61-.01 3.91-.02.08 1.53.63 3.09 1.75 4.17 1.12 1.11 2.7 1.62 4.24 1.79v4.03c-1.44-.05-2.89-.35-4.2-.97-.57-.26-1.1-.59-1.62-.93-.01 2.92.01 5.84-.02 8.75-.08 1.4-.54 2.79-1.35 3.94-1.31 1.92-3.58 3.17-5.91 3.21-1.43.08-2.86-.31-4.08-1.03-2.02-1.19-3.44-3.37-3.65-5.71-.02-.5-.03-1-.01-1.49.18-1.9 1.12-3.72 2.58-4.96 1.66-1.44 3.98-2.13 6.15-1.72.02 1.48-.04 2.96-.04 4.44-.99-.32-2.15-.23-3.02.37-.63.41-1.11 1.04-1.36 1.75-.21.51-.15 1.07-.14 1.61.24 1.64 1.82 3.02 3.5 2.87 1.12-.01 2.19-.66 2.77-1.61.19-.33.4-.67.41-1.06.1-1.79.06-3.57.07-5.36.01-4.03-.01-8.05.02-12.07z"/>
            </svg>
            <a href="https://www.tiktok.com/@smart.cut.service?is_from_webapp=1&sender_device=pc" target="_blank" class="text-blue-400 hover:text-blue-300 transition-colors duration-200">TikTok</a>
          </li>
          <li class="flex items-center space-x-2">
            <svg class="w-4 h-4 text-green-400" fill="currentColor" viewBox="0 0 24 24">
              <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.76.982.998-3.675-.236-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.9 6.994c-.004 5.45-4.438 9.88-9.888 9.88m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.333.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.333 11.893-11.893 0-3.18-1.24-6.162-3.495-8.411"/>
            </svg>
            <a href="https://wa.me/50934913988" target="_blank" class="text-blue-400 hover:text-blue-300 transition-colors duration-200">WhatsApp: +509 34 91 39 88</a>
          </li>
          <li class="flex items-center space-x-2">
            <svg class="w-4 h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/>
            </svg>
            <a href="mailto:smartcutservices87@outlook.com" class="text-blue-400 hover:text-blue-300 transition-colors duration-200">smartcutservices87@outlook.com</a>
          </li>
          <li class="flex items-center space-x-2">
            <svg class="w-4 h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"/>
            </svg>
            <span>Tel: +509 34 91 39 88</span>
          </li>
        </ul>
      </div>

      <div class="space-y-4">
        <h3 class="text-base font-semibold text-gray-100">Informations légales</h3>
        <ul class="space-y-2 text-sm">
          <li><a href="confi.html" class="text-blue-400 hover:text-blue-300 transition-colors duration-200">Politique de confidentialité</a></li>
          <li><a href="livreson.html" class="text-blue-400 hover:text-blue-300 transition-colors duration-200">Politique de livraison</a></li>
        </ul>
      </div>
    </div>

    <!-- Copyright -->
    <div class="mt-10 pt-6 border-t border-gray-800 text-center text-sm text-gray-500">
      <p>&copy; 2026 Smart cut services . Tous droits réservés.</p>
    </div>
  </div>
</div>
        <!-- Footer -->
        <footer id="footer" class="bg-gray-800 hidden text-white py-8">
            <div class="container mx-auto px-4">
                <div class="flex flex-col md:flex-row justify-between items-center">
                    <div class="mb-4 md:mb-0">
                        <div class="flex items-center space-x-2 mb-2">
                            <div class="w-8 h-8 bg-blue-500 rounded-lg flex items-center justify-center">
                                <span class="text-white font-bold">IZI</span>
                            </div>
                            <span class="font-heading font-bold text-xl">Smart cut services</span>
                        </div>
                        <p class="text-gray-400">Votre boutique en ligne préférée</p>
                    </div>
                    
                    <div class="text-center md:text-right">
                        <p class="text-gray-400">&copy; <span id="current-year">2026</span> Smart cut servicess. Tous droits réservés.</p>
                        <p class="text-gray-400">Conçu avec <i class="fas fa-heart text-red-400"></i> pour nos clients</p>
                    </div>
                </div>
            </div>
        </footer>
    </div>
    
    <!-- Product Options Modal -->
    <div id="product-options-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <div class="p-6">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="font-heading font-bold text-xl text-gray-800">Choisissez les options</h3>
                    <button onclick="closeProductOptionsModal()" class="text-gray-400 hover:text-gray-600">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>
                
                <div id="product-options-content">
                    <!-- Options will be loaded dynamically -->
                </div>
                
                <div class="mt-8 flex justify-end space-x-3">
                    <button onclick="closeProductOptionsModal()" class="px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors duration-300">
                        Annuler
                    </button>
                    <button onclick="addToCartWithOptions()" class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors duration-300">
                        Ajouter au panier
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Checkout Modal - Multi-step -->
    <div id="checkout-modal" class="modal-overlay hidden">
        <div class="modal-content max-w-2xl">
            <div class="p-6">
                <!-- Modal Header -->
                <div class="flex justify-between items-center mb-6">
                    <h3 class="font-heading font-bold text-xl text-gray-800">Finaliser la commande</h3>
                    <button onclick="closeCheckoutModal()" class="text-gray-400 hover:text-gray-600">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>
                
                <!-- Step Indicators -->
                <div class="flex justify-between mb-8 relative">
                    <div class="absolute top-4 left-0 right-0 h-1 bg-gray-200 -z-10"></div>
                    
                    <div class="step-indicator flex flex-col items-center">
                        <div class="w-8 h-8 rounded-full bg-blue-600 text-white flex items-center justify-center mb-2 completed">
                            <i class="fas fa-check text-sm"></i>
                        </div>
                        <span class="text-xs font-medium">Panier</span>
                    </div>
                    
                    <div class="step-indicator flex flex-col items-center">
                        <div id="step-2-indicator" class="w-8 h-8 rounded-full bg-blue-600 text-white flex items-center justify-center mb-2 active">
                            <span class="text-sm">2</span>
                        </div>
                        <span class="text-xs font-medium">Livraison</span>
                    </div>
                    
                    <div class="step-indicator flex flex-col items-center">
                        <div id="step-3-indicator" class="w-8 h-8 rounded-full bg-gray-200 text-gray-600 flex items-center justify-center mb-2">
                            <span class="text-sm">3</span>
                        </div>
                        <span class="text-xs font-medium">Paiement</span>
                    </div>
                    
                    <div class="step-indicator flex flex-col items-center">
                        <div id="step-4-indicator" class="w-8 h-8 rounded-full bg-gray-200 text-gray-600 flex items-center justify-center mb-2">
                            <span class="text-sm">4</span>
                        </div>
                        <span class="text-xs font-medium">Confirmation</span>
                    </div>
                </div>
                
                <!-- Multi-step Form -->
                <div id="checkout-form-container">
                    <!-- Step 1: Delivery Method (will be shown first) -->
                    <div id="step-1-content" class="space-y-6">
                        <h4 class="font-medium text-gray-800 mb-4">Sélectionnez votre mode de livraison</h4>
                        
                        <!-- Delivery Options -->
                        <div class="space-y-4">
                            <!-- Meeting Point Option -->
                            <div class="delivery-point border border-gray-300 rounded-xl p-4" data-type="meeting_point">
                                <div class="flex items-start space-x-4">
                                    <div class="flex items-center h-6">
                                        <input type="radio" id="delivery-meeting" name="deliveryMethod" value="meeting_point" class="h-5 w-5 text-blue-600">
                                    </div>
                                    <div class="flex-1">
                                        <label for="delivery-meeting" class="cursor-pointer">
                                            <div class="flex justify-between items-start">
                                                <div>
                                                    <span class="font-medium text-gray-900">Point de rencontre</span>
                                                    <p class="text-sm text-gray-600 mt-1">Rencontrez notre livreur à un point convenu</p>
                                                </div>
                                                <span class="text-green-600 font-medium">Payant</span>
                                            </div>
                                        </label>
                                        
                                        <!-- Meeting Points Selection (hidden by default) -->
                                        <div id="meeting-points-container" class="mt-4 hidden">
                                            <label class="block text-sm font-medium text-gray-700 mb-3">Choisissez un point de rencontre</label>
                                            <div id="meeting-points-list" class="space-y-3 max-h-60 overflow-y-auto pr-2">
                                                <!-- Meeting points loaded dynamically -->
                                            </div>
                                            
                                            <!-- Custom Meeting Point -->
                                            <div class="mt-4 pt-4 border-t border-gray-200">
                                                <label class="block text-sm font-medium text-gray-700 mb-2">Ou proposez un lieu</label>
                                                <textarea 
                                                    id="custom-meeting-point" 
                                                    placeholder="Décrivez le lieu de rencontre que vous proposez..."
                                                    class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                                    rows="2"
                                                ></textarea>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Store Pickup Option -->
                            <div class="delivery-point border border-gray-300 rounded-xl p-4" data-type="store_pickup">
                                <div class="flex items-start space-x-4">
                                    <div class="flex items-center h-6">
                                        <input type="radio" id="delivery-store" name="deliveryMethod" value="store_pickup" class="h-5 w-5 text-blue-600">
                                    </div>
                                    <div class="flex-1">
                                        <label for="delivery-store" class="cursor-pointer">
                                            <div class="flex justify-between items-start">
                                                <div>
                                                    <span class="font-medium text-gray-900">Retrait en magasin</span>
                                                    <p class="text-sm text-gray-600 mt-1">Récupérez votre commande dans l'un de nos points de vente</p>
                                                </div>
                                                <span class="text-green-600 font-medium">Gratuit</span>
                                            </div>
                                        </label>
                                        
                                        <!-- Store Locations Selection (hidden by default) -->
                                        <div id="store-locations-container" class="mt-4 hidden">
                                            <label class="block text-sm font-medium text-gray-700 mb-3">Choisissez un point de retrait</label>
                                            <div id="store-locations-list" class="space-y-3 max-h-60 overflow-y-auto pr-2">
                                                <!-- Store locations loaded dynamically -->
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Navigation Buttons -->
                        <div class="pt-6 border-t border-gray-200 flex justify-between">
                            <button onclick="closeCheckoutModal()" class="px-6 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors duration-300">
                                Annuler
                            </button>
                            <button onclick="goToStep(2)" class="px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors duration-300">
                                Suivant
                            </button>
                        </div>
                    </div>
                    
                    <!-- Step 2: Payment Method -->
                    <div id="step-2-content" class="space-y-6 hidden">
                        <h4 class="font-medium text-gray-800 mb-4">Sélectionnez votre mode de paiement</h4>
                        
                        <!-- Payment Options -->
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <!-- In Person Payment -->
                            <div class="payment-option border border-gray-300 rounded-xl p-4" data-type="in_person">
                                <div class="flex items-start space-x-3">
                                    <div class="flex items-center h-6 mt-1">
                                        <input type="radio" id="payment-in-person" name="paymentMethod" value="in_person" class="h-5 w-5 text-blue-600">
                                    </div>
                                    <div>
                                        <label for="payment-in-person" class="cursor-pointer">
                                            <div class="font-medium text-gray-900 mb-1">Paiement en personne</div>
                                            <p class="text-sm text-gray-600">Payez lors de la livraison ou du retrait</p>
                                        </label>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- MonCash Payment -->
                            <div class="payment-option border border-gray-300 rounded-xl p-4" data-type="moncash">
                                <div class="flex items-start space-x-3">
                                    <div class="flex items-center h-6 mt-1">
                                        <input type="radio" id="payment-moncash" name="paymentMethod" value="moncash" class="h-5 w-5 text-blue-600">
                                    </div>
                                    <div>
                                        <label for="payment-moncashy" class="cursor-pointer">
                                            <div class="font-medium text-gray-900 mb-1">MonCash</div>
                                            <p class="text-sm text-gray-600">Integration en attente</p>
                                        </label>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- NatCash Payment -->
                            <div class="payment-option border border-gray-300 rounded-xl p-4" data-type="natcash">
                                <div class="flex items-start space-x-3">
                                    <div class="flex items-center h-6 mt-1">
                                        <input type="radio" id="payment-natcash" name="paymentMethod" value="natcash" class="h-5 w-5 text-blue-600">
                                    </div>
                                    <div>
                                        <label for="payment-natcasyh" class="cursor-pointer">
                                            <div class="font-medium text-gray-900 mb-1">NatCash</div>
                                            <p class="text-sm text-gray-600">Integration en attente</p>
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Payment Instructions (for mobile payments) -->
                        <div id="payment-instructions" class="hidden">
                            <div class="mt-6 p-4 bg-blue-50 rounded-lg">
                                <h5 class="font-medium text-blue-900 mb-3">Instructions de paiement</h5>
                                <div class="space-y-4">
                                    <div id="moncash-instructions" class="hidden">
                                        <p class="text-sm text-blue-800 mb-3">
                                            1. Ouvrez l'application MonCash<br>
                                            2. Allez dans "Payer une facture"<br>
                                            3. Saisissez le numéro: <strong>+509 48 00 0000</strong><br>
                                            4. Entrez le montant: <strong id="moncash-amount">0 HTG</strong><br>
                                            5. Confirmez le paiement
                                        </p>
                                        <div id="moncash-qr" class="qr-container"></div>
                                    </div>
                                    
                                    <div id="natcash-instructions" class="hidden">
                                        <p class="text-sm text-blue-800 mb-3">
                                            1. Ouvrez l'application NatCash<br>
                                            2. Allez dans "Effectuer un paiement"<br>
                                            3. Saisissez le numéro: <strong>+509 48 11 1111</strong><br>
                                            4. Entrez le montant: <strong id="natcash-amount">0 HTG</strong><br>
                                            5. Confirmez le paiement
                                        </p>
                                        <div id="natcash-qr" class="qr-container"></div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Payment Verification Form -->
                            <div id="payment-verification-form" class="mt-6 p-6 bg-gray-50 rounded-lg hidden">
                                <h5 class="font-medium text-gray-900 mb-4">Vérification du paiement</h5>
                                <div class="space-y-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">ID du transfert *</label>
                                        <input type="text" id="transfer-id" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="Ex: M123456789">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">Numéro envoyeur *</label>
                                        <input type="tel" id="sender-phone" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="Ex: +509 48 00 0000">
                                    </div>
                                    <div class="grid grid-cols-2 gap-4">
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-1">Date du transfert *</label>
                                            <input type="date" id="transfer-date" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-1">Heure du transfert *</label>
                                            <input type="time" id="transfer-time" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                        </div>
                                    </div>
                                    <button onclick="verifyPayment()" class="w-full py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors duration-300">
                                        Soumettre pour vérification
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- In Person Payment Warning -->
                        <div id="in-person-warning" class="mt-6 p-4 bg-yellow-50 rounded-lg hidden">
                            <div class="flex">
                                <i class="fas fa-exclamation-triangle text-yellow-500 mt-1 mr-3"></i>
                                <div>
                                    <h5 class="font-medium text-yellow-900 mb-1">Important</h5>
                                    <p class="text-sm text-red-800">
Vous avez 72 heures pour retirer votre colis. Passer ce delais, le colis ne sera plus disponible au point de livraison choisi. Votre colis pourra être récupérer dans notre succursale principale. Merci pour votre compréhension!                                     </p>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Navigation Buttons -->
                        <div class="pt-6 border-t border-gray-200 flex justify-between">
                            <button onclick="goToStep(1)" class="px-6 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors duration-300">
                                Retour
                            </button>
                            <button onclick="goToStep(3)" id="next-step-2" class="px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors duration-300">
                                Suivant
                            </button>
                        </div>
                    </div>
                    
                    <!-- Step 3: Customer Information -->
                    <div id="step-3-content" class="space-y-6 hidden">
                        <h4 class="font-medium text-gray-800 mb-4">Vos informations</h4>
                        
                        <!-- Customer Info Form -->
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Nom complet *</label>
                                <input type="text" id="customer-name" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Numéro de téléphone *</label>
                                <input type="tel" id="customer-phone" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="+509 48 00 0000">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Email (optionnel)</label>
                                <input type="email" id="customer-email" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="votre@email.com">
                            </div>
                        </div>
                        
                        <!-- Order Summary -->
                        <div class="mt-6 p-4 bg-gray-50 rounded-lg">
    <h5 class="font-medium text-gray-900 mb-3">Récapitulatif</h5>

    <div class="space-y-2">
        <div class="flex justify-between text-sm">
            <span class="text-gray-600">Articles</span>
            <span id="summary-items-count">0</span>
        </div>

        <div class="flex justify-between text-sm">
            <span class="text-gray-600">Sous-total</span>
            <span id="summary-subtotal">0 HTG</span>
        </div>

        <!-- Frais de livraison (poids + fragile + lieu) -->
        <div class="flex justify-between text-sm">
            <span class="text-gray-600">Frais de livraison</span>
            <span id="summary-delivery-fee">0 HTG</span>
        </div>

        <!-- Détail du point de rencontre -->
        <div
            id="summary-meeting-point"
            class="hidden text-xs text-gray-500 pt-1"
        >
            📍 <span id="summary-meeting-point-name"></span>
            <span class="ml-1">
                (+<span id="summary-meeting-point-fee">0</span>)
            </span>
        </div>

        <div class="pt-2 border-t border-gray-200 flex justify-between font-medium">
            <span>Total</span>
            <span id="summary-total">0 HTG</span>
        </div>
    </div>
</div>

                        
                        <!-- Navigation Buttons -->
                        <div class="pt-6 border-t border-gray-200 flex justify-between">
                            <button onclick="goToStep(2)" class="px-6 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors duration-300">
                                Retour
                            </button>
                            <button onclick="submitOrder()" class="px-6 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors duration-300">
                                Confirmer la commande
                            </button>
                        </div>
                    </div>
                    
                    <!-- Step 4: Order Confirmation -->
                    <div id="step-4-content" class="space-y-6 hidden">
                        <div class="text-center py-8">
                            <div class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
                                <i class="fas fa-check text-green-600 text-2xl"></i>
                            </div>
                            <h4 class="font-medium text-gray-800 mb-2 text-xl">Commande confirmée !</h4>
                            <p class="text-gray-600 mb-6">Votre commande a été enregistrée avec succès</p>
                            
                            <!-- Order Details -->
                            <div class="bg-gray-50 rounded-lg p-6 mb-6">
                                <div class="mb-4">
                                    <div class="text-sm text-gray-600">Numéro de commande</div>
                                    <div id="order-code" class="text-xl font-bold text-blue-600"></div>
                                </div>
                                <div class="mb-4">
                                    <div class="text-sm text-gray-600">Mode de livraison</div>
                                    <div id="order-delivery-method" class="font-medium"></div>
                                </div>
                                <div>
                                    <div class="text-sm text-gray-600">Mode de paiement</div>
                                    <div id="order-payment-method" class="font-medium"></div>
                                </div>
                            </div>
                            
                            <!-- Download Receipt Button -->
                            <div class="mb-6">
                                <p class="text-sm text-gray-600 mb-4">
                                    Un reçu PDF va être téléchargé sur votre téléphone. Présentez ce reçu pour retirer votre colis.
                                </p>
                                <button onclick="downloadReceipt()" class="px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors duration-300">
                                    <i class="fas fa-download mr-2"></i>Télécharger le reçu
                                </button>
                            </div>
                            
                            <!-- Payment Pending Message -->
                            <div id="payment-pending-message" class="p-4 bg-yellow-50 rounded-lg hidden">
                                <p class="text-sm text-yellow-800">
                                    Votre paiement est en cours de vérification. Vous recevrez une notification une fois vérifié.
                                </p>
                            </div>
                            
                            <!-- Confirmation Button -->
                            <button onclick="closeCheckoutModal()" class="px-6 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors duration-300">
                                <i class="fas fa-check mr-2"></i>J'ai compris
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Payment Success Modal -->
    <div id="payment-success-modal" class="modal-overlay hidden">
        <div class="modal-content max-w-md">
            <div class="p-6">
                <div class="text-center py-6">
                    <div class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
                        <i class="fas fa-check text-green-600 text-2xl"></i>
                    </div>
                    <h4 class="font-medium text-gray-800 mb-2 text-xl">Paiement vérifié !</h4>
                    <p class="text-gray-600 mb-6">Votre paiement a été confirmé avec succès</p>
                    
                    <div class="mb-6">
                        <p class="text-sm text-gray-600 mb-4">
                            Vous pouvez maintenant télécharger votre reçu de commande pour le retrait.
                        </p>
                        <button onclick="downloadOrderReceipt()" class="px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors duration-300">
                            <i class="fas fa-download mr-2"></i>Télécharger le reçu
                        </button>
                    </div>
                    
                    <button onclick="closePaymentSuccessModal()" class="px-6 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors duration-300">
                        Fermer
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Toast Notification Container -->
    <div id="toast-container" class="fixed bottom-4 right-4 z-50 flex flex-col space-y-2 max-w-md"></div>

<!-- Ajouter cette section dans la page panier, après la section de récapitulatif -->
<div id="pending-orders-section" class="mt-12 hidden">
    <!-- Le contenu sera généré dynamiquement par JavaScript -->
</div>
<!-- Image Fullscreen Modal -->
<div id="imageModal" class="image-modal hidden">
    <button class="close-btn" aria-label="Fermer">&times;</button>

    <button id="modalPrev"
        class="absolute left-4 md:left-8 text-white text-5xl z-10">
        ‹
    </button>

    <img id="modalImage" src="" alt="Aperçu produit">

    <button id="modalNext"
        class="absolute right-4 md:right-8 text-white text-5xl z-10">
        ›
    </button>

    <div id="modalDots" class="absolute bottom-6 flex gap-2"></div>
</div>


<script>
    // ============================================
    // CONFIGURATION & INITIALIZATION
    // ============================================
    
    // Configuration Firebase
     const firebaseConfig = {
  apiKey: "AIzaSyCOifibU2E6Vo-3Ohg-WmAHa43sa5HyFuw",
  authDomain: "smartcutservices.firebaseapp.com",
  projectId: "smartcutservices",
  storageBucket: "smartcutservices.firebasestorage.app",
  messagingSenderId: "589013273323",
  appId: "1:589013273323:web:415772e7b94f6bb37d8cae",
  measurementId: "G-R8GJXQP7BD"}

    
    // Application State
    window.appState = {
        currentPage: 'catalogue',
        cartSessionId: null,
        cartData: null,
        products: [],
        filteredProducts: [],
        categories: [],
        isLoading: false,
        deliveryRules: [],
        meetingPoints: [],
        storeLocations: [],
        currentProductForOptions: null,
        selectedOptions: {},
        currentCategoryFilter: 'all',
        currentSearchTerm: '',
        checkoutTotal: 0,
        deliveryFee: 0,
        currentCheckoutStep: 1,
        checkoutData: {
            deliveryMethod: null,
            paymentMethod: null,
            selectedMeetingPoint: null,
            selectedStoreLocation: null,
            customMeetingPoint: null,
            paymentInfo: null,
            customerInfo: null
        },
        currentOrder: null,
        pendingOrders: [],
        paymentTransfers: []
    };

    // ============================================
    // MODULE 1: Firebase Initialization & Core Utilities
    // ============================================
    const FirebaseModule = (() => {
        let firebaseApp = null;
        let firestoreDb = null;
        
        const initializeFirebase = () => {
            try {
                firebaseApp = firebase.initializeApp(firebaseConfig);
                firestoreDb = firebase.firestore();
                console.log('✅ Firebase initialisé avec succès');
                return true;
            } catch (error) {
                console.error('❌ Erreur lors de l\'initialisation Firebase:', error);
                showToast('Erreur de connexion à la base de données', 'error');
                return false;
            }
        };
        
        const getFirestore = () => {
            if (!firestoreDb) {
                initializeFirebase();
            }
            return firestoreDb;
        };
        
        const generateId = () => {
            return Date.now().toString(36) + Math.random().toString(36).substr(2);
        };
        
        const formatPrice = (price) => {
            return new Intl.NumberFormat('fr-HT', {
                style: 'currency',
                currency: 'HTG'
            }).format(price);
        };
        
        const calculateDeliveryFee = (weight, rules) => {
            if (!rules || rules.length === 0) return 0;
            
            // Trier les règles par poids maximum croissant
            const sortedRules = [...rules].sort((a, b) => a.maxWeight - b.maxWeight);
            
            // Trouver la règle applicable
            for (const rule of sortedRules) {
                if (weight <= rule.maxWeight) {
                    return rule.fee || 0;
                }
            }
            
            // Si le poids dépasse toutes les règles, utiliser la dernière
            return sortedRules[sortedRules.length - 1]?.fee || 0;
        };
        
        return {
            initializeFirebase,
            getFirestore,
            generateId,
            formatPrice,
            calculateDeliveryFee
        };
    })();

    // ============================================
    // MODULE 2: Toast Notifications
    // ============================================
    const ToastModule = (() => {
        window.showToast = (message, type = 'info') => {
            const toastContainer = document.getElementById('toast-container');
            if (!toastContainer) return;
            
            const toastId = 'toast-' + Date.now();
            const bgColor = {
                success: 'bg-green-500',
                error: 'bg-red-500',
                warning: 'bg-yellow-500',
                info: 'bg-blue-500'
            }[type];
            
            const icon = {
                success: 'fa-check-circle',
                error: 'fa-exclamation-circle',
                warning: 'fa-exclamation-triangle',
                info: 'fa-info-circle'
            }[type];
            
            const toast = document.createElement('div');
            toast.id = toastId;
            toast.className = `${bgColor} text-white px-4 py-3 rounded-lg shadow-lg flex justify-between items-center toast-enter`;
            toast.innerHTML = `
                <div class="flex items-center">
                    <i class="fas ${icon} mr-3"></i>
                    <span>${message}</span>
                </div>
                <button onclick="removeToast('${toastId}')" class="ml-4 opacity-75 hover:opacity-100">
                    <i class="fas fa-times"></i>
                </button>
            `;
            
            toastContainer.appendChild(toast);
            
            setTimeout(() => {
                removeToast(toastId);
            }, 5000);
        };
        
        window.removeToast = (toastId) => {
            const toast = document.getElementById(toastId);
            if (toast) {
                toast.classList.remove('toast-enter');
                toast.classList.add('toast-exit');
                setTimeout(() => toast.remove(), 300);
            }
        };
        
        return { showToast: window.showToast };
    })();

    // ============================================
    // MODULE 3: Cart Session Management
    // ============================================
    const CartSessionModule = (() => {
        const CART_SESSION_KEY = 'cartSessionId';
        
        const initializeCartSession = async () => {
            const db = FirebaseModule.getFirestore();
            let sessionId = localStorage.getItem(CART_SESSION_KEY);
            
            try {
                if (!sessionId) {
                    sessionId = FirebaseModule.generateId();
                    const newCart = {
                        items: [],
                        subtotal: 0,
                        totalWeight: 0,
                        oldPriceTotal: 0,
                        createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                        updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                    };
                    
                    await db.collection('cart_sessions').doc(sessionId).set(newCart);
                    localStorage.setItem(CART_SESSION_KEY, sessionId);
                    console.log('🛒 Nouvelle session panier créée:', sessionId);
                    
                    window.appState.cartSessionId = sessionId;
                    window.appState.cartData = newCart;
                    
                    return newCart;
                } else {
                    const cartDoc = await db.collection('cart_sessions').doc(sessionId).get();
                    
                    if (cartDoc.exists) {
                        const cartData = cartDoc.data();
                        
                        window.appState.cartSessionId = sessionId;
                        window.appState.cartData = cartData;
                        
                        console.log('🛒 Session panier chargée:', sessionId);
                        return cartData;
                    } else {
                        localStorage.removeItem(CART_SESSION_KEY);
                        return await initializeCartSession();
                    }
                }
            } catch (error) {
                console.error('❌ Erreur lors de l\'initialisation du panier:', error);
                showToast('Erreur de chargement du panier', 'error');
                
                const fallbackCart = {
                    items: [],
                    subtotal: 0,
                    totalWeight: 0,
                    oldPriceTotal: 0
                };
                
                window.appState.cartData = fallbackCart;
                return fallbackCart;
            }
        };
        
        const updateCart = async (cartData) => {
            const db = FirebaseModule.getFirestore();
            const sessionId = window.appState.cartSessionId;
            
            if (!sessionId) {
                console.error('❌ Aucune session panier active');
                return false;
            }
            
            try {
                await db.collection('cart_sessions').doc(sessionId).update({
                    ...cartData,
                    updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                });
                
                window.appState.cartData = cartData;
                updateCartBadge(cartData.items.length);
                
                return true;
            } catch (error) {
                console.error('❌ Erreur lors de la mise à jour du panier:', error);
                showToast('Erreur de mise à jour du panier', 'error');
                return false;
            }
        };
        
        const addToCart = async (product, selectedOptions = {}, quantity = 1) => {
            if (!product.isAvailable || product.stockQuantity <= 0) {
                showToast('Produit indisponible', 'error');
                return false;
            }
            
            const cart = window.appState.cartData || { items: [] };
            const existingItemIndex = cart.items.findIndex(item => 
                item.productId === product.id && 
                JSON.stringify(item.selectedOptions) === JSON.stringify(selectedOptions)
            );
            
            let updatedItems;
            
            if (existingItemIndex >= 0) {
                updatedItems = [...cart.items];
                const newQuantity = updatedItems[existingItemIndex].quantity + quantity;
                
                if (newQuantity > product.stockQuantity) {
                    showToast(`Stock limité à ${product.stockQuantity} unités`, 'warning');
                    return false;
                }
                
                updatedItems[existingItemIndex].quantity = newQuantity;
                updatedItems[existingItemIndex].finalPrice = updatedItems[existingItemIndex].unitPrice * newQuantity;
            } else {
                if (quantity > product.stockQuantity) {
                    showToast(`Stock limité à ${product.stockQuantity} unités`, 'warning');
                    return false;
                }
                
          const cartItem = {
    productId: product.id,
    sku: product.sku || 'N/A', // ✅ AJOUT ICI
    name: product.name,
    imageName: product.imageName,
    quantity: quantity,
    unitPrice: product.price,
    oldPrice: product.oldPrice || 0,
    selectedOptions: selectedOptions,
    finalPrice: product.price * quantity,
    weight: product.weight || 0,
    isFragile: product.isFragile || false
};

                
                updatedItems = [...cart.items, cartItem];
            }
            
            const subtotal = updatedItems.reduce((sum, item) => sum + item.finalPrice, 0);
            const totalWeight = updatedItems.reduce((sum, item) => sum + (item.weight * item.quantity), 0);
            const oldPriceTotal = updatedItems.reduce((sum, item) => sum + (item.oldPrice * item.quantity), 0);
            
            const updatedCart = {
                items: updatedItems,
                subtotal,
                totalWeight,
                oldPriceTotal
            };
            
            const success = await updateCart(updatedCart);
            
            if (success) {
                showToast(`✅ ${quantity} produit${quantity > 1 ? 's' : ''} ajouté${quantity > 1 ? 's' : ''} au panier`, 'success');
                
                const cartIcon = document.querySelector('.cart-icon');
                if (cartIcon) {
                    anime({
                        targets: cartIcon,
                        scale: [1, 1.2, 1],
                        duration: 300,
                        easing: 'easeInOutSine'
                    });
                }
                
                return true;
            }
            
            return false;
        };
        
        const removeFromCart = async (itemIndex) => {
            const cart = window.appState.cartData;
            if (!cart || !cart.items[itemIndex]) return false;
            
            const updatedItems = cart.items.filter((_, index) => index !== itemIndex);
            
            const subtotal = updatedItems.reduce((sum, item) => sum + item.finalPrice, 0);
            const totalWeight = updatedItems.reduce((sum, item) => sum + (item.weight * item.quantity), 0);
            const oldPriceTotal = updatedItems.reduce((sum, item) => sum + (item.oldPrice * item.quantity), 0);
            
            const updatedCart = {
                items: updatedItems,
                subtotal,
                totalWeight,
                oldPriceTotal
            };
            
            return await updateCart(updatedCart);
        };
        
        const updateItemQuantity = async (itemIndex, newQuantity) => {
            const cart = window.appState.cartData;
            if (!cart || !cart.items[itemIndex]) return false;
            
            const productId = cart.items[itemIndex].productId;
            const products = window.appState.products;
            const product = products.find(p => p.id === productId);
            
            if (product && newQuantity > product.stockQuantity) {
                showToast(`Stock limité à ${product.stockQuantity} unités`, 'warning');
                return false;
            }
            
            const updatedItems = [...cart.items];
            updatedItems[itemIndex].quantity = newQuantity;
            updatedItems[itemIndex].finalPrice = updatedItems[itemIndex].unitPrice * newQuantity;
            
            const subtotal = updatedItems.reduce((sum, item) => sum + item.finalPrice, 0);
            const totalWeight = updatedItems.reduce((sum, item) => sum + (item.weight * item.quantity), 0);
            const oldPriceTotal = updatedItems.reduce((sum, item) => sum + (item.oldPrice * item.quantity), 0);
            
            const updatedCart = {
                items: updatedItems,
                subtotal,
                totalWeight,
                oldPriceTotal
            };
            
            return await updateCart(updatedCart);
        };
        
        const updateCartBadge = (itemCount) => {
            const badges = document.querySelectorAll('.cart-badge');
            badges.forEach(badge => {
                if (itemCount > 0) {
                    badge.textContent = itemCount > 99 ? '99+' : itemCount;
                    badge.classList.remove('hidden');
                    
                    anime({
                        targets: badge,
                        scale: [1, 1.3, 1],
                        duration: 300,
                        easing: 'easeInOutSine'
                    });
                } else {
                    badge.classList.add('hidden');
                }
            });
        };
        
        const clearCartSession = async () => {
            const sessionId = window.appState.cartSessionId;
            if (!sessionId) return;
            
            try {
                const db = FirebaseModule.getFirestore();
                await db.collection('cart_sessions').doc(sessionId).delete();
                localStorage.removeItem(CART_SESSION_KEY);
                
                window.appState.cartSessionId = null;
                window.appState.cartData = {
                    items: [],
                    subtotal: 0,
                    totalWeight: 0,
                    oldPriceTotal: 0
                };
                
                updateCartBadge(0);
                showToast('Panier vidé', 'info');
                
            } catch (error) {
                console.error('❌ Erreur lors de la suppression du panier:', error);
            }
        };
        
        return {
            initializeCartSession,
            updateCart,
            addToCart,
            removeFromCart,
            updateItemQuantity,
            clearCartSession
        };
    })();

    // ============================================
    // MODULE 4: Data Loading & Management
    // ============================================
    const DataModule = (() => {
        const loadProducts = async () => {
            try {
                const db = FirebaseModule.getFirestore();
                const snapshot = await db.collection('products')
                    .where('isAvailable', '==', true)
                    .get();
                
                const products = [];
                snapshot.forEach(doc => {
                    const data = doc.data();
                    products.push({
                        id: doc.id,
                        ...data,
                        hasSize: data.hasSize || false,
                        hasColor: data.hasColor || false,
                        hasMaterial: data.hasMaterial || false,
                        hasPersonalizationText: data.hasPersonalizationText || false,
                        hasOz: data.hasOz || false,
                        sizes: data.sizes || [],
                        colors: data.colors || [],
                        materials: data.materials || [],
                        weight: data.weight || 0,
                        stockQuantity: data.stockQuantity || 0,
                        isFragile: data.isFragile || false
                    });
                });
                
                window.appState.products = products;
                window.appState.filteredProducts = [...products];
                
                const categories = [...new Set(products.map(p => p.category).filter(Boolean))];
                window.appState.categories = categories.sort();
                
                console.log(`✅ ${products.length} produits chargés`);
                return products;
                
            } catch (error) {
                console.error('❌ Erreur lors du chargement des produits:', error);
                showToast('Erreur de chargement des produits', 'error');
                return [];
            }
        };
        
        const loadDeliveryRules = async () => {
            try {
                const db = FirebaseModule.getFirestore();
                const snapshot = await db.collection('delivery_rules')
                    .orderBy('maxWeight')
                    .get();
                
                const rules = [];
                snapshot.forEach(doc => {
                    rules.push({
                        id: doc.id,
                        ...doc.data()
                    });
                });
                
                window.appState.deliveryRules = rules;
                console.log(`✅ ${rules.length} règles de livraison chargées`);
                return rules;
                
            } catch (error) {
                console.error('❌ Erreur lors du chargement des règles de livraison:', error);
                return [];
            }
        };
        
        const loadMeetingPoints = async () => {
            try {
                const db = FirebaseModule.getFirestore();
                const snapshot = await db.collection('meeting_points')
                    .where('isActive', '==', true)
                    .get();
                
                const points = [];
                snapshot.forEach(doc => {
                    points.push({
                        id: doc.id,
                        ...doc.data()
                    });
                });
                
                window.appState.meetingPoints = points;
                console.log(`✅ ${points.length} points de rencontre chargés`);
                return points;
                
            } catch (error) {
                console.error('❌ Erreur lors du chargement des points de rencontre:', error);
                return [];
            }
        };
        
        const loadStoreLocations = async () => {
            try {
                const db = FirebaseModule.getFirestore();
                const snapshot = await db.collection('store_locations')
                    .where('isActive', '==', true)
                    .get();
                
                const locations = [];
                snapshot.forEach(doc => {
                    locations.push({
                        id: doc.id,
                        ...doc.data()
                    });
                });
                
                window.appState.storeLocations = locations;
                console.log(`✅ ${locations.length} points de vente chargés`);
                return locations;
                
            } catch (error) {
                console.error('❌ Erreur lors du chargement des points de vente:', error);
                return [];
            }
        };
        
        const loadPendingOrders = async () => {
            try {
                const sessionId = window.appState.cartSessionId;
                if (!sessionId) return [];
                
                const db = FirebaseModule.getFirestore();
                const snapshot = await db.collection('orders')
                    .where('sessionId', '==', sessionId)
                    .orderBy('createdAt', 'desc')
                    .get();
                
                const orders = [];
                snapshot.forEach(doc => {
                    orders.push({
                        id: doc.id,
                        ...doc.data()
                    });
                });
                
                window.appState.pendingOrders = orders;
                console.log(`✅ ${orders.length} commandes chargées`);
                return orders;
                
            } catch (error) {
                console.error('❌ Erreur lors du chargement des commandes:', error);
                return [];
            }
        };
        
        const loadPaymentTransfers = async () => {
            try {
                const sessionId = window.appState.cartSessionId;
                if (!sessionId) return [];
                
                const db = FirebaseModule.getFirestore();
                
                // Récupérer les commandes de l'utilisateur
                const ordersSnapshot = await db.collection('orders')
                    .where('sessionId', '==', sessionId)
                    .get();
                
                const orderCodes = [];
                ordersSnapshot.forEach(doc => {
                    orderCodes.push(doc.id);
                });
                
                // Récupérer les transferts pour ces commandes
                const transfers = [];
                for (const orderCode of orderCodes) {
                    const transferSnapshot = await db.collection('payment_transfers')
                        .where('orderCode', '==', orderCode)
                        .get();
                    
                    transferSnapshot.forEach(doc => {
                        transfers.push({
                            id: doc.id,
                            ...doc.data()
                        });
                    });
                }
                
                window.appState.paymentTransfers = transfers;
                console.log(`✅ ${transfers.length} transferts chargés`);
                return transfers;
                
            } catch (error) {
                console.error('❌ Erreur lors du chargement des transferts:', error);
                return [];
            }
        };
        
        const checkPaymentStatus = async (orderCode) => {
            try {
                const db = FirebaseModule.getFirestore();
                const orderDoc = await db.collection('orders').doc(orderCode).get();
                
                if (orderDoc.exists) {
                    return orderDoc.data().status;
                }
                return null;
            } catch (error) {
                console.error('❌ Erreur lors de la vérification du statut:', error);
                return null;
            }
        };
        
        const loadAllData = async () => {
            window.appState.isLoading = true;
            
            try {
                await Promise.all([
                    loadProducts(),
                    loadDeliveryRules(),
                    loadMeetingPoints(),
                    loadStoreLocations(),
                    loadPendingOrders(),
                    loadPaymentTransfers()
                ]);
                
                console.log('✅ Toutes les données ont été chargées');
                return true;
                
            } catch (error) {
                console.error('❌ Erreur lors du chargement des données:', error);
                return false;
                
            } finally {
                window.appState.isLoading = false;
            }
        };
        
        return {
            loadProducts,
            loadAllData,
            loadDeliveryRules,
            loadMeetingPoints,
            loadStoreLocations,
            loadPendingOrders,
            loadPaymentTransfers,
            checkPaymentStatus
        };
    })();

    // ============================================
    // MODULE 5: Checkout & Order Processing
    // ============================================
    
    const CheckoutModule = (() => {
        let currentStep = 1;
        
        const openCheckoutModal = (totalAmount, deliveryFee) => {
            window.appState.checkoutTotal = totalAmount + deliveryFee;
            window.appState.deliveryFee = deliveryFee;
            window.appState.checkoutData = {
                deliveryMethod: null,
                paymentMethod: null,
                selectedMeetingPoint: null,
                selectedStoreLocation: null,
                customMeetingPoint: null,
                paymentInfo: null,
                customerInfo: null
            };
            
            currentStep = 1;
            updateStepIndicators();
            loadDeliveryOptions();
            
            const modal = document.getElementById('checkout-modal');
            modal.classList.remove('hidden');
            
            anime({
                targets: modal,
                opacity: [0, 1],
                duration: 300,
                easing: 'easeOutExpo'
            });
        };
        
        const closeCheckoutModal = () => {
            const modal = document.getElementById('checkout-modal');
            
            anime({
                targets: modal,
                opacity: 0,
                duration: 200,
                easing: 'easeInExpo',
                complete: () => {
                    modal.classList.add('hidden');
                    resetCheckoutSteps();
                }
            });
        };
        
        const loadDeliveryOptions = async () => {
            const meetingPointsList = document.getElementById('meeting-points-list');
            const storeLocationsList = document.getElementById('store-locations-list');
            
            // Load meeting points
            if (meetingPointsList) {
                const meetingPoints = window.appState.meetingPoints;
                meetingPointsList.innerHTML = meetingPoints.map(point => `
                    <div class="delivery-point-item p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-gray-50" data-id="${point.id}">
                       <span>${point.name}</span>
                       <span class="text-sm font-bold text-blue-600">
                            + ${FirebaseModule.formatPrice(point.deliveryFee || 0)}
                        </span>
                       <div class="text-sm text-gray-600 mt-1">${point.address}</div>
                        ${point.description ? `<div class="text-xs text-gray-500 mt-1">${point.description}</div>` : ''}
                        <div class="selection-indicator hidden text-blue-600 text-xs mt-2">
                            <i class="fas fa-check-circle mr-1"></i> Sélectionné
                        </div>
                    </div>
                `).join('');
                
                // Add click handlers
                document.querySelectorAll('.delivery-point-item').forEach(item => {
                    item.addEventListener('click', function() {
                        const id = this.getAttribute('data-id');
                        selectMeetingPoint(id);
                    });
                });
            }
            
            // Load store locations
            if (storeLocationsList) {
                const storeLocations = window.appState.storeLocations;
                storeLocationsList.innerHTML = storeLocations.map(store => `
                    <div class="store-location-item p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-gray-50" data-id="${store.id}">
                        <div class="font-medium text-gray-900">${store.name}</div>
                        <div class="text-sm text-gray-600 mt-1">${store.address}</div>
                        ${store.openingHours ? `<div class="text-xs text-gray-500 mt-1">Horaires: ${store.openingHours}</div>` : ''}
                        ${store.phone ? `<div class="text-xs text-gray-500">Tél: ${store.phone}</div>` : ''}
                        <div class="selection-indicator hidden text-blue-600 text-xs mt-2">
                            <i class="fas fa-check-circle mr-1"></i> Sélectionné
                        </div>
                    </div>
                `).join('');
                
                // Add click handlers
                document.querySelectorAll('.store-location-item').forEach(item => {
                    item.addEventListener('click', function() {
                        const id = this.getAttribute('data-id');
                        selectStoreLocation(id);
                    });
                });
            }
            
            // Add event listeners to delivery options
            setupDeliverySelectionListeners();
            
            // Update delivery fee display
            updateDeliveryFeeDisplay();
        };
        
      const updateDeliveryFeeDisplay = () => {
    const cart = window.appState.cartData;
    const deliveryRules = window.appState.deliveryRules;
    const checkoutData = window.appState.checkoutData;

    if (!cart || !deliveryRules.length) return;

    /* 1️⃣ Frais basés sur le poids */
    let baseFee = FirebaseModule.calculateDeliveryFee(
        cart.totalWeight,
        deliveryRules
    );

    /* 2️⃣ Frais supplémentaires pour produits fragiles */
    const fragileItemsCount = cart.items.reduce(
        (count, item) => count + (item.isFragile ? item.quantity : 0),
        0
    );

    if (fragileItemsCount > 0 && deliveryRules[0]?.fragileExtraFee) {
        baseFee += fragileItemsCount * deliveryRules[0].fragileExtraFee;
    }

    /* 3️⃣ Frais du point de rencontre */
    let meetingPointFee = 0;

    if (
        checkoutData.deliveryMethod === 'meeting_point' &&
        checkoutData.selectedMeetingPoint
    ) {
        meetingPointFee = checkoutData.selectedMeetingPoint.deliveryFee || 0;
    }

    /* 4️⃣ TOTAL FINAL LIVRAISON */
    const finalDeliveryFee = baseFee + meetingPointFee;

    /* 5️⃣ Mise à jour UI */
    document.querySelectorAll('.delivery-fee-display').forEach(el => {
        if (el) {
            el.textContent =
                finalDeliveryFee === 0
                    ? 'Gratuit'
                    : FirebaseModule.formatPrice(finalDeliveryFee);
        }
    });

    /* 6️⃣ Sauvegarde globale */
    window.appState.deliveryFee = finalDeliveryFee;
};



        const setupDeliverySelectionListeners = () => {
            // Add click handlers to delivery point containers
            document.querySelectorAll('.delivery-point').forEach(point => {
                point.addEventListener('click', function(e) {
                    // Don't trigger if clicking on radio button
                    if (e.target.type === 'radio') return;
                    
                    const radio = this.querySelector('input[type="radio"]');
                    if (radio) {
                        radio.checked = true;
                        radio.dispatchEvent(new Event('change'));
                    }
                });
            });
            
            // Add visual feedback when selecting delivery points
            document.querySelectorAll('input[name="deliveryMethod"]').forEach(radio => {
                radio.addEventListener('change', function() {
                    const type = this.value;
                    const container = this.closest('.delivery-point');
                    
                    // Reset all delivery points
                    document.querySelectorAll('.delivery-point').forEach(p => {
                        p.classList.remove('selected', 'border-blue-500', 'bg-blue-50');
                    });
                    
                    // Highlight selected
                    if (container) {
                        container.classList.add('selected', 'border-blue-500', 'bg-blue-50');
                        
                        // Add animation
                        anime({
                            targets: container,
                            scale: [1, 1.02, 1],
                            duration: 200,
                            easing: 'easeInOutSine'
                        });
                    }
                    
                    // Show/hide containers
                    document.getElementById('meeting-points-container').classList.add('hidden');
                    document.getElementById('store-locations-container').classList.add('hidden');
                    
                    if (type === 'meeting_point') {
                        document.getElementById('meeting-points-container').classList.remove('hidden');
                        window.appState.checkoutData.deliveryMethod = 'meeting_point';
                    } else if (type === 'store_pickup') {
                        document.getElementById('store-locations-container').classList.remove('hidden');
                        window.appState.checkoutData.deliveryMethod = 'store_pickup';
                    }
                    
                    // Mettre à jour les frais d'affichage
                    updateOrderSummary();
                });
            });
        };
        
        const selectMeetingPoint = (id) => {
            const selectedPoint = window.appState.meetingPoints.find(p => p.id === id);
            if (selectedPoint) {
                window.appState.checkoutData.selectedMeetingPoint = selectedPoint;
                window.appState.checkoutData.customMeetingPoint = null;
                
                // Update UI with visual feedback
                document.querySelectorAll('.delivery-point-item').forEach(item => {
                    item.classList.remove('selected', 'border-blue-500', 'bg-blue-50');
                    item.querySelector('.selection-indicator').classList.add('hidden');
                });
                
                const selectedElement = document.querySelector(`.delivery-point-item[data-id="${id}"]`);
                if (selectedElement) {
                    selectedElement.classList.add('selected', 'border-blue-500', 'bg-blue-50');
                    selectedElement.querySelector('.selection-indicator').classList.remove('hidden');
                    
                    // Clear custom meeting point
                    document.getElementById('custom-meeting-point').value = '';
                    
                    // Animation
                    anime({
                        targets: selectedElement,
                        translateY: [5, 0],
                        opacity: [0.8, 1],
                        duration: 300,
                        easing: 'easeOutExpo'
                    });
                }
                
                showToast(`Point de rencontre sélectionné: ${selectedPoint.name}`, 'success');
            }
            updateDeliveryFeeDisplay();
            updateOrderSummary();

        };
        
        const selectStoreLocation = (id) => {
            const selectedStore = window.appState.storeLocations.find(s => s.id === id);
            if (selectedStore) {
                window.appState.checkoutData.selectedStoreLocation = selectedStore;
                
                // Update UI with visual feedback
                document.querySelectorAll('.store-location-item').forEach(item => {
                    item.classList.remove('selected', 'border-blue-500', 'bg-blue-50');
                    item.querySelector('.selection-indicator').classList.add('hidden');
                });
                
                const selectedElement = document.querySelector(`.store-location-item[data-id="${id}"]`);
                if (selectedElement) {
                    selectedElement.classList.add('selected', 'border-blue-500', 'bg-blue-50');
                    selectedElement.querySelector('.selection-indicator').classList.remove('hidden');
                    
                    // Animation
                    anime({
                        targets: selectedElement,
                        translateY: [5, 0],
                        opacity: [0.8, 1],
                        duration: 300,
                        easing: 'easeOutExpo'
                    });
                }
                
                showToast(`Point de retrait sélectionné: ${selectedStore.name}`, 'success');
            }
        };
        
        const goToStep = (step) => {
            // Validate current step before proceeding
            if (!validateCurrentStep()) {
                return;
            }
            
            // Hide all steps
            document.querySelectorAll('[id$="-content"]').forEach(el => {
                el.classList.add('hidden');
            });
            
            // Show target step
            document.getElementById(`step-${step}-content`).classList.remove('hidden');
            
            // Update step indicators
            currentStep = step;
            updateStepIndicators();
            
            // Update UI based on step
            switch(step) {
                case 2:
                    setupPaymentOptions();
                    break;
                case 3:
                    updateOrderSummary();
                    break;
                case 4:
                    showOrderConfirmation();
                    break;
            }
        };
        
        const validateCurrentStep = () => {
            switch(currentStep) {
                case 1:
                    const deliveryMethod = document.querySelector('input[name="deliveryMethod"]:checked');
                    if (!deliveryMethod) {
                        showToast('Veuillez sélectionner un mode de livraison', 'error');
                        return false;
                    }
                    
                    const method = deliveryMethod.value;
                    window.appState.checkoutData.deliveryMethod = method;
                    
                    if (method === 'meeting_point') {
                        if (!window.appState.checkoutData.selectedMeetingPoint && 
                            !document.getElementById('custom-meeting-point').value.trim()) {
                            showToast('Veuillez sélectionner ou proposer un point de rencontre', 'error');
                            return false;
                        }
                        
                        if (document.getElementById('custom-meeting-point').value.trim()) {
                            window.appState.checkoutData.customMeetingPoint = document.getElementById('custom-meeting-point').value.trim();
                            window.appState.checkoutData.selectedMeetingPoint = null;
                        }
                    } else if (method === 'store_pickup') {
                        if (!window.appState.checkoutData.selectedStoreLocation) {
                            showToast('Veuillez sélectionner un point de retrait', 'error');
                            return false;
                        }
                    }
                    return true;
                    
                case 2:
                    const paymentMethod = document.querySelector('input[name="paymentMethod"]:checked');
                    if (!paymentMethod) {
                        showToast('Veuillez sélectionner un mode de paiement', 'error');
                        return false;
                    }
                    
                    const payment = paymentMethod.value;
                    window.appState.checkoutData.paymentMethod = payment;
                    
                    // For mobile payments, check if verification form is filled
                    if (payment === 'moncash' || payment === 'natcash') {
                        const transferId = document.getElementById('transfer-id');
                        const senderPhone = document.getElementById('sender-phone');
                        const transferDate = document.getElementById('transfer-date');
                        const transferTime = document.getElementById('transfer-time');
                        
                        // Only validate if the verification form is visible
                        if (document.getElementById('payment-verification-form') && 
                            !document.getElementById('payment-verification-form').classList.contains('hidden')) {
                            
                            if (!transferId.value.trim() || !senderPhone.value.trim() || 
                                !transferDate.value || !transferTime.value) {
                                showToast('Veuillez compléter les informations de paiement', 'error');
                                return false;
                            }
                            
                            window.appState.checkoutData.paymentInfo = {
                                transferId: transferId.value.trim(),
                                senderPhone: senderPhone.value.trim(),
                                transferDate: transferDate.value,
                                transferTime: transferTime.value,
                                paymentMethod: payment
                            };
                        }
                    }
                    return true;
                    
                case 3:
                    const customerName = document.getElementById('customer-name');
                    const customerPhone = document.getElementById('customer-phone');
                    
                    if (!customerName.value.trim() || !customerPhone.value.trim()) {
                        showToast('Veuillez remplir les informations obligatoires', 'error');
                        return false;
                    }
                    
                    window.appState.checkoutData.customerInfo = {
                        name: customerName.value.trim(),
                        phone: customerPhone.value.trim(),
                        email: document.getElementById('customer-email').value.trim() || null
                    };
                    return true;
                    
                default:
                    return true;
            }
        };
        
        const updateStepIndicators = () => {
            // Reset all indicators
            document.querySelectorAll('.step-indicator > div').forEach((indicator, index) => {
                const stepNumber = index + 1;
                indicator.className = 'w-8 h-8 rounded-full flex items-center justify-center mb-2';
                
                if (stepNumber < currentStep) {
                    indicator.classList.add('bg-green-600', 'text-white');
                    indicator.innerHTML = '<i class="fas fa-check text-sm"></i>';
                } else if (stepNumber === currentStep) {
                    indicator.classList.add('bg-blue-600', 'text-white');
                    indicator.innerHTML = `<span class="text-sm">${stepNumber}</span>`;
                } else {
                    indicator.classList.add('bg-gray-200', 'text-gray-600');
                    indicator.innerHTML = `<span class="text-sm">${stepNumber}</span>`;
                }
            });
        };
        
        const setupPaymentOptions = () => {
            const paymentMethod = document.querySelector('input[name="paymentMethod"]');
            if (paymentMethod) {
                paymentMethod.checked = false;
            }
            
            // Reset payment UI
            document.getElementById('payment-instructions').classList.add('hidden');
            document.getElementById('in-person-warning').classList.add('hidden');
            document.getElementById('payment-verification-form').classList.add('hidden');
            document.getElementById('payment-done-button').classList.add('hidden');
            
            // Add event listeners to payment options
            document.querySelectorAll('.payment-option').forEach(option => {
                option.addEventListener('click', function(e) {
                    // Don't trigger if clicking on radio button
                    if (e.target.type === 'radio') return;
                    
                    const type = this.getAttribute('data-type');
                    handlePaymentSelection(type);
                });
            });
            
            // Add event listeners to radio buttons
            document.querySelectorAll('input[name="paymentMethod"]').forEach(radio => {
                radio.addEventListener('change', function() {
                    const type = this.value;
                    handlePaymentSelection(type);
                });
            });
            
            // Update next button text based on payment method
            const nextButton = document.getElementById('next-step-2');
            nextButton.textContent = 'Suivant';
        };
        
        const handlePaymentSelection = (type) => {
            // Reset all payment options
            document.querySelectorAll('.payment-option').forEach(opt => {
                opt.classList.remove('selected', 'border-blue-500', 'bg-blue-50');
            });
            
            // Select current option
            const selectedOption = document.querySelector(`.payment-option[data-type="${type}"]`);
            if (selectedOption) {
                selectedOption.classList.add('selected', 'border-blue-500', 'bg-blue-50');
                const radio = selectedOption.querySelector('input[type="radio"]');
                if (radio) {
                    radio.checked = true;
                    
                    // Animation
                    anime({
                        targets: selectedOption,
                        scale: [1, 1.02, 1],
                        duration: 200,
                        easing: 'easeInOutSine'
                    });
                }
            }
            
            // Show appropriate instructions
            const instructions = document.getElementById('payment-instructions');
            const inPersonWarning = document.getElementById('in-person-warning');
            const verificationForm = document.getElementById('payment-verification-form');
            const paymentDoneButton = document.getElementById('payment-done-button');
            
            // Hide all
            instructions.classList.add('hidden');
            inPersonWarning.classList.add('hidden');
            verificationForm.classList.add('hidden');
            paymentDoneButton.classList.add('hidden');
            
            // Show specific instructions
            if (type === 'in_person') {
                inPersonWarning.classList.remove('hidden');
                window.appState.checkoutData.paymentMethod = 'in_person';
            } else if (type === 'moncash' || type === 'natcash') {
                instructions.classList.remove('hidden');
                
                if (type === 'moncash') {
                    document.getElementById('moncash-instructions').classList.remove('hidden');
                    document.getElementById('natcash-instructions').classList.add('hidden');
                    
                    // Update amount
                    document.getElementById('moncash-amount').textContent = 
                        FirebaseModule.formatPrice(window.appState.checkoutTotal);
                    
                    // Generate QR code
                    const qrContainer = document.getElementById('moncash-qr');
                    qrContainer.innerHTML = '';
                    new QRCode(qrContainer, {
                        text: `moncash://payment?amount=${window.appState.checkoutTotal}&phone=50948000000&description=Commande%20Smart Cut Services`,
                        width: 150,
                        height: 150,
                        colorDark: "#000000",
                        colorLight: "#ffffff",
                        correctLevel: QRCode.CorrectLevel.H
                    });
                } else {
                    document.getElementById('natcash-instructions').classList.remove('hidden');
                    document.getElementById('moncash-instructions').classList.add('hidden');
                    
                    // Update amount
                    document.getElementById('natcash-amount').textContent = 
                        FirebaseModule.formatPrice(window.appState.checkoutTotal);
                    
                    // Generate QR code
                    const qrContainer = document.getElementById('natcash-qr');
                    qrContainer.innerHTML = '';
                    new QRCode(qrContainer, {
                        text: `natcash://payment?amount=${window.appState.checkoutTotal}&phone=50948111111&description=Commande%20Smart Cut Services`,
                        width: 150,
                        height: 150,
                        colorDark: "#000000",
                        colorLight: "#ffffff",
                        correctLevel: QRCode.CorrectLevel.H
                    });
                }
                
                // Show verification form and "C'est fait" button
                verificationForm.classList.remove('hidden');
                paymentDoneButton.classList.remove('hidden');
                
                // Reset verification form
                document.getElementById('transfer-id').value = '';
                document.getElementById('sender-phone').value = '';
                document.getElementById('transfer-date').value = '';
                document.getElementById('transfer-time').value = '';
                
                // Reset payment info
                window.appState.checkoutData.paymentInfo = null;
            }
        };
        
        const updateOrderSummary = () => {
            const meetingPoint = window.appState.checkoutData.selectedMeetingPoint;

if (meetingPoint) {
    document.getElementById('summary-meeting-point').classList.remove('hidden');
    document.getElementById('summary-meeting-point-name').textContent =
        meetingPoint.name;

    document.getElementById('summary-meeting-point-fee').textContent =
        FirebaseModule.formatPrice(meetingPoint.deliveryFee || 0);
} else {
    document.getElementById('summary-meeting-point').classList.add('hidden');
}

            const cart = window.appState.cartData;
            if (!cart) return;
            
            const subtotal = cart.subtotal;
            const deliveryFee = window.appState.deliveryFee;
            const total = subtotal + deliveryFee;
            
            document.getElementById('summary-items-count').textContent = cart.items.length;
            document.getElementById('summary-subtotal').textContent = FirebaseModule.formatPrice(subtotal);
            document.getElementById('summary-delivery-fee').textContent = FirebaseModule.formatPrice(deliveryFee);
            document.getElementById('summary-total').textContent = FirebaseModule.formatPrice(total);
        };
        
        const submitOrder = async () => {
            if (!validateCurrentStep()) {
                return;
            }
            
            const cart = window.appState.cartData;
            if (!cart || cart.items.length === 0) {
                showToast('Votre panier est vide', 'error');
                return;
            }
            
            try {
                showToast('Traitement de votre commande...', 'info');
                
                // Calculer le total final avec frais de livraison
                const subtotal = cart.subtotal;
                const deliveryFee = window.appState.deliveryFee;
                const totalAmount = subtotal + deliveryFee;
                
                // Generate order data
                const orderCode = `CMD${Date.now().toString().slice(-6)}${Math.floor(Math.random() * 1000).toString().padStart(3, '0')}`;
                
                const orderData = {
                    orderCode,
                    sessionId: window.appState.cartSessionId,
                    customerInfo: window.appState.checkoutData.customerInfo,
                    items: cart.items,
                    subtotal: subtotal,
                    totalWeight: cart.totalWeight,
                    deliveryMethod: window.appState.checkoutData.deliveryMethod,
                    paymentMethod: window.appState.checkoutData.paymentMethod,
                    selectedMeetingPoint: window.appState.checkoutData.selectedMeetingPoint,
                    selectedStoreLocation: window.appState.checkoutData.selectedStoreLocation,
                    customMeetingPoint: window.appState.checkoutData.customMeetingPoint,
                    paymentInfo: window.appState.checkoutData.paymentInfo,
                    deliveryFee: deliveryFee,
                    totalAmount: totalAmount,
                    status: window.appState.checkoutData.paymentMethod === 'in_person' ? 'pending_payment' : 'pending_verification',
                    createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                    updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                };
                
                // Save to Firestore
                const db = FirebaseModule.getFirestore();
                await db.collection('orders').doc(orderCode).set(orderData);
                
                // Save payment info if mobile payment
                if (window.appState.checkoutData.paymentInfo) {
                    await db.collection('payment_transfers').doc(window.appState.checkoutData.paymentInfo.transferId).set({
                        ...window.appState.checkoutData.paymentInfo,
                        orderCode,
                        amount: totalAmount,
                        status: 'pending',
                        createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                        verifiedAt: null,
                        verifiedBy: null
                    });
                }
                
                // Clear cart
                await CartSessionModule.clearCartSession();
                
                // Set current order
                window.appState.currentOrder = orderData;
                
                // Load pending orders
                await DataModule.loadPendingOrders();
                await DataModule.loadPaymentTransfers();
                
                // Go to confirmation step
                goToStep(4);
                
            } catch (error) {
                console.error('❌ Erreur lors de la création de la commande:', error);
                showToast('Erreur lors de la création de la commande', 'error');
            }
        };
        
        const showOrderConfirmation = () => {
            const order = window.appState.currentOrder;
            if (!order) return;
            
            document.getElementById('order-code').textContent = order.orderCode;
            document.getElementById('order-delivery-method').textContent = 
                order.deliveryMethod === 'meeting_point' ? 
                    (order.selectedMeetingPoint ? order.selectedMeetingPoint.name : 'Point personnalisé') : 
                order.deliveryMethod === 'store_pickup' ? 
                    (order.selectedStoreLocation ? order.selectedStoreLocation.name : 'Point de retrait') : 
                'Livraison';
            
            document.getElementById('order-payment-method').textContent = 
                order.paymentMethod === 'in_person' ? 'Paiement en personne' :
                order.paymentMethod === 'moncash' ? 'MonCash' : 'NatCash';
            
            // Show appropriate message based on payment method
            const paymentPendingMessage = document.getElementById('payment-pending-message');
            const downloadReceiptBtn = document.querySelector('button[onclick="downloadReceipt()"]');
            
            if (order.paymentMethod === 'in_person') {
                paymentPendingMessage.classList.add('hidden');
                if (downloadReceiptBtn) {
                    downloadReceiptBtn.classList.remove('hidden');
                    downloadReceiptBtn.innerHTML = '<i class="fas fa-download mr-2"></i>Télécharger le reçu';
                }
            } else {
                paymentPendingMessage.classList.remove('hidden');
                paymentPendingMessage.innerHTML = `
                    <div class="flex">
                        <i class="fas fa-clock text-yellow-500 mt-1 mr-3"></i>
                        <div>
                            <h5 class="font-medium text-yellow-900 mb-1">Paiement en attente de vérification</h5>
                            <p class="text-sm text-yellow-800">
                                Votre paiement est en cours de vérification par notre équipe. Vous pourrez télécharger le reçu une fois le paiement vérifié.
                            </p>
                            <p class="text-xs text-yellow-700 mt-2">
                                <i class="fas fa-info-circle mr-1"></i>
                                Vous pouvez vérifier l'état de votre commande dans la section "Mes commandes" ci-dessous.
                            </p>
                        </div>
                    </div>
                `;
                
                if (downloadReceiptBtn) {
                    downloadReceiptBtn.classList.add('hidden');
                }
            }
        };
        
        const verifyPayment = () => {
            const transferId = document.getElementById('transfer-id').value.trim();
            const senderPhone = document.getElementById('sender-phone').value.trim();
            const transferDate = document.getElementById('transfer-date').value;
            const transferTime = document.getElementById('transfer-time').value;
            
            if (!transferId || !senderPhone || !transferDate || !transferTime) {
                showToast('Veuillez remplir tous les champs', 'error');
                return;
            }
            
            // Validate phone number format
            const phoneRegex = /^(?:\+509|509|0)[0-9]{8}$/;
            const cleanPhone = senderPhone.replace(/\s/g, '');
            if (!phoneRegex.test(cleanPhone)) {
                showToast('Veuillez entrer un numéro de téléphone valide (format haïtien)', 'error');
                return;
            }
            
            // Validate date is not in the future
            const transferDateTime = new Date(`${transferDate}T${transferTime}`);
            const now = new Date();
            if (transferDateTime > now) {
                showToast('La date et heure du transfert ne peuvent pas être dans le futur', 'error');
                return;
            }
            
            // Save payment info
            window.appState.checkoutData.paymentInfo = {
                transferId,
                senderPhone: cleanPhone,
                transferDate,
                transferTime,
                paymentMethod: document.querySelector('input[name="paymentMethod"]:checked').value
            };
            
            // Show success message and enable next button
            showToast('✅ Informations de paiement enregistrées. Vous pouvez continuer.', 'success');
            
            // Update UI to show payment is done
            document.getElementById('payment-done-button').innerHTML = `
                <div class="flex items-center justify-center text-green-600">
                    <i class="fas fa-check-circle mr-2"></i>
                    <span>Informations enregistrées</span>
                </div>
            `;
            
            // Enable next step
            document.getElementById('next-step-2').disabled = false;
        };
        
        const resetCheckoutSteps = () => {
            currentStep = 1;
            updateStepIndicators();
            
            // Show step 1 content
            document.querySelectorAll('[id$="-content"]').forEach(el => {
                el.classList.add('hidden');
            });
            document.getElementById('step-1-content').classList.remove('hidden');
            
            // Reset form
            if (document.getElementById('checkout-form')) {
                document.getElementById('checkout-form').reset();
            }
            
            // Reset selections
            window.appState.checkoutData = {
                deliveryMethod: null,
                paymentMethod: null,
                selectedMeetingPoint: null,
                selectedStoreLocation: null,
                customMeetingPoint: null,
                paymentInfo: null,
                customerInfo: null
            };
            
            // Reset UI
            document.querySelectorAll('.delivery-point-item, .store-location-item').forEach(item => {
                item.classList.remove('selected', 'border-blue-500', 'bg-blue-50');
                item.querySelector('.selection-indicator').classList.add('hidden');
            });
            
            document.querySelectorAll('.delivery-point').forEach(point => {
                point.classList.remove('selected', 'border-blue-500', 'bg-blue-50');
            });
            
            document.querySelectorAll('.payment-option').forEach(option => {
                option.classList.remove('selected', 'border-blue-500', 'bg-blue-50');
            });
        };
        
        return {
            openCheckoutModal,
            closeCheckoutModal,
            goToStep,
            verifyPayment,
            submitOrder
        };
    })();

    // ============================================
    // MODULE 6: PDF Generation
    // ============================================
    const PDFModule = (() => {
        const formatSelectedOptions = (options = {}) => {
    const entries = Object.entries(options)
        .filter(([_, value]) => value && value !== '');

    if (entries.length === 0) return '';

    return entries
        .map(([key, value]) => `${key}: ${value}`)
        .join(' | ');
};

        const generateReceipt = (orderData, transferData = null) => {
            return new Promise((resolve) => {
                try {
                    const { jsPDF } = window.jspdf;
                    const doc = new jsPDF();
                    
                    // Set properties
                    doc.setProperties({
                        title: `Reçu Commande ${orderData.orderCode}`,
                        subject: 'Reçu de commande Smart Cut Services',
                        author: 'Smart Cut Services',
                        keywords: 'reçu, commande, facture, livraison',
                        creator: 'Smart Cut Services E-commerce'
                    });
                    
                    // Header
                    doc.setFontSize(24);
                    doc.setTextColor(59, 130, 246);
                    doc.text('Smart Cut Services', 105, 20, { align: 'center' });
                    
                    doc.setFontSize(14);
                    doc.setTextColor(100, 100, 100);
                    doc.text('Reçu de commande', 105, 30, { align: 'center' });
                    
                    // Order Code
                    doc.setFontSize(16);
                    doc.setTextColor(0, 0, 0);
                    doc.text(`Commande: ${orderData.orderCode}`, 105, 45, { align: 'center' });
                    
                    // Date and Time
                    doc.setFontSize(10);
                    const now = new Date();
                    doc.text(`Date: ${now.toLocaleDateString('fr-FR')}`, 20, 60);
                    doc.text(`Heure: ${now.toLocaleTimeString('fr-FR', { hour: '2-digit', minute: '2-digit' })}`, 20, 66);
                    
                    // Customer Info
                    doc.text(`Client: ${orderData.customerInfo.name}`, 20, 75);
                    doc.text(`Téléphone: ${orderData.customerInfo.phone}`, 20, 81);
                    if (orderData.customerInfo.email) {
                        doc.text(`Email: ${orderData.customerInfo.email}`, 20, 87);
                    }
                    
                    // Delivery Information
                    let deliveryInfo = '';
                    let deliveryY = 96;
                    
                    if (orderData.deliveryMethod === 'meeting_point') {
                        if (orderData.selectedMeetingPoint) {
                            deliveryInfo = `Point de rencontre: ${orderData.selectedMeetingPoint.name}\n${orderData.selectedMeetingPoint.address}`;
                            if (orderData.selectedMeetingPoint.description) {
                                deliveryInfo += `\n${orderData.selectedMeetingPoint.description}`;
                            }
                        } else if (orderData.customMeetingPoint) {
                            deliveryInfo = `Point de rencontre personnalisé:\n${orderData.customMeetingPoint}`;
                        }
                    } else if (orderData.deliveryMethod === 'store_pickup') {
                        if (orderData.selectedStoreLocation) {
                            deliveryInfo = `Retrait en magasin: ${orderData.selectedStoreLocation.name}\n${orderData.selectedStoreLocation.address}`;
                            if (orderData.selectedStoreLocation.openingHours) {
                                deliveryInfo += `\nHoraires: ${orderData.selectedStoreLocation.openingHours}`;
                            }
                        }
                    }
                    
                    if (deliveryInfo) {
                        const lines = deliveryInfo.split('\n');
                        lines.forEach((line, index) => {
                            doc.text(line, 20, deliveryY + (index * 6));
                        });
                        deliveryY += lines.length * 6;
                    }
                    
                    // Payment Information
                    const paymentMethodText = orderData.paymentMethod === 'in_person' ? 'Paiement en personne' :
                                             orderData.paymentMethod === 'moncash' ? 'MonCash' : 'NatCash';
                    
                    doc.text(`Paiement: ${paymentMethodText}`, 20, deliveryY + 6);
                    
                    if (orderData.paymentInfo) {
                        doc.text(`ID Transfert: ${orderData.paymentInfo.transferId}`, 20, deliveryY + 12);
                        doc.text(`Téléphone: ${orderData.paymentInfo.senderPhone}`, 20, deliveryY + 18);
                        doc.text(`Date: ${orderData.paymentInfo.transferDate} à ${orderData.paymentInfo.transferTime}`, 20, deliveryY + 24);
                    }
                    
                    if (transferData) {
                        doc.text(`Statut: ${transferData.status === 'verified' ? '✅ Vérifié' : '⏳ En attente'}`, 20, deliveryY + 30);
                        if (transferData.verifiedAt) {
                            const verifiedDate = transferData.verifiedAt.toDate ? 
                                transferData.verifiedAt.toDate() : new Date(transferData.verifiedAt);
                            doc.text(`Vérifié le: ${verifiedDate.toLocaleDateString('fr-FR')}`, 20, deliveryY + 36);
                        }
                    } else {
                        doc.text(`Statut: ${orderData.status === 'payment_verified' ? '✅ Vérifié' : '⏳ En attente'}`, 20, deliveryY + 30);
                    }
                    
                   const items = orderData.items.map(item => {
                        const optionsText = formatSelectedOptions(item.selectedOptions);

                        return [
                            optionsText
                                ? `${item.name}\n(${optionsText})`
                                : item.name,
                            item.quantity.toString(),
                            FirebaseModule.formatPrice(item.unitPrice),
                            FirebaseModule.formatPrice(item.finalPrice)
                        ];
                    });

                                        
                  doc.autoTable({
                        startY: deliveryY + 45,
                        head: [['SKU', 'Article', 'Qté', 'Prix unit.', 'Total']],
                        body: items,
                        theme: 'striped',
                        headStyles: { fillColor: [59, 130, 246] },
                        columnStyles: {
                            0: { cellWidth: 28 },   // SKU
                            1: { cellWidth: 58 },   // Article
                            2: { halign: 'center' },
                            3: { halign: 'right' },
                            4: { halign: 'right' }
                        },
                        margin: { left: 20, right: 20 }
                    });
                    
                    // Totals
                    const finalY = doc.lastAutoTable.finalY + 10;
                    
                    doc.setFontSize(11);
                    doc.text('Sous-total:', 140, finalY);
                    doc.text(FirebaseModule.formatPrice(orderData.subtotal), 190, finalY, { align: 'right' });
                    
                    doc.text('Frais de livraison:', 140, finalY + 8);
                    doc.text(FirebaseModule.formatPrice(orderData.deliveryFee || 0), 190, finalY + 8, { align: 'right' });
                    
                    doc.setFontSize(12);
                    doc.setFont(undefined, 'bold');
                    doc.text('Total:', 140, finalY + 20);
                    doc.text(FirebaseModule.formatPrice(orderData.totalAmount), 190, finalY + 20, { align: 'right' });
                    
                    // Important Notice
                    doc.setFont(undefined, 'normal');
                    doc.setFontSize(9);
                    doc.setTextColor(255, 0, 0);
                    doc.text('IMPORTANT:', 105, finalY + 40, { align: 'center' });
                    
                    doc.setTextColor(0, 0, 0);
                    doc.setFontSize(8);
                    doc.text('Présentez ce reçu pour retirer votre colis.', 105, finalY + 46, { align: 'center' });
                    
          if (orderData.paymentMethod === 'in_person') {
    const text =
        'Vous avez 72 heures pour retirer votre colis. Passé ce délai, le colis ne sera plus disponible au point de livraison choisi. Votre colis pourra être récupéré dans notre succursale principale. Merci pour votre compréhension!';

    const maxWidth = 150;
    const lines = doc.splitTextToSize(text, maxWidth);

    // 🔴 Texte en rouge
    doc.setTextColor(220, 38, 38); // rouge pro (tailwind red-600)
    doc.setFontSize(8.5);
    doc.text(lines, 105, finalY + 52, { align: 'center' });

    // ⚫ Reset couleur (TRÈS IMPORTANT)
    doc.setTextColor(0, 0, 0);
}
else {
                        doc.text('Ce reçu est valable uniquement après vérification du paiement.', 105, finalY + 52, { align: 'center' });
                    }
                    
                    // QR Code for order verification
                    doc.setFontSize(7);
                    doc.text('Code de vérification:', 105, finalY + 65, { align: 'center' });
                    doc.setFontSize(10);
                    doc.setFont(undefined, 'bold');
                    doc.text(orderData.orderCode, 105, finalY + 70, { align: 'center' });
                    
                    // Footer
                    doc.setFont(undefined, 'normal');
                    doc.setFontSize(7);
                    doc.setTextColor(100, 100, 100);
                    doc.text('Merci pour votre commande!', 105, finalY + 80, { align: 'center' });
                    doc.text('Smart Cut Services • support@Smart Cut Services.com • +509 48 00 0000', 105, finalY + 85, { align: 'center' });
                    
                    // Save PDF
                    const fileName = `reçu-commande-${orderData.orderCode}.pdf`;
                    doc.save(fileName);
                    
                    resolve(true);
                    
                } catch (error) {
                    console.error('❌ Erreur lors de la génération du PDF:', error);
                    showToast('Erreur lors de la génération du reçu', 'error');
                    resolve(false);
                }
            });
        };
        
        return {
            generateReceipt
        };
    })();

    // ============================================
    // MODULE 7: Pending Orders Management
    // ============================================
    const PendingOrdersModule = (() => {
        const renderPendingOrdersSection = () => {
            const pendingOrders = window.appState.pendingOrders;
            const paymentTransfers = window.appState.paymentTransfers;
            
            if (pendingOrders.length === 0) {
                return '';
            }
            
            // Associer les transferts aux commandes
            const ordersWithTransfers = pendingOrders.map(order => {
                const transfer = paymentTransfers.find(t => t.orderCode === order.orderCode);
                return {
                    ...order,
                    transfer: transfer || null
                };
            });
            
            return `
                <div id="pending-orders-section" class="mt-12">
                    <h2 class="font-heading font-bold text-2xl text-gray-800 mb-6">Mes commandes</h2>
                    <div class="bg-white rounded-xl shadow-md overflow-hidden">
                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-200">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Commande</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Date</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Montant</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Livraison</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Paiement</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Statut</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Transfert</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                                    </tr>
                                </thead>
                                <tbody class="bg-white divide-y divide-gray-200">
                                    ${ordersWithTransfers.map(order => `
                                        <tr class="hover:bg-gray-50">
                                            <td class="px-6 py-4 whitespace-nowrap">
                                                <div class="font-medium text-gray-900">${order.orderCode}</div>
                                                <div class="text-sm text-gray-500">
                                                    ${order.items.length} article${order.items.length > 1 ? 's' : ''}
                                                </div>
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                                ${order.createdAt ? new Date(order.createdAt.seconds * 1000).toLocaleDateString('fr-FR') : 'N/A'}
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap">
                                                <div class="text-sm font-medium text-gray-900">
                                                    ${FirebaseModule.formatPrice(order.totalAmount)}
                                                </div>
                                                <div class="text-xs text-gray-500">
                                                    Dont livraison: ${FirebaseModule.formatPrice(order.deliveryFee || 0)}
                                                </div>
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap">
                                                <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full 
                                                    ${order.deliveryMethod === 'meeting_point' ? 'bg-blue-100 text-blue-800' : 
                                                      order.deliveryMethod === 'store_pickup' ? 'bg-green-100 text-green-800' : 
                                                      'bg-gray-100 text-gray-800'}">
                                                    ${order.deliveryMethod === 'meeting_point' ? 'Point de rencontre' : 
                                                     order.deliveryMethod === 'store_pickup' ? 'Retrait magasin' : 
                                                     'Livraison'}
                                                </span>
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap">
                                                <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full 
                                                    ${order.paymentMethod === 'moncash' ? 'bg-purple-100 text-purple-800' : 
                                                      order.paymentMethod === 'natcash' ? 'bg-blue-100 text-blue-800' : 
                                                      'bg-gray-100 text-gray-800'}">
                                                    ${order.paymentMethod === 'in_person' ? 'En personne' : 
                                                     order.paymentMethod === 'moncash' ? 'MonCash' : 'NatCash'}
                                                </span>
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap">
                                                <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full 
                                                    ${order.status === 'payment_verified' ? 'bg-green-100 text-green-800' : 
                                                      order.status === 'pending_verification' ? 'bg-yellow-100 text-yellow-800' : 
                                                      order.status === 'pending_payment' ? 'bg-orange-100 text-orange-800' : 
                                                      'bg-gray-100 text-gray-800'}">
                                                    ${order.status === 'payment_verified' ? 'Paiement vérifié' : 
                                                     order.status === 'pending_verification' ? 'En vérification' : 
                                                     order.status === 'pending_payment' ? 'En attente' : 
                                                     'Inconnu'}
                                                </span>
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap">
                                                ${order.transfer ? `
                                                    <div class="space-y-1">
                                                        <div class="text-xs">
                                                            <span class="font-medium">ID:</span> ${order.transfer.transferId}
                                                        </div>
                                                        <div class="text-xs">
                                                            <span class="font-medium">Statut:</span> 
                                                            <span class="px-1 inline-flex text-xs leading-5 font-semibold rounded-full 
                                                                ${order.transfer.status === 'verified' ? 'bg-green-100 text-green-800' : 
                                                                  order.transfer.status === 'pending' ? 'bg-yellow-100 text-yellow-800' : 
                                                                  'bg-red-100 text-red-800'}">
                                                                ${order.transfer.status === 'verified' ? 'Vérifié' : 
                                                                 order.transfer.status === 'pending' ? 'En attente' : 
                                                                 'Rejeté'}
                                                            </span>
                                                        </div>
                                                    </div>
                                                ` : order.paymentMethod === 'in_person' ? `
                                                    <span class="text-xs text-gray-500">Paiement à la livraison</span>
                                                ` : `
                                                    <span class="text-xs text-gray-500">Aucun transfert</span>
                                                `}
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                                                ${order.status === 'payment_verified' || (order.transfer && order.transfer.status === 'verified') ? `
                                                    <button onclick="downloadOrderReceipt('${order.orderCode}')" 
                                                        class="text-blue-600 hover:text-blue-900 mr-3">
                                                        <i class="fas fa-download mr-1"></i>Reçu
                                                    </button>
                                                ` : order.status === 'pending_verification' || (order.transfer && order.transfer.status === 'pending') ? `
                                                    <button onclick="checkPaymentStatus('${order.orderCode}')" 
                                                        class="text-yellow-600 hover:text-yellow-900 mr-3">
                                                        <i class="fas fa-sync-alt mr-1"></i>Vérifier
                                                    </button>
                                                ` : ''}
                                                <button onclick="viewOrderDetails('${order.orderCode}')" 
                                                    class="text-gray-600 hover:text-gray-900">
                                                    <i class="fas fa-eye mr-1"></i>Détails
                                                </button>
                                            </td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                    </div>
                    
                    <div class="mt-4 p-4 bg-blue-50 rounded-lg">
                        <div class="flex">
                            <i class="fas fa-info-circle text-blue-500 mt-1 mr-3"></i>
                            <div>
                                <p class="text-sm text-blue-800">
                                    <strong>Instructions:</strong> 
                                    • Pour les paiements MonCash/NatCash, vous pouvez vérifier le statut de vérification à tout moment.<br>
                                    • Une fois le paiement vérifié par notre équipe, vous pourrez télécharger le reçu pour retirer votre colis.<br>
                                    • Pour les paiements en personne, présentez-vous au point de retrait avec le reçu.
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        };
        
        const checkPaymentStatus = async (orderCode) => {
            showToast('Vérification du statut en cours...', 'info');
            
            try {
                const db = FirebaseModule.getFirestore();
                
                // Vérifier le statut de la commande
                const orderDoc = await db.collection('orders').doc(orderCode).get();
                if (!orderDoc.exists) {
                    showToast('Commande non trouvée', 'error');
                    return;
                }
                
                const orderData = orderDoc.data();
                
                // Vérifier le statut du transfert si c'est un paiement mobile
                if (orderData.paymentMethod === 'moncash' || orderData.paymentMethod === 'natcash') {
                    const transferSnapshot = await db.collection('payment_transfers')
                        .where('orderCode', '==', orderCode)
                        .get();
                    
                    if (!transferSnapshot.empty) {
                        const transferDoc = transferSnapshot.docs[0];
                        const transferData = transferDoc.data();
                        
                        if (transferData.status === 'verified') {
                            // Mettre à jour le statut de la commande
                            await db.collection('orders').doc(orderCode).update({
                                status: 'payment_verified',
                                updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                            });
                            
                            showToast('✅ Paiement vérifié! Vous pouvez maintenant télécharger le reçu.', 'success');
                        } else if (transferData.status === 'pending') {
                            showToast('Paiement encore en attente de vérification par notre équipe.', 'info');
                        } else if (transferData.status === 'rejected') {
                            showToast('Paiement rejeté. Veuillez contacter le support.', 'error');
                        }
                    }
                } else if (orderData.paymentMethod === 'in_person') {
                    showToast('Paiement en personne - à régler lors du retrait.', 'info');
                }
                
                // Recharger les données
                await DataModule.loadPendingOrders();
                await DataModule.loadPaymentTransfers();
                
                // Re-render cart page if we're on it
                if (window.appState.currentPage === 'panier') {
                    AppModule.navigateTo('panier');
                }
                
            } catch (error) {
                console.error('❌ Erreur lors de la vérification du statut:', error);
                showToast('Erreur lors de la vérification', 'error');
            }
        };
        
        const downloadOrderReceipt = async (orderCode) => {
            try {
                const db = FirebaseModule.getFirestore();
                
                // Récupérer la commande
                const orderDoc = await db.collection('orders').doc(orderCode).get();
                if (!orderDoc.exists) {
                    showToast('Commande non trouvée', 'error');
                    return;
                }
                
                const orderData = orderDoc.data();
                
                // Vérifier si le paiement est vérifié
                if (orderData.paymentMethod !== 'in_person' && orderData.status !== 'payment_verified') {
                    showToast('Le paiement n\'a pas encore été vérifié', 'warning');
                    return;
                }
                
                // Récupérer les données du transfert si c'est un paiement mobile
                let transferData = null;
                if (orderData.paymentMethod === 'moncash' || orderData.paymentMethod === 'natcash') {
                    const transferSnapshot = await db.collection('payment_transfers')
                        .where('orderCode', '==', orderCode)
                        .get();
                    
                    if (!transferSnapshot.empty) {
                        transferData = transferSnapshot.docs[0].data();
                    }
                }
                
                // Générer le PDF
                await PDFModule.generateReceipt(orderData, transferData);
                
            } catch (error) {
                console.error('❌ Erreur lors du téléchargement du reçu:', error);
                showToast('Erreur lors du téléchargement', 'error');
            }
        };
        
        const viewOrderDetails = async (orderCode) => {
            try {
                const db = FirebaseModule.getFirestore();
                const orderDoc = await db.collection('orders').doc(orderCode).get();
                
                if (orderDoc.exists) {
                    const orderData = orderDoc.data();
                    
                    // Récupérer les données du transfert
                    let transferData = null;
                    if (orderData.paymentMethod === 'moncash' || orderData.paymentMethod === 'natcash') {
                        const transferSnapshot = await db.collection('payment_transfers')
                            .where('orderCode', '==', orderCode)
                            .get();
                        
                        if (!transferSnapshot.empty) {
                            transferData = transferSnapshot.docs[0].data();
                        }
                    }
                    
                    // Create modal to show order details
                    const modalHTML = `
                        <div class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                            <div class="bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto">
                                <div class="p-6">
                                    <div class="flex justify-between items-center mb-6">
                                        <h3 class="text-xl font-bold text-gray-800">Détails de la commande</h3>
                                        <button onclick="closeOrderDetailsModal()" class="text-gray-400 hover:text-gray-600">
                                            <i class="fas fa-times text-xl"></i>
                                        </button>
                                    </div>
                                    
                                    <div class="space-y-6">
                                        <div>
                                            <h4 class="font-medium text-gray-700 mb-2">Informations de la commande</h4>
                                            <div class="grid grid-cols-2 gap-4">
                                                <div>
                                                    <p class="text-sm text-gray-600">Numéro</p>
                                                    <p class="font-medium">${orderData.orderCode}</p>
                                                </div>
                                                <div>
                                                    <p class="text-sm text-gray-600">Date</p>
                                                    <p class="font-medium">${orderData.createdAt ? new Date(orderData.createdAt.seconds * 1000).toLocaleDateString('fr-FR') : 'N/A'}</p>
                                                </div>
                                                <div>
                                                    <p class="text-sm text-gray-600">Montant total</p>
                                                    <p class="font-medium">${FirebaseModule.formatPrice(orderData.totalAmount)}</p>
                                                </div>
                                                <div>
                                                    <p class="text-sm text-gray-600">Statut</p>
                                                    <span class="px-2 py-1 text-xs font-semibold rounded-full 
                                                        ${orderData.status === 'payment_verified' ? 'bg-green-100 text-green-800' : 
                                                          orderData.status === 'pending_verification' ? 'bg-yellow-100 text-yellow-800' : 
                                                          orderData.status === 'pending_payment' ? 'bg-orange-100 text-orange-800' : 
                                                          'bg-gray-100 text-gray-800'}">
                                                        ${orderData.status === 'payment_verified' ? 'Paiement vérifié' : 
                                                         orderData.status === 'pending_verification' ? 'En vérification' : 
                                                         orderData.status === 'pending_payment' ? 'En attente de paiement' : 
                                                         'Inconnu'}
                                                    </span>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <div>
                                            <h4 class="font-medium text-gray-700 mb-2">Informations de livraison</h4>
                                            <div class="space-y-2">
                                                <p><span class="text-sm text-gray-600">Mode:</span> 
                                                    <span class="ml-2">${orderData.deliveryMethod === 'meeting_point' ? 'Point de rencontre' : 
                                                                        orderData.deliveryMethod === 'store_pickup' ? 'Retrait en magasin' : 
                                                                        'Livraison'}</span>
                                                </p>
                                                ${orderData.selectedMeetingPoint ? `
                                                    <p><span class="text-sm text-gray-600">Point:</span> 
                                                        <span class="ml-2">${orderData.selectedMeetingPoint.name}</span>
                                                    </p>
                                                    <p><span class="text-sm text-gray-600">Adresse:</span> 
                                                        <span class="ml-2">${orderData.selectedMeetingPoint.address}</span>
                                                    </p>
                                                    ${orderData.selectedMeetingPoint.description ? `
                                                        <p><span class="text-sm text-gray-600">Description:</span> 
                                                            <span class="ml-2">${orderData.selectedMeetingPoint.description}</span>
                                                        </p>
                                                    ` : ''}
                                                ` : orderData.selectedStoreLocation ? `
                                                    <p><span class="text-sm text-gray-600">Magasin:</span> 
                                                        <span class="ml-2">${orderData.selectedStoreLocation.name}</span>
                                                    </p>
                                                    <p><span class="text-sm text-gray-600">Adresse:</span> 
                                                        <span class="ml-2">${orderData.selectedStoreLocation.address}</span>
                                                    </p>
                                                    ${orderData.selectedStoreLocation.openingHours ? `
                                                        <p><span class="text-sm text-gray-600">Horaires:</span> 
                                                            <span class="ml-2">${orderData.selectedStoreLocation.openingHours}</span>
                                                        </p>
                                                    ` : ''}
                                                ` : orderData.customMeetingPoint ? `
                                                    <p><span class="text-sm text-gray-600">Point personnalisé:</span> 
                                                        <span class="ml-2">${orderData.customMeetingPoint}</span>
                                                    </p>
                                                ` : ''}
                                                <p><span class="text-sm text-gray-600">Frais de livraison:</span> 
                                                    <span class="ml-2">${FirebaseModule.formatPrice(orderData.deliveryFee || 0)}</span>
                                                </p>
                                            </div>
                                        </div>
                                        
                                        <div>
                                            <h4 class="font-medium text-gray-700 mb-2">Informations de paiement</h4>
                                            <div class="space-y-2">
                                                <p><span class="text-sm text-gray-600">Méthode:</span> 
                                                    <span class="ml-2">${orderData.paymentMethod === 'in_person' ? 'Paiement en personne' : 
                                                                        orderData.paymentMethod === 'moncash' ? 'MonCash' : 'NatCash'}</span>
                                                </p>
                                                ${orderData.paymentInfo ? `
                                                    <p><span class="text-sm text-gray-600">ID Transfert:</span> 
                                                        <span class="ml-2">${orderData.paymentInfo.transferId}</span>
                                                    </p>
                                                    <p><span class="text-sm text-gray-600">Téléphone:</span> 
                                                        <span class="ml-2">${orderData.paymentInfo.senderPhone}</span>
                                                    </p>
                                                    <p><span class="text-sm text-gray-600">Date du transfert:</span> 
                                                        <span class="ml-2">${orderData.paymentInfo.transferDate} à ${orderData.paymentInfo.transferTime}</span>
                                                    </p>
                                                ` : ''}
                                                ${transferData ? `
                                                    <p><span class="text-sm text-gray-600">Statut transfert:</span> 
                                                        <span class="ml-2 px-2 py-1 text-xs font-semibold rounded-full 
                                                            ${transferData.status === 'verified' ? 'bg-green-100 text-green-800' : 
                                                              transferData.status === 'pending' ? 'bg-yellow-100 text-yellow-800' : 
                                                              'bg-red-100 text-red-800'}">
                                                            ${transferData.status === 'verified' ? 'Vérifié' : 
                                                             transferData.status === 'pending' ? 'En attente' : 
                                                             'Rejeté'}
                                                        </span>
                                                    </p>
                                                    ${transferData.verifiedAt ? `
                                                        <p><span class="text-sm text-gray-600">Vérifié le:</span> 
                                                            <span class="ml-2">${new Date(transferData.verifiedAt.seconds * 1000).toLocaleDateString('fr-FR')}</span>
                                                        </p>
                                                    ` : ''}
                                                ` : ''}
                                            </div>
                                        </div>
                                        
                                        <div>
                                            <h4 class="font-medium text-gray-700 mb-2">Articles</h4>
                                            <div class="space-y-3">
                                                ${orderData.items.map(item => `
                                                    <div class="flex justify-between items-center p-3 bg-gray-50 rounded-lg">
                                                        <div>
                                                            <p class="font-medium">${item.name}</p>
                                                            ${Object.values(item.selectedOptions).filter(opt => opt).length > 0 ? `
                                                                <p class="text-sm text-gray-600">
                                                                    ${Object.entries(item.selectedOptions)
                                                                        .filter(([key, value]) => value)
                                                                        .map(([key, value]) => `${key}: ${value}`)
                                                                        .join(', ')}
                                                                </p>
                                                            ` : ''}
                                                        </div>
                                                        <div class="text-right">
                                                            <p class="font-medium">${FirebaseModule.formatPrice(item.finalPrice)}</p>
                                                            <p class="text-sm text-gray-600">${item.quantity} x ${FirebaseModule.formatPrice(item.unitPrice)}</p>
                                                        </div>
                                                    </div>
                                                `).join('')}
                                            </div>
                                        </div>
                                        
                                        <div class="bg-gray-50 p-4 rounded-lg">
                                            <div class="flex justify-between mb-2">
                                                <span class="text-sm text-gray-600">Sous-total:</span>
                                                <span class="font-medium">${FirebaseModule.formatPrice(orderData.subtotal)}</span>
                                            </div>
                                            <div class="flex justify-between mb-2">
                                                <span class="text-sm text-gray-600">Frais de livraison:</span>
                                                <span class="font-medium">${FirebaseModule.formatPrice(orderData.deliveryFee || 0)}</span>
                                            </div>
                                            <div class="flex justify-between pt-2 border-t border-gray-200">
                                                <span class="font-bold">Total:</span>
                                                <span class="font-bold text-lg">${FirebaseModule.formatPrice(orderData.totalAmount)}</span>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="mt-8 pt-6 border-t border-gray-200 flex justify-end space-x-3">
                                        ${orderData.status === 'payment_verified' || (transferData && transferData.status === 'verified') ? `
                                            <button onclick="downloadOrderReceipt('${orderData.orderCode}')" 
                                                class="px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors duration-300">
                                                <i class="fas fa-download mr-2"></i>Télécharger le reçu
                                            </button>
                                        ` : orderData.status === 'pending_verification' || (transferData && transferData.status === 'pending') ? `
                                            <button onclick="checkPaymentStatus('${orderData.orderCode}')" 
                                                class="px-6 py-3 bg-yellow-600 text-white rounded-lg hover:bg-yellow-700 transition-colors duration-300">
                                                <i class="fas fa-sync-alt mr-2"></i>Vérifier le statut
                                            </button>
                                        ` : ''}
                                        <button onclick="closeOrderDetailsModal()" 
                                            class="px-6 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors duration-300">
                                            Fermer
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                    
                    // Add modal to DOM
                    const modalContainer = document.createElement('div');
                    modalContainer.id = 'order-details-modal';
                    modalContainer.innerHTML = modalHTML;
                    document.body.appendChild(modalContainer);
                    
                } else {
                    showToast('Commande non trouvée', 'error');
                }
            } catch (error) {
                console.error('❌ Erreur lors de la récupération des détails:', error);
                showToast('Erreur lors de la récupération des détails', 'error');
            }
        };
        
        const closeOrderDetailsModal = () => {
            const modal = document.getElementById('order-details-modal');
            if (modal) {
                modal.remove();
            }
        };
        
        return {
            renderPendingOrdersSection,
            checkPaymentStatus,
            downloadOrderReceipt,
            viewOrderDetails,
            closeOrderDetailsModal
        };
    })();

    // ============================================
    // MODULE 8: UI Components & Page Rendering
    // ============================================
    const UIModule = (() => {
        const renderProductSkeleton = (count = 8) => {
            let skeletonHTML = '';
            
            for (let i = 0; i < count; i++) {
                skeletonHTML += `
                    <div class="bg-white rounded-xl shadow-md overflow-hidden">
                        <div class="h-48 bg-gray-200 skeleton"></div>
                        <div class="p-4">
                            <div class="h-6 bg-gray-200 rounded skeleton mb-2"></div>
                            <div class="h-4 bg-gray-200 rounded skeleton mb-2"></div>
                            <div class="h-4 bg-gray-200 rounded skeleton mb-4 w-2/3"></div>
                            <div class="flex justify-between items-center">
                                <div class="h-6 bg-gray-200 rounded skeleton w-20"></div>
                                <div class="h-10 bg-gray-200 rounded-lg skeleton w-24"></div>
                            </div>
                        </div>
                    </div>
                `;
            }
            
            return skeletonHTML;
        };
        
     const renderProductCard = (product) => {
    const hasOldPrice =
        product.showOldPrice &&
        product.oldPrice &&
        product.oldPrice > product.price;

    const hasOptions =
        product.hasSize ||
        product.hasColor ||
        product.hasMaterial ||
        product.hasPersonalizationText;

    // 🔑 Gestion multi-images (fallback sécurisé)
    const images = Array.isArray(product.images) && product.images.length
        ? product.images
        : [product.imageName || 'https://images.unsplash.com/photo-1505740420928-5e560c06d30e?auto=format&fit=crop&w=1000&q=80'];

    const mainImage = images[0];

    return `
        <div class="product-card bg-white rounded-xl shadow-md overflow-hidden hover:shadow-xl transition-all duration-300 flex flex-col h-full"
             data-product-id="${product.id}">

            <!-- Image + galerie -->
            <div class="relative h-48 overflow-hidden bg-gray-100">
                <img
                    src="${mainImage}"
                    alt="${product.name}"
                    class="product-main-image w-full h-full object-cover cursor-zoom-in hover:scale-105 transition-transform duration-500"
                    loading="lazy"
                    onclick="openImageModal(this.src, this.alt)"
                    onerror="this.src='https://images.unsplash.com/photo-1505740420928-5e560c06d30e?auto=format&fit=crop&w=1000&q=80'"
                />

                ${
                    images.length > 1
                        ? `
                        <div class="absolute bottom-2 left-2 right-2 flex gap-2 overflow-x-auto bg-black/40 p-2 rounded-lg">
                            ${images.map(img => `
                                <img
                                    src="${img}"
                                    class="w-10 h-10 object-cover rounded-md cursor-pointer border border-white/60 opacity-80 hover:opacity-100 transition"
                                    onclick="this.closest('.product-card')
                                        .querySelector('.product-main-image').src='${img}'"
                                />
                            `).join('')}
                        </div>
                        `
                        : ''
                }

                ${product.isNew ? `
                    <span class="absolute top-3 left-3 bg-green-500 text-white text-xs font-bold px-3 py-1 rounded-full">
                        Nouveau
                    </span>
                ` : ''}

                ${product.stockQuantity <= 5 ? `
                    <span class="absolute top-3 right-3 bg-red-500 text-white text-xs font-bold px-3 py-1 rounded-full">
                        Stock limité
                    </span>
                ` : ''}

                ${product.isFragile ? `
                    <span class="absolute bottom-3 left-3 bg-yellow-500 text-white text-xs font-bold px-3 py-1 rounded-full">
                        <i class="fas fa-exclamation-triangle mr-1"></i> Fragile
                    </span>
                ` : ''}
            </div>

            <!-- Contenu -->
            <div class="p-4 flex-grow flex flex-col">
                <h3 class="font-heading font-bold text-lg text-gray-800 mb-2">
                    ${product.name}
                </h3>

                <p class="text-gray-600 text-sm mb-4 flex-grow">
                    ${product.description
                        ? product.description.substring(0, 80) + (product.description.length > 80 ? '...' : '')
                        : 'Aucune description'}
                </p>

                ${
                    hasOptions
                        ? `
                        <div class="mb-4 text-sm text-gray-600 space-y-1">
                            ${product.hasSize && product.sizes?.length ? `
                                <p><i class="fas fa-ruler mr-1"></i> Tailles: ${product.sizes.join(', ')}</p>
                            ` : ''}
                            ${product.hasColor && product.colors?.length ? `
                                <p><i class="fas fa-palette mr-1"></i> Couleurs: ${product.colors.join(', ')}</p>
                            ` : ''}
                        </div>
                        `
                        : ''
                }

                <!-- Prix -->
                <div class="mb-4">
                    <div class="flex items-center space-x-2">
                        <span class="text-xl font-bold text-blue-600">
                            ${FirebaseModule.formatPrice(product.price)}
                        </span>
                        ${hasOldPrice ? `
                            <span class="text-lg text-gray-500 line-through">
                                ${FirebaseModule.formatPrice(product.oldPrice)}
                            </span>
                        ` : ''}
                    </div>

                    ${product.stockQuantity <= 0 ? `
                        <p class="text-red-600 text-sm mt-1">
                            <i class="fas fa-times-circle mr-1"></i> Rupture de stock
                        </p>
                    ` : ''}

                    ${product.weight ? `
                        <p class="text-gray-500 text-sm mt-1">
                            <i class="fas fa-weight-hanging mr-1"></i> ${product.weight} Gramme
                        </p>
                    ` : ''}
                </div>

                <!-- Bouton -->
                <button
                    onclick="showProductOptions('${product.id}')"
                    class="add-to-cart-btn w-full bg-blue-600 hover:bg-blue-700 text-white font-medium py-3 rounded-lg transition-colors duration-300 flex items-center justify-center
                        ${!product.isAvailable || product.stockQuantity <= 0 ? 'opacity-50 cursor-not-allowed' : ''}"
                    ${!product.isAvailable || product.stockQuantity <= 0 ? 'disabled' : ''}
                >
                    <i class="fas fa-cart-plus mr-2"></i>
                    ${!product.isAvailable || product.stockQuantity <= 0 ? 'Indisponible' : 'Ajouter au panier'}
                </button>
            </div>
        </div>
    `;
};

        const renderCataloguePage = async () => {
            const products = window.appState.filteredProducts;
            const categories = window.appState.categories;
            
            return `
                <div class="page-enter">
                    <div class="bg-white rounded-xl shadow-md p-6 mb-8">
                        <div class="flex flex-col md:flex-row md:items-center justify-between space-y-4 md:space-y-0">
                            <div class="flex-grow md:mr-4">
                                <div class="relative">
                                    <input 
                                        type="text" 
                                        id="search-input"
                                        placeholder="Rechercher un produit..."
                                        class="w-full px-4 py-3 pl-12 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-300"
                                        value="${window.appState.currentSearchTerm}"
                                    >
                                    <i class="fas fa-search absolute left-4 top-3.5 text-gray-400"></i>
                                </div>
                            </div>
                            
                            <button 
                                id="filters-toggle"
                                class="md:hidden flex items-center justify-center px-4 py-3 bg-gray-100 hover:bg-gray-200 rounded-lg transition-colors duration-300"
                            >
                                <i class="fas fa-filter mr-2"></i>
                                Filtres
                            </button>
                            
                            <div class="hidden md:flex space-x-2">
                                <button 
                                    onclick="filterProducts('all')"
                                    class="category-filter px-4 py-2 ${window.appState.currentCategoryFilter === 'all' ? 'bg-blue-600 text-white' : 'bg-gray-100 hover:bg-gray-200 text-gray-700'} rounded-lg transition-colors duration-300"
                                    data-category="all"
                                >
                                    Tous
                                </button>
                                ${categories.map(category => `
                                    <button 
                                        onclick="filterProducts('${category}')"
                                        class="category-filter px-4 py-2 ${window.appState.currentCategoryFilter === category ? 'bg-blue-600 text-white' : 'bg-gray-100 hover:bg-gray-200 text-gray-700'} rounded-lg transition-colors duration-300"
                                        data-category="${category}"
                                    >
                                        ${category}
                                    </button>
                                `).join('')}
                            </div>
                        </div>
                        
                        <div id="mobile-filters" class="hidden mt-4 pt-4 border-t border-gray-200">
                            <div class="flex flex-wrap gap-2">
                                <button 
                                    onclick="filterProducts('all')"
                                    class="category-filter px-4 py-2 ${window.appState.currentCategoryFilter === 'all' ? 'bg-blue-600 text-white' : 'bg-gray-100 hover:bg-gray-200 text-gray-700'} rounded-lg transition-colors duration-300"
                                    data-category="all"
                                >
                                    Tous
                                </button>
                                ${categories.map(category => `
                                    <button 
                                        onclick="filterProducts('${category}')"
                                        class="category-filter px-4 py-2 ${window.appState.currentCategoryFilter === category ? 'bg-blue-600 text-white' : 'bg-gray-100 hover:bg-gray-200 text-gray-700'} rounded-lg transition-colors duration-300"
                                        data-category="${category}"
                                    >
                                        ${category}
                                    </button>
                                `).join('')}
                            </div>
                        </div>
                    </div>
                    
                    <div class="mb-4">
                        <h2 class="font-heading font-bold text-xl text-gray-800">
                            Produits 
                            <span id="results-counter" class="text-sm text-gray-500 font-normal ml-2">
                                (${products.length} résultat${products.length !== 1 ? 's' : ''})
                            </span>
                        </h2>
                    </div>
                    
                    <div id="products-grid-container">
                        <div id="products-container" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
                            ${products.length === 0 ? 
                                renderProductSkeleton(8) : 
                                products.map(product => renderProductCard(product)).join('')
                            }
                        </div>
                    </div>
                    
                    ${products.length === 0 && !window.appState.isLoading ? `
                        <div class="text-center py-12">
                            <i class="fas fa-box-open text-6xl text-gray-300 mb-4"></i>
                            <h3 class="text-xl font-semibold text-gray-700 mb-2">Aucun produit trouvé</h3>
                            <p class="text-gray-500">${window.appState.currentSearchTerm ? 'Essayez d\'autres termes de recherche.' : 'Les produits seront bientôt ajoutés à notre catalogue.'}</p>
                        </div>
                    ` : ''}
                </div>
            `;
        };
        
        const renderCartPage = async () => {
            const cart = window.appState.cartData || { items: [], subtotal: 0, totalWeight: 0, oldPriceTotal: 0 };
            const deliveryRules = window.appState.deliveryRules;
            
            // Calculer les frais de livraison
            const baseDeliveryFee = FirebaseModule.calculateDeliveryFee(cart.totalWeight, deliveryRules);
            
            // Ajouter frais supplémentaires pour produits fragiles
            let fragileExtraFee = 0;
            const fragileItemsCount = cart.items.reduce((count, item) => 
                count + (item.isFragile ? item.quantity : 0), 0);
            
            if (fragileItemsCount > 0 && deliveryRules[0]?.fragileExtraFee) {
                fragileExtraFee = fragileItemsCount * deliveryRules[0].fragileExtraFee;
            }
            
            const totalDeliveryFee = baseDeliveryFee + fragileExtraFee;
            const totalAmount = cart.subtotal + totalDeliveryFee;
            const savings = cart.oldPriceTotal - cart.subtotal;
            
            // Get pending orders section
            const pendingOrdersSection = PendingOrdersModule.renderPendingOrdersSection();
            
            return `
                <div class="page-enter">
                    <div class="mb-8">
                        <h1 class="font-heading font-bold text-3xl md:text-4xl text-gray-800 mb-2">Votre Panier</h1>
                        <p class="text-gray-600">Révisez vos articles et finalisez votre commande</p>
                    </div>
                    
                    <div class="flex flex-col lg:flex-row gap-8">
                        <div class="lg:w-2/3">
                            <div class="bg-white rounded-xl shadow-md overflow-hidden">
                                <div class="p-6 border-b border-gray-200">
                                    <h2 class="font-heading font-bold text-xl text-gray-800">
                                        Articles (${cart.items.length})
                                    </h2>
                                </div>
                                
                                <div id="cart-items-container">
                                    ${cart.items.length === 0 ? `
                                        <div class="p-12 text-center">
                                            <i class="fas fa-shopping-cart text-6xl text-gray-300 mb-4"></i>
                                            <h3 class="text-xl font-semibold text-gray-700 mb-2">Votre panier est vide</h3>
                                            <p class="text-gray-500 mb-6">Ajoutez des articles depuis notre catalogue.</p>
                                            <a href="#catalogue" data-page="catalogue" class="nav-link inline-block px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors duration-300">
                                                <i class="fas fa-store mr-2"></i> Voir le catalogue
                                            </a>
                                        </div>
                                    ` : cart.items.map((item, index) => `
                                        <div class="cart-item p-6 border-b border-gray-100 last:border-b-0 hover:bg-gray-50 transition-colors duration-300" data-item-index="${index}">
                                            <div class="flex flex-col sm:flex-row gap-4">
                                                <div class="sm:w-24 sm:h-24 w-full h-48 sm:h-auto rounded-lg overflow-hidden bg-gray-100 flex-shrink-0">
                                                    <img 
                                                        src="${item.imageName || 'https://images.unsplash.com/photo-1505740420928-5e560c06d30e?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1000&q=80'}" 
                                                        alt="${item.name}"
                                                        class="w-full h-full object-cover"
                                                    >
                                                </div>
                                                
                                                <div class="flex-grow">
                                                    <div class="flex justify-between">
                                                        <h3 class="font-heading font-bold text-lg text-gray-800">${item.name}</h3>
                                                        ${item.isFragile ? `
                                                            <span class="text-yellow-600 text-sm">
                                                                <i class="fas fa-exclamation-triangle mr-1"></i>Fragile
                                                            </span>
                                                        ` : ''}
                                                        <button 
                                                            onclick="removeCartItem(${index})"
                                                            class="text-red-500 hover:text-red-700 transition-colors duration-300"
                                                            title="Supprimer"
                                                        >
                                                            <i class="fas fa-trash"></i>
                                                        </button>
                                                    </div>
                                                    
                                                    ${Object.values(item.selectedOptions).filter(opt => opt).length > 0 ? `
                                                        <div class="mt-2">
                                                            <p class="text-sm text-gray-600">
                                                                ${Object.entries(item.selectedOptions)
                                                                    .filter(([key, value]) => value)
                                                                    .map(([key, value]) => `<span class="inline-block bg-gray-100 px-2 py-1 rounded mr-2 mb-1">${key}: ${value}</span>`)
                                                                    .join('')
                                                                }
                                                            </p>
                                                        </div>
                                                    ` : ''}
                                                    
                                                    <div class="flex flex-col sm:flex-row sm:items-center justify-between mt-4">
                                                        <div class="mb-4 sm:mb-0">
                                                            <div class="flex items-center space-x-2">
                                                                <span class="text-xl font-bold text-blue-600">
                                                                    ${FirebaseModule.formatPrice(item.finalPrice)}
                                                                </span>
                                                                ${item.oldPrice && item.oldPrice > item.unitPrice ? `
                                                                    <span class="text-gray-500 line-through">
                                                                        ${FirebaseModule.formatPrice(item.oldPrice * item.quantity)}
                                                                    </span>
                                                                ` : ''}
                                                            </div>
                                                            <p class="text-gray-600 text-sm">
                                                                ${FirebaseModule.formatPrice(item.unitPrice)} l'unité
                                                            </p>
                                                            ${item.weight ? `
                                                                <p class="text-gray-500 text-xs">
                                                                    Poids: ${item.weight} Gramme × ${item.quantity} = ${(item.weight * item.quantity).toFixed(2)} Gramme
                                                                </p>
                                                            ` : ''}
                                                        </div>
                                                        
                                                        <div class="flex items-center space-x-3">
                                                            <button 
                                                                onclick="updateCartItemQuantity(${index}, ${item.quantity - 1})"
                                                                class="w-8 h-8 flex items-center justify-center bg-gray-100 hover:bg-gray-200 rounded-lg transition-colors duration-300 ${item.quantity <= 1 ? 'opacity-50 cursor-not-allowed' : ''}"
                                                                ${item.quantity <= 1 ? 'disabled' : ''}
                                                            >
                                                                <i class="fas fa-minus"></i>
                                                            </button>
                                                            
                                                            <span class="text-lg font-medium w-10 text-center">
                                                                ${item.quantity}
                                                            </span>
                                                            
                                                            <button 
                                                                onclick="updateCartItemQuantity(${index}, ${item.quantity + 1})"
                                                                class="w-8 h-8 flex items-center justify-center bg-gray-100 hover:bg-gray-200 rounded-lg transition-colors duration-300"
                                                            >
                                                                <i class="fas fa-plus"></i>
                                                            </button>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    `).join('')}
                                </div>
                                
                                ${cart.items.length > 0 ? `
                                    <div class="p-6 border-t border-gray-200 flex justify-between">
                                        <a href="#catalogue" data-page="catalogue" class="nav-link px-6 py-3 border border-blue-600 text-blue-600 rounded-lg hover:bg-blue-50 transition-colors duration-300">
                                            <i class="fas fa-arrow-left mr-2"></i> Continuer mes achats
                                        </a>
                                        <button 
                                            onclick="clearCart()"
                                            class="px-6 py-3 border border-red-600 text-red-600 rounded-lg hover:bg-red-50 transition-colors duration-300"
                                        >
                                            <i class="fas fa-trash mr-2"></i> Vider le panier
                                        </button>
                                    </div>
                                ` : ''}
                            </div>
                        </div>
                        
                        <div class="lg:w-1/3">
                            <div class="bg-white rounded-xl shadow-md overflow-hidden sticky top-24">
                                <div class="p-6 border-b border-gray-200">
                                    <h2 class="font-heading font-bold text-xl text-gray-800">
                                        Récapitulatif de commande
                                    </h2>
                                </div>
                                
                                <div class="p-6">
                                    <div class="space-y-4 mb-6">
                                        <div class="flex justify-between">
                                            <span class="text-gray-600">Sous-total</span>
                                            <span class="font-medium">${FirebaseModule.formatPrice(cart.subtotal)}</span>
                                        </div>
                                        
                                        ${savings > 0 ? `
                                            <div class="flex justify-between">
                                                <span class="text-gray-600">Économies</span>
                                                <span class="font-medium text-green-600">-${FirebaseModule.formatPrice(savings)}</span>
                                            </div>
                                        ` : ''}
                                        
                                        <div class="flex justify-between">
                                            <span class="text-gray-600">Articles</span>
                                            <span class="font-medium">${cart.items.length}</span>
                                        </div>
                                        
                                        <div class="flex justify-between">
                                            <span class="text-gray-600">Poids total</span>
                                            <span class="font-medium">${cart.totalWeight.toFixed(2)} Gramme</span>
                                        </div>
                                        
                                        <div class="flex justify-between">
                                            <span class="text-gray-600">Frais de livraison</span>
                                            <span class="font-medium">${FirebaseModule.formatPrice(totalDeliveryFee)}</span>
                                        </div>
                                        
                                        ${fragileExtraFee > 0 ? `
                                            <div class="flex justify-between text-sm text-gray-500">
                                                <span>Dont frais fragile (${fragileItemsCount} article${fragileItemsCount > 1 ? 's' : ''})</span>
                                                <span>+${FirebaseModule.formatPrice(fragileExtraFee)}</span>
                                            </div>
                                        ` : ''}
                                    </div>
                                    
                                    <div class="py-4 border-t border-gray-200">
                                        <div class="flex justify-between items-center">
                                            <span class="text-lg font-bold text-gray-800">Total</span>
                                            <span class="text-2xl font-bold text-blue-600">
                                                ${FirebaseModule.formatPrice(totalAmount)}
                                            </span>
                                        </div>
                                    </div>
                                    
                                    <button 
                                        id="checkout-button"
                                        onclick="openCheckoutModal(${cart.subtotal}, ${totalDeliveryFee})"
                                        class="w-full py-4 bg-green-600 hover:bg-green-700 text-white font-bold rounded-lg transition-colors duration-300 flex items-center justify-center ${cart.items.length === 0 ? 'opacity-50 cursor-not-allowed' : ''}"
                                        ${cart.items.length === 0 ? 'disabled' : ''}
                                    >
                                        <i class="fas fa-lock mr-2"></i>
                                        Finaliser la commande
                                    </button>
                                    
                                    ${deliveryRules.length > 0 ? `
                                        <div class="mt-4 p-3 bg-gray-50 rounded-lg">
                                            <p class="text-xs text-gray-600">
                                                <i class="fas fa-info-circle mr-1"></i>
                                                Frais de livraison calculés selon le poids total (${cart.totalWeight.toFixed(2)} Gramme)
                                            </p>
                                        </div>
                                    ` : ''}
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Pending Orders Section -->
                    ${pendingOrdersSection}
                </div>
            `;
        };
        
        const renderAboutPage = () => {
            return `
                <div class="page-enter">
                    <div class="mb-8 text-center">
                        <h1 class="font-heading font-bold text-3xl md:text-4xl text-gray-800 mb-4">À Propos de Nous</h1>
                        <p class="text-gray-600 max-w-2xl mx-auto">
                            Découvrez l'histoire d'Smart Cut Services et notre engagement à vous offrir la meilleure expérience d'achat en ligne.
                        </p>
                    </div>
                    
                    <div class="bg-gradient-to-r from-blue-600 to-blue-800 rounded-2xl shadow-xl overflow-hidden mb-12">
                        <div class="p-8 md:p-12 text-white">
                            <div class="max-w-3xl">
                                <h2 class="font-heading font-bold text-3xl md:text-4xl mb-4">Votre confiance, notre priorité</h2>
                                <p class="text-xl mb-6 opacity-90">
                                    Chez Smart Cut Services, nous croyons que le shopping en ligne devrait être simple, sécurisé et agréable.
                                </p>
                                <div class="flex flex-wrap gap-4">
                                    <div class="flex items-center">
                                        <i class="fas fa-shipping-fast text-2xl mr-3"></i>
                                        <span>Livraison rapide</span>
                                    </div>
                                    <div class="flex items-center">
                                        <i class="fas fa-shield-alt text-2xl mr-3"></i>
                                        <span>Paiement sécurisé</span>
                                    </div>
                                    <div class="flex items-center">
                                        <i class="fas fa-headset text-2xl mr-3"></i>
                                        <span>Support 7j/7</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="grid md:grid-cols-2 gap-8 mb-12">
                        <div class="bg-white rounded-xl shadow-md p-6">
                            <div class="w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center mb-4">
                                <i class="fas fa-bullseye text-blue-600 text-xl"></i>
                            </div>
                            <h3 class="font-heading font-bold text-xl text-gray-800 mb-3">Notre Mission</h3>
                            <p class="text-gray-600">
                                Rendre le shopping en ligne accessible à tous en Haïti avec une expérience fluide, 
                                des produits de qualité et un service client exceptionnel.
                            </p>
                        </div>
                        
                        <div class="bg-white rounded-xl shadow-md p-6">
                            <div class="w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center mb-4">
                                <i class="fas fa-handshake text-green-600 text-xl"></i>
                            </div>
                            <h3 class="font-heading font-bold text-xl text-gray-800 mb-3">Nos Valeurs</h3>
                            <p class="text-gray-600">
                                Transparence, qualité, innovation et engagement envers nos clients. 
                                Chaque décision est prise avec votre satisfaction en tête.
                            </p>
                        </div>
                    </div>
                    
                    <div class="bg-white rounded-xl shadow-md p-8">
                        <h3 class="font-heading font-bold text-2xl text-gray-800 mb-6 text-center">Notre Engagement</h3>
                        <div class="grid md:grid-cols-3 gap-6">
                            <div class="text-center">
                                <div class="w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4">
                                    <i class="fas fa-award text-blue-600 text-2xl"></i>
                                </div>
                                <h4 class="font-bold text-gray-800 mb-2">Qualité Garantie</h4>
                                <p class="text-gray-600 text-sm">Tous nos produits sont soigneusement sélectionnés et testés.</p>
                            </div>
                            
                            <div class="text-center">
                                <div class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
                                    <i class="fas fa-leaf text-green-600 text-2xl"></i>
                                </div>
                                <h4 class="font-bold text-gray-800 mb-2">Développement Durable</h4>
                                <p class="text-gray-600 text-sm">Nous nous engageons à réduire notre impact environnemental.</p>
                            </div>
                            
                            <div class="text-center">
                                <div class="w-16 h-16 bg-purple-100 rounded-full flex items-center justify-center mx-auto mb-4">
                                    <i class="fas fa-heart text-purple-600 text-2xl"></i>
                                </div>
                                <h4 class="font-bold text-gray-800 mb-2">Satisfaction Client</h4>
                                <p class="text-gray-600 text-sm">Votre bonheur est notre principale mesure de succès.</p>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        };
        
        return {
            renderCataloguePage,
            renderCartPage,
            renderAboutPage,
            renderProductSkeleton,
            renderProductCard
        };
    })();

    // ============================================
    // MODULE 9: App Core & Routing
    // ============================================
    const AppModule = (() => {
        const initializeApp = async () => {
            console.log('🚀 Initialisation de l\'application...');
            
            if (!FirebaseModule.initializeFirebase()) {
                renderErrorState('Impossible de se connecter à la base de données');
                return;
            }
            
            await CartSessionModule.initializeCartSession();
            await DataModule.loadAllData();
            
            setupRouter();
            setupEventListeners();
            
            const initialHash = window.location.hash.substring(1) || 'catalogue';
            navigateTo(initialHash);
            
            console.log('✅ Application initialisée avec succès');
        };
        
        const setupRouter = () => {
            window.addEventListener('hashchange', () => {
                const page = window.location.hash.substring(1) || 'catalogue';
                navigateTo(page);
            });
            
            window.addEventListener('popstate', () => {
                const page = window.location.hash.substring(1) || 'catalogue';
                navigateTo(page);
            });
        };
        
        const navigateTo = async (page) => {
            window.appState.currentPage = page;
            updateActiveNavLink(page);
            
            const pageContent = document.getElementById('page-content');
            if (!pageContent) return;
            
            pageContent.innerHTML = `
                <div class="flex flex-col items-center justify-center min-h-[60vh]">
                    <div class="w-12 h-12 border-4 border-blue-600 border-t-transparent rounded-full loading-spinner mb-4"></div>
                    <p class="text-gray-600">Chargement...</p>
                </div>
            `;
            
            try {
                let pageHTML = '';
                
                switch (page) {
                    case 'catalogue':
                        pageHTML = await UIModule.renderCataloguePage();
                        break;
                    case 'panier':
                        pageHTML = await UIModule.renderCartPage();
                        break;
                    case 'about':
                        pageHTML = await UIModule.renderAboutPage();
                        break;
                    default:
                        pageHTML = await UIModule.renderCataloguePage();
                }
                
                pageContent.innerHTML = pageHTML;
                initializePageFunctionality(page);
                
                anime({
                    targets: '.page-enter',
                    opacity: [0, 1],
                    translateY: [20, 0],
                    duration: 600,
                    easing: 'easeOutExpo'
                });
                
                window.scrollTo({ top: 0, behavior: 'smooth' });
                
            } catch (error) {
                console.error(`❌ Erreur lors du chargement de la page ${page}:`, error);
                pageContent.innerHTML = `
                    <div class="text-center py-12">
                        <i class="fas fa-exclamation-triangle text-6xl text-red-300 mb-4"></i>
                        <h3 class="text-xl font-semibold text-gray-700 mb-2">Erreur de chargement</h3>
                        <p class="text-gray-500 mb-4">Impossible de charger la page. Veuillez réessayer.</p>
                        <button onclick="location.reload()" class="px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors duration-300">
                            Réessayer
                        </button>
                    </div>
                `;
            }
        };
        
        const updateActiveNavLink = (activePage) => {
            document.querySelectorAll('.nav-link').forEach(link => {
                const page = link.getAttribute('data-page');
                if (page === activePage) {
                    link.classList.add('text-blue-600', 'font-semibold');
                    link.classList.remove('text-gray-700');
                } else {
                    link.classList.remove('text-blue-600', 'font-semibold');
                    link.classList.add('text-gray-700');
                }
            });
        };
        
        const initializePageFunctionality = (page) => {
            switch (page) {
                case 'catalogue':
                    setTimeout(() => {
                        initializeCatalogueListeners();
                    }, 100);
                    break;
                case 'panier':
                    initializeCartPage();
                    break;
            }
        };
        
        const initializeCatalogueListeners = () => {
            // Search functionality
            const searchInput = document.getElementById('search-input');
            if (searchInput) {
                let searchTimeout;
                searchInput.addEventListener('input', function(e) {
                    clearTimeout(searchTimeout);
                    searchTimeout = setTimeout(() => {
                        window.appState.currentSearchTerm = e.target.value;
                        filterProducts(window.appState.currentCategoryFilter, e.target.value);
                    }, 500);
                });
            }
            
            // Mobile filters toggle
            const filtersToggle = document.getElementById('filters-toggle');
            const mobileFilters = document.getElementById('mobile-filters');
            if (filtersToggle && mobileFilters) {
                filtersToggle.addEventListener('click', () => {
                    mobileFilters.classList.toggle('hidden');
                });
            }
        };
        
        const initializeCartPage = () => {
            // Cart item animations
            document.querySelectorAll('.cart-item button').forEach(button => {
                button.addEventListener('click', function() {
                    anime({
                        targets: this,
                        scale: [1, 0.9, 1],
                        duration: 200,
                        easing: 'easeInOutSine'
                    });
                });
            });
            
            // Afficher la section des commandes en attente si elle existe
            const pendingOrdersSection = document.getElementById('pending-orders-section');
            if (pendingOrdersSection && window.appState.pendingOrders.length > 0) {
                pendingOrdersSection.classList.remove('hidden');
            }
        };
        
        const setupEventListeners = () => {
            // Mobile menu
            const mobileMenuButton = document.getElementById('mobile-menu-button');
            const mobileMenu = document.getElementById('mobile-menu');
            
            if (mobileMenuButton && mobileMenu) {
                mobileMenuButton.addEventListener('click', () => {
                    mobileMenu.classList.toggle('hidden');
                });
            }
            
            // Close mobile menu when clicking outside
            document.addEventListener('click', (e) => {
                if (!e.target.closest('#mobile-menu') && !e.target.closest('#mobile-menu-button')) {
                    if (mobileMenu && !mobileMenu.classList.contains('hidden')) {
                        mobileMenu.classList.add('hidden');
                    }
                }
            });
            
            // Button animations
            document.addEventListener('click', function(e) {
                if (e.target.tagName === 'BUTTON' || e.target.closest('button')) {
                    const button = e.target.tagName === 'BUTTON' ? e.target : e.target.closest('button');
                    if (!button.classList.contains('no-animation')) {
                        anime({
                            targets: button,
                            scale: [1, 0.98, 1],
                            duration: 150,
                            easing: 'easeInOutSine'
                        });
                    }
                }
            });
            
            // Custom meeting point input
            const customMeetingPoint = document.getElementById('custom-meeting-point');
            if (customMeetingPoint) {
                customMeetingPoint.addEventListener('input', function() {
                    if (this.value.trim()) {
                        // Clear selected meeting point if custom is entered
                        window.appState.checkoutData.selectedMeetingPoint = null;
                        
                        // Clear selection indicators
                        document.querySelectorAll('.delivery-point-item').forEach(item => {
                            item.classList.remove('selected', 'border-blue-500', 'bg-blue-50');
                            item.querySelector('.selection-indicator').classList.add('hidden');
                        });
                    }
                });
            }
        };
        
        const renderErrorState = (message) => {
            const pageContent = document.getElementById('page-content');
            if (pageContent) {
                pageContent.innerHTML = `
                    <div class="text-center py-12">
                        <i class="fas fa-exclamation-triangle text-6xl text-red-300 mb-4"></i>
                        <h3 class="text-xl font-semibold text-gray-700 mb-2">Erreur d'initialisation</h3>
                        <p class="text-gray-500 mb-4">${message}</p>
                        <button onclick="location.reload()" class="px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors duration-300">
                            Réessayer
                        </button>
                    </div>
                `;
            }
        };
        
        return {
            initializeApp,
            navigateTo
        };
    })();

    // ============================================
    // GLOBAL FUNCTIONS
    // ============================================

    // Product options
    window.showProductOptions = (productId) => {
        const product = window.appState.products.find(p => p.id === productId);
        if (!product) return;
        
        window.appState.currentProductForOptions = product;
        window.appState.selectedOptions = {};
        window.appState.selectedQuantity = 1;
        
        const modal = document.getElementById('product-options-modal');
        const content = document.getElementById('product-options-content');
        
        let optionsHTML = `
            <div class="mb-6">
                <div class="flex items-center space-x-4 mb-4">
                    <div class="w-16 h-16 rounded-lg overflow-hidden bg-gray-100 flex-shrink-0">
                        <img 
                            src="${product.imageName || 'https://images.unsplash.com/photo-1505740420928-5e560c06d30e?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1000&q=80'}" 
                            alt="${product.name}"
                            class="w-full h-full object-cover"
                        >
                    </div>
                    <div>
                        <h4 class="font-bold text-lg text-gray-800">${product.name}</h4>
                        <p class="text-blue-600 font-bold">${FirebaseModule.formatPrice(product.price)}</p>
                        ${product.stockQuantity > 0 ? `
                           
                        ` : ''}
                        ${product.isFragile ? `
                            <p class="text-yellow-600 text-sm">
                                <i class="fas fa-exclamation-triangle mr-1"></i> Produit fragile
                            </p>
                        ` : ''}
                    </div>
                </div>
            </div>
        `;
        
        // Add options based on product configuration
        if (product.hasSize && product.sizes && product.sizes.length > 0) {
            optionsHTML += `
                <div class="mb-6">
                    <label class="block text-sm font-medium text-gray-700 mb-3">Taille</label>
                    <div class="flex flex-wrap gap-2">
                        ${product.sizes.map(size => `
                            <button 
                                type="button"
                                onclick="selectOption('size', '${size}')"
                                class="option-button px-4 py-2 border border-gray-300 rounded-lg hover:border-blue-500 hover:text-blue-600 transition-colors duration-300"
                                data-option="size"
                                data-value="${size}"
                            >
                                ${size}
                            </button>
                        `).join('')}
                    </div>
                </div>
            `;
        }
        
        if (product.hasColor && product.colors && product.colors.length > 0) {
            optionsHTML += `
                <div class="mb-6">
                    <label class="block text-sm font-medium text-gray-700 mb-3">Couleur</label>
                    <div class="flex flex-wrap gap-2">
                        ${product.colors.map(color => `
                            <button 
                                type="button"
                                onclick="selectOption('color', '${color}')"
                                class="option-button px-4 py-2 border border-gray-300 rounded-lg hover:border-blue-500 hover:text-blue-600 transition-colors duration-300"
                                data-option="color"
                                data-value="${color}"
                            >
                                ${color}
                            </button>
                        `).join('')}
                    </div>
                </div>
            `;
        }
        
        // Quantity selector
        optionsHTML += `
            <div class="mb-6">
                <label class="block text-sm font-medium text-gray-700 mb-3">Quantité</label>
                <div class="flex items-center space-x-4">
                    <button 
                        onclick="updateModalQuantity(-1)"
                        class="w-10 h-10 flex items-center justify-center bg-gray-100 hover:bg-gray-200 rounded-lg transition-colors duration-300"
                        id="decrease-quantity"
                    >
                        <i class="fas fa-minus"></i>
                    </button>
                    <span id="modal-quantity-display" class="text-xl font-medium w-10 text-center">1</span>
                    <button 
                        onclick="updateModalQuantity(1)"
                        class="w-10 h-10 flex items-center justify-center bg-gray-100 hover:bg-gray-200 rounded-lg transition-colors duration-300"
                        id="increase-quantity"
                    >
                        <i class="fas fa-plus"></i>
                    </button>
                </div>
                <p class="text-xs text-gray-500 mt-1">Stock disponible: ${product.stockQuantity}</p>
            </div>
        `;
        
        content.innerHTML = optionsHTML;
        modal.classList.remove('hidden');
        
        anime({
            targets: modal,
            opacity: [0, 1],
            duration: 300,
            easing: 'easeOutExpo'
        });
    };

    window.selectOption = (option, value) => {
        window.appState.selectedOptions[option] = value;
        
        document.querySelectorAll(`[data-option="${option}"]`).forEach(btn => {
            btn.classList.remove('selected');
            if (btn.getAttribute('data-value') === value) {
                btn.classList.add('selected');
            }
        });
    };

    window.updateModalQuantity = (change) => {
        const product = window.appState.currentProductForOptions;
        if (!product) return;
        
        const currentQuantity = window.appState.selectedQuantity || 1;
        const newQuantity = currentQuantity + change;
        
        if (newQuantity < 1 || newQuantity > product.stockQuantity) return;
        
        window.appState.selectedQuantity = newQuantity;
        document.getElementById('modal-quantity-display').textContent = newQuantity;
    };

    window.addToCartWithOptions = async () => {
        const product = window.appState.currentProductForOptions;
        if (!product) return;
        
        const selectedOptions = { ...window.appState.selectedOptions };
        const quantity = window.appState.selectedQuantity || 1;
        
        const success = await CartSessionModule.addToCart(product, selectedOptions, quantity);
        
        if (success) {
            closeProductOptionsModal();
            
            if (window.appState.currentPage === 'panier') {
                AppModule.navigateTo('panier');
            }
        }
    };

    window.closeProductOptionsModal = () => {
        const modal = document.getElementById('product-options-modal');
        modal.classList.add('hidden');
        window.appState.currentProductForOptions = null;
        window.appState.selectedOptions = {};
    };

    // Checkout functions
    window.openCheckoutModal = (subtotal, deliveryFee) => {
        CheckoutModule.openCheckoutModal(subtotal, deliveryFee);
    };

    window.closeCheckoutModal = () => {
        CheckoutModule.closeCheckoutModal();
    };

    window.goToStep = (step) => {
        CheckoutModule.goToStep(step);
    };

    window.verifyPayment = () => {
        CheckoutModule.verifyPayment();
    };

    window.submitOrder = () => {
        CheckoutModule.submitOrder();
    };

    window.downloadReceipt = async () => {
        const order = window.appState.currentOrder;
        if (order) {
            await PDFModule.generateReceipt(order);
        }
    };

    window.downloadOrderReceipt = async (orderCode) => {
        await PendingOrdersModule.downloadOrderReceipt(orderCode);
    };

    window.checkPaymentStatus = async (orderCode) => {
        await PendingOrdersModule.checkPaymentStatus(orderCode);
    };

    window.viewOrderDetails = async (orderCode) => {
        await PendingOrdersModule.viewOrderDetails(orderCode);
    };

    window.closeOrderDetailsModal = () => {
        PendingOrdersModule.closeOrderDetailsModal();
    };

    window.closePaymentSuccessModal = () => {
        const modal = document.getElementById('payment-success-modal');
        if (modal) {
            modal.classList.add('hidden');
        }
    };

    // Cart functions
    window.removeCartItem = async (itemIndex) => {
        const confirmed = confirm('Êtes-vous sûr de vouloir supprimer cet article du panier?');
        if (confirmed) {
            await CartSessionModule.removeFromCart(itemIndex);
            
            if (window.appState.currentPage === 'panier') {
                AppModule.navigateTo('panier');
            }
        }
    };

 window.updateCartItemQuantity = async (itemIndex, newQuantity) => {
    if (newQuantity < 1) {
        await CartSessionModule.removeFromCart(itemIndex);
    } else {
        await CartSessionModule.updateItemQuantity(itemIndex, newQuantity);
    }

    // 🔁 RE-RENDER COMPLET (OBLIGATOIRE)
    if (window.appState.currentPage === 'panier') {
        AppModule.navigateTo('panier');
    }
};


    window.clearCart = async () => {
        const confirmed = confirm('Êtes-vous sûr de vouloir vider votre panier?');
        if (confirmed) {
            await CartSessionModule.clearCartSession();
            
            if (window.appState.currentPage === 'panier') {
                AppModule.navigateTo('panier');
            }
        }
    };

    // Filter functions
    window.filterProducts = (category, searchQuery = '') => {
        window.appState.currentCategoryFilter = category;
        window.appState.currentSearchTerm = searchQuery || '';
        
        const products = window.appState.products;
        
        let filtered = products;
        
        // Filter by category
        if (category !== 'all') {
            filtered = filtered.filter(product => product.category === category);
        }
        
        // Filter by search query
        if (searchQuery) {
            const query = searchQuery.toLowerCase();
            filtered = filtered.filter(product => 
                product.name.toLowerCase().includes(query) || 
                (product.description && product.description.toLowerCase().includes(query))
            );
        }
        
        window.appState.filteredProducts = filtered;
        
        // Update UI
        const productsContainer = document.getElementById('products-container');
        if (productsContainer) {
            productsContainer.innerHTML = filtered.map(product => UIModule.renderProductCard(product)).join('');
        }
        
        // Update results counter
        const resultsCounter = document.getElementById('results-counter');
        if (resultsCounter) {
            resultsCounter.textContent = `(${filtered.length} résultat${filtered.length !== 1 ? 's' : ''})`;
        }
        
        // Update category buttons
        document.querySelectorAll('.category-filter').forEach(btn => {
            const btnCategory = btn.getAttribute('data-category');
            if (btnCategory === category) {
                btn.classList.add('bg-blue-600', 'text-white');
                btn.classList.remove('bg-gray-100', 'text-gray-700');
                
                anime({
                    targets: btn,
                    scale: [1, 1.05, 1],
                    duration: 300,
                    easing: 'easeInOutSine'
                });
            } else {
                btn.classList.remove('bg-blue-600', 'text-white');
                btn.classList.add('bg-gray-100', 'text-gray-700');
            }
        });
    };

    // ============================================
    // INITIALIZATION
    // ============================================

    document.addEventListener('DOMContentLoaded', () => {
        // Set current year
        document.getElementById('current-year').textContent = new Date().getFullYear();
        
        // Initialize app
        AppModule.initializeApp();
        
        // Network status
        window.addEventListener('online', () => {
            showToast('Connexion rétablie', 'success');
        });

        window.addEventListener('offline', () => {
            showToast('Vous êtes hors ligne', 'warning');
        });
        
        // Auto-refresh pending orders every 30 seconds when on cart page
        setInterval(() => {
            if (window.appState.currentPage === 'panier') {
                DataModule.loadPendingOrders().then(() => {
                    // Only re-render if there are changes
                    AppModule.navigateTo('panier');
                });
            }
        }, 30000);
    });
    // Fullscreen image viewer
const imageModal = document.getElementById('imageModal');
const modalImage = document.getElementById('modalImage');
const closeBtn = imageModal.querySelector('.close-btn');

// Ouvrir
function openImageModal(src, alt = '') {
    modalImage.src = src;
    modalImage.alt = alt;
    imageModal.classList.remove('hidden');
    document.body.style.overflow = 'hidden'; // bloque le scroll
}

// Fermer
function closeImageModal() {
    imageModal.classList.add('hidden');
    modalImage.src = '';
    document.body.style.overflow = '';
}

// Events
closeBtn.addEventListener('click', closeImageModal);

// Click en dehors de l’image
imageModal.addEventListener('click', (e) => {
    if (e.target === imageModal) closeImageModal();
});

// Touche ESC
document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape') closeImageModal();
});

</script>

</body>
</html>